!function(){"use strict";class e{constructor(){}static init(){Laya.ClassUtils.regClass}}e.width=750,e.height=1334,e.scaleMode="fixedwidth",e.screenMode="none",e.alignV="top",e.alignH="left",e.startScene="",e.sceneRoot="",e.debug=!1,e.stat=!1,e.physicsDebug=!1,e.exportSceneToJson=!0,e.init();class t{static addScrCon(e){}static addCommonCon(){}}var s,i,a,n,o,r,h,c,l,d,_,u,m;!function(e){e.CameraPro="EProcessor_CameraPro",e.HeightFogCubePro="EProcessor_HeightFogCubePro"}(s||(s={}));class g{}g.logStyle="\n        color: #fff;\n        background-color: #8d93ab;\n        border-radius: 3px;\n        line-height: 15px;\n        ",g.comStyle="\n        color: #fff;\n        background-color: #ade498;\n        border-radius: 3px;\n        line-height: 15px;\n        ",g.warnStyle="\n        color: #5c6e06;\n        background-color: #ffa931;\n        border-radius: 3px;\n        line-height: 15px;\n        ",g.errorStyle="\n        color: #fff;\n        background-color: #ec0101;\n        border-radius: 3px;\n        line-height: 15px;\n        ",g.platformStyle="\n        color: #52575d;\n        background-color: #e3fdfd;\n        border-radius: 3px;\n        line-height: 15px;\n        ";class p{static log(...e){console.log(`%c ${e}`,g.logStyle)}static warn(...e){console.log(`%c ${e}`,g.warnStyle)}static error(...e){console.log(`%c ${e}`,g.errorStyle)}static packLog(...e){return[`%c ${e} `,g.logStyle]}static comLog(...e){return[`%c ${e} `,g.comStyle]}static packWarn(...e){return[`%c 警告: ${e} `,g.warnStyle]}static packError(...e){return[`%c 错误: ${e} `,g.errorStyle]}static packPlatform(...e){return[`%c 平台: ${e} `,g.platformStyle]}}class f{static Load(e,t,s=null){if(s&&s.once&&(s.once=!1),!e||0==e.length)return t.run(),void s.run();Laya.loader.create(e,t,s)}static Load2d(e,t,s=null){if(s&&s.once&&(s.once=!1),!e||0==e.length)return t.run(),void s.run();Laya.loader.load(e,t,s)}static LoadAsync(e,t=null){return new Promise(s=>{f.Load(e,Laya.Handler.create(null,()=>{s()}),t)})}static Load2dAsync(e,t=null){return new Promise(function(s){f.Load2d(e,Laya.Handler.create(null,()=>{s()}),t)})}static Get(e,t=!1){let s=Laya.loader.getRes(e);return null==s?(console.log(...p.packError("资源尚未加载",e)),null):t?s:s.clone()}static LoadAndGet(e,t=!1){return new Promise(s=>{f.LoadAsync(e).then(i=>{s(f.Get(e,t))})})}static Unload(e){Laya.loader.clearRes(e)}}class I{static parseVector3(e){var t=e.split(",");return new Laya.Vector3(Number(t[0]),Number(t[1]),Number(t[2]))}static setV3Length(e,t){let s=t/Laya.Vector3.scalarLength(e);e.x=e.x*s,e.y=e.y*s,e.z=e.z*s}static PotLerpMove(e,t,s,i,a){if(!i)return void console.error("必须有一个输出的向量！");let n=Laya.Vector3.distance(e,t);return Laya.Vector3.lerp(e,t,s,i),1-n/a}static PotConstantSpeedMove(e,t,s,i){if(!i)return void console.error("必须有一个输出的向量！");let a,n=new Laya.Vector3;return Laya.Vector3.subtract(t,e,n),Laya.Vector3.scalarLength(n)>s?(this.setV3Length(n,s),a=!1):a=!0,Laya.Vector3.add(e,n,i),a}}class S{static initNode(e,t){e.name=t.name,t.position?e.transform.localPosition=I.parseVector3(t.position):e.transform.localPosition=new Laya.Vector3(0,0,0),t.euler?e.transform.localRotationEuler=I.parseVector3(t.euler):e.transform.localRotationEuler=new Laya.Vector3(0,0,0),t.scale?e.transform.localScale=I.parseVector3(t.scale):e.transform.localScale=new Laya.Vector3(1,1,1)}}class L{static get Datas(){return this.m_datas}static set Datas(e){this.m_datas=e}static get Handlers(){return this.m_handlers}static set Handlers(e){this.m_handlers=e}}L.m_ifSetProxy=!1;class y extends L{}!function(e){e.RootRes="res",e.Config="Config",e.FGUI="FGUI",e.LvConfig="LvConfig",e.Prefab="Prefab",e.Other="Other",e.icon="icon",e.img="img",e.music="music",e.sound="sound",e.skin="skin"}(i||(i={}));class w{constructor(){this.m_KeyResList={},this.m_KeyResList_={},this.m_KeyResList={[i.RootRes]:i.RootRes+"/",[i.Config]:i.RootRes+"/"+i.Config+"/",[i.FGUI]:i.RootRes+"/"+i.FGUI+"/",[i.LvConfig]:i.RootRes+"/"+i.LvConfig+"/",[i.Prefab]:i.RootRes+"/"+i.Prefab+"/",[i.Other]:i.RootRes+"/"+i.Other+"/",[i.icon]:i.RootRes+"/"+i.Other+"/"+i.icon+"/",[i.img]:i.RootRes+"/"+i.Other+"/"+i.img+"/",[i.music]:i.RootRes+"/"+i.Other+"/"+i.music+"/",[i.sound]:i.RootRes+"/"+i.Other+"/"+i.sound+"/",[i.skin]:i.RootRes+"/"+i.Other+"/"+i.skin+"/"};for(let e in this.m_KeyResList)this.m_KeyResList_[e]=this.m_KeyResList[e]}static get instance(){return null==this._instance&&(this._instance=new w),this._instance}ifKeyRes(e){let t=!1;for(let s in i)if(e==i[s]){t=!0;break}return t}getResURL(e){return this.m_KeyResList[e]}editKeyResList(e,t){let s=this.m_KeyResList_[e];if(s){console.log(...p.packLog("修改关键点资源路径",s,"替换成",t));for(let e in this.m_KeyResList)this.m_KeyResList[e]=this.m_KeyResList[e].replace(s,t);this.m_KeyResList_[e]=t}else console.log(...p.packWarn("修改资源路径失败，没有"+e+"这个关键路径！"))}}class v{static EssentialConfigUrl(){let e=[];return e.push(this.levelConfigURL),e}static EssentialOtherResUrl(){return[]}static get levelConfigURL(){return w.instance.getResURL(i.LvConfig)+"level.json"}static ConfigURL(e){return w.instance.getResURL(i.Config)+e}static FGUIPack(e){return w.instance.getResURL(i.FGUI)+e}static prefab_url(e){return w.instance.getResURL(i.Prefab)+"Conventional/"+e+".lh"}}class b{constructor(e,t,s){this._prefabRes=[],this.prefabs={},this.sprite3Ds=[],this.sceneNode=e,this.sceneNode_=t,this._sceneId=s}get ifDestroy(){return!Boolean(this._scene)}get scene(){return this._scene}loadRes(e=null){return f.LoadAsync(this.scenePrefabUrl(),e)}buildScene(e=null){return new Promise(t=>{this._scene?t(this._scene):(console.log(...p.packLog("开始构建关卡->"+this._sceneId)),this.loadRes(e).then(()=>{this._scene=new Laya.Sprite3D,y.s3d.addChild(this._scene);for(let e in this.sceneNode){let t=new Laya.Sprite3D;t.name=e,this._scene.addChild(t),this._buildScene(this.sceneNode[e],t)}console.log(...p.packLog("关卡->"+this._sceneId+"构建完成")),console.log("关卡->"+this._sceneId,"\n场景->",this._scene,"\n预制体->",this.prefabs,"\n物体->",this.sprite3Ds),t(this._scene)}))})}clearScene(){this._scene&&(console.log(...p.packLog("清除关卡->"+this._sceneId)),this._scene.destroy(),this._prefabRes=[],this.prefabs={},this._scene=null,this.sprite3Ds=[])}scenePrefabUrl(){let e=[],t=this.scenePrefabResName();return t&&t.forEach(t=>{e.push(v.prefab_url(t))}),e}sceneDirectPrefabUrl(){let e=[],t=this.sceneDirectPrefabResName();return t&&t.forEach(t=>{e.push(v.prefab_url(t))}),e}scenePreloadPrefabUrl(){let e=[],t=this.scenePreloadPrefabResName();return t&&t.forEach(t=>{e.push(v.prefab_url(t))}),e}scenePrefabResName(){let e=0;for(let t in this.sceneNode)e++;if(0!=e){if(!this._prefabRes||this._prefabRes.length<=0){for(let e in this.sceneNode)this._getPrefabName(this._prefabRes,this.sceneNode[e]);this.sceneNode_&&this.sceneNode_.length>0&&this.sceneNode_.forEach(e=>{this._getPrefabName(this._prefabRes,e)})}return this._prefabRes}console.log(...p.packError("关卡->"+this._sceneId+"<-不存在,或者是没有内容"))}sceneDirectPrefabResName(){let e=[];for(let t in this.sceneNode)this._getPrefabName(e,this.sceneNode[t]);return e}scenePreloadPrefabResName(){let e=[];return this.sceneNode_.forEach(t=>{this._getPrefabName(e,t)}),e}_getPrefabName(e,t){if(t){let s=t.prefabName;s?(t=t,e.indexOf(s)<0&&e.push(s)):(t=t).child&&t.child.forEach(t=>{this._getPrefabName(e,t)})}}_buildScene(e,t){let s=e.prefabName;if(s){e=e;let i=f.Get(v.prefab_url(s));i&&(S.initNode(i,e),t.addChild(i),this.prefabs[s]=this.prefabs[s]||[],this.prefabs[s].push(i),this.sprite3Ds.push(i))}else if((e=e).child){let s=new Laya.Sprite3D;S.initNode(s,e),t.addChild(s),e.child.forEach(e=>{this._buildScene(e,s)})}}}class C{static set sevelConfig(e){this.m_sevelConfig=e}static initCamera(e){let t=this.m_sevelConfig.camera;t&&S.initNode(e,t)}static initLight(e){let t=this.m_sevelConfig.light;t&&S.initNode(e,t)}}C.m_sevelConfig={},function(e){e[e.MinLeveNumber=3]="MinLeveNumber",e[e.DefaultLeveId=1]="DefaultLeveId",e[e.DebugLeveId=-1]="DebugLeveId",e[e.PrestrainLeveId=0]="PrestrainLeveId",e[e.NewHandLeveId=1]="NewHandLeveId"}(a||(a={})),function(e){e.config=class{},e.path="res/config/LevelConfig.json"}(n||(n={}));class A{constructor(){this.initData()}initData(){}}class U extends A{get dataList(){return this.m_dataList}}class D extends A{get data(){return this.m_data}}class P extends U{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new P),this._instance}initData(){this.m_dataList=n.dataList}getLevelNumber(){let e=0;return this.m_dataList.forEach(t=>{t.id>0&&e++}),e}byIdGetData(e){return this.m_dataList.find(t=>t.id==e)}}class O{static byLevelIdGetLevelData(e){let t=P.instance.byIdGetData(e),s=t.sceneName,i=t.sceneOtherRes;return s.replace(/\s+/g,"").replace(/^,+/,"").replace(/,+$/,"").replace(/,+/g,","),i.replace(/\s+/g,"").replace(/^,+/,"").replace(/,+$/,"").replace(/,+/g,","),{sceneName:s.split(","),sceneOtherRes:i.split(",")}}}class R{constructor(){this._levelConfig={},this._scenes={},C.sevelConfig=this._levelConfig}static get instance(){return null==this._instance&&(this._instance=new R),this._instance}init(){}initConfig(){let e=v.levelConfigURL,t=f.Get(e,!0);if(t.root)for(let e=0;e<t.root.length;e++){let s=t.root[e];this._levelConfig[s.name]=s}f.Unload(e)}Preload(e){let t=this.getSceneByLv(a.PrestrainLeveId).scenePrefabUrl();e.push(...t)}preloadSceneRes(e){console.log(...p.packLog("预加载关卡->",e)),this.getSceneByLv(e).loadRes()}getSceneByLv(e){let t=O.byLevelIdGetLevelData(e);t||console.log(...p.packError("不存在此关卡->",e));let s=t.sceneName,i=t.sceneOtherRes;if(!this._scenes[e]){let t={},a=[];for(let e in this._levelConfig)-1!=s.findIndex(t=>t==e)&&(t[e]=this._levelConfig[e]),-1!=i.findIndex(t=>t==e)&&a.push(this._levelConfig[e]);this._scenes[e]=new b(t,a,e)}return this._scenes[e]}getLvResName(e){return this.getSceneByLv(e).scenePrefabResName()}getLvResUrl(e){return this.getSceneByLv(e).scenePrefabUrl()}}class E{}E.gravity=-10,E.ifPreloadCustoms=!1;class x{constructor(){this.m_proList={},this.init(),this.register()}getPro(e){return this.m_proList[e]}init(){}register(){}AllotPre(e){this.allotPrefab(e),this.allotMediator()}allotPrefab(e){}allotMediator(){}}class G{constructor(e){this.m_proTypeof=e}get proTypeof(){return this.m_proTypeof}addScript(e,t,s){let i=e.addComponent(t);return i.setPro(this),i.setData(s),i}}class k extends Laya.Script3D{constructor(){super(...arguments),this.m_proStamp=[]}addProStamp(e){-1==this.m_proStamp.findIndex(t=>t==e)&&this.m_proStamp.push(e)}get proStamp(){return this.m_proStamp}ifAtPro(e){return-1!=this.m_proStamp.findIndex(t=>t==e)}}class M extends G{constructor(e){super(e),this.ifAddProStampScript=!1,this.ifAddParentNode=!1,this.onlyInit()}get sprList(){return this.m_sprList}get parentNode(){return this.m_parentNode}set _vo(e){this.m_vo=e,this.m_vo._initPro(this)}set _mediator(e){this.m_mediator=e,this.m_mediator._initPro(this)}onlyInit(){}_init(){this.ifAddParentNode&&(this.m_parentNode=new Laya.Sprite3D)}startPor(e){this._init(),this.initExtend(),this.init(),this.m_sprList=this.proSpr(e),this.sprInitExtend(),this.sprInit()}addSprAndPor(e){let t=this.proSpr(e);this.m_sprList.push(...t),this.addSprAndProCom(t)}addSprAndProCom(e){}init(){}initExtend(){}setSpr(e){}setSprExtend(e){}sprInit(){}sprInitExtend(){}getSprClass({id:e}){for(let t in this.m_sprIdClassList)if(-1!=this.m_sprIdClassList[t].findIndex(t=>t==e))return t}getAddCommonScrSpr(e){return e}static getProStamp(e){let t=e.getComponent(k);return t?t.proStamp:[]}proSpr(e){let t=[];for(let s in e)e[s]&&(t.push(...e[s]),this.addSprIdClassList(s,e[s]));return t.forEach(e=>{this.ifAddParentNode&&this.m_parentNode.addChild(e),this.addProStampCommonScr(this.getAddCommonScrSpr(e)),this.setSprExtend(e),this.setSpr(e)}),t}addSprIdClassList(e,t){if(!t)return;this.m_sprIdClassList||(this.m_sprIdClassList={}),this.m_sprIdClassList[e]||(this.m_sprIdClassList[e]=[]);let s=t.map(e=>e.id);this.m_sprIdClassList[e].push(...s);let i=new Set(this.m_sprIdClassList[e]);this.m_sprIdClassList[e]=Array.from(i)}addProStampCommonScr(e){if(!this.ifAddProStampScript)return;let t,s;(t=(s=e.getComponent(k))||e.addComponent(k)).addProStamp(this.proTypeof)}}class V extends Laya.Script3D{}class B extends V{get pro(){if(this.m_Pro)return this.m_Pro;console.log(...p.packWarn("->没有找到Pro!<-"))}get data(){return this.m_data}setPro(e){this.m_Pro=e}setData(e){this.m_data=e}}class N extends B{set cameraNode(e){this.m_cameraNode=e,this.m_cameraNodeTransform=e.transform}init(){}onAwake(){this.m_transform=this.owner.transform}onUpdate(){}}class T{static get zeroV3(){return T.m_zeroV3.clone()}static get zeroV2(){return T.m_zeroV2.clone()}}T.m_zeroV3=new Laya.Vector3(0,0,0),T.m_zeroV2=new Laya.Vector2(0,0),function(e){e.config=class{},e.path="res/config/EnvironmentConfig.json"}(o||(o={}));class H extends U{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new H),this._instance}initData(){this.m_dataList=o.dataList}byLevelIdGetData(e){return this.m_dataList.find(t=>t.id==e)}}class F{static RgbToHex(e,t,s){for(var i=(e<<16|t<<8|s).toString(16);i.length<6;)i="0"+i;return"#"+i}static ColorToHex(e){return this.RgbToHex(255*e.r,255*e.g,255*e.b)}static HexToColor(e,t=null){e.startsWith("#")&&(e=e.substring(1));let s=e.substring(0,2),i=e.substring(2,4),a=e.substring(4,6),n=e.substring(6,8),o=parseInt(s,16),r=parseInt(i,16),h=parseInt(a,16),c=t||parseInt(n,16);return new Laya.Color(o/255,r/255,h/255,c)}static ToV3(e){return new Laya.Vector3(e.r,e.g,e.b)}static ToV4(e){return new Laya.Vector4(e.r,e.g,e.b,e.a)}static HexToV3(e){e.startsWith("#")&&(e=e.substring(1));let t=e.substring(0,2),s=e.substring(2,4),i=e.substring(4,6),a=parseInt(t,16),n=parseInt(s,16),o=parseInt(i,16);return new Laya.Vector3(a/255,n/255,o/255)}static HexToV4(e,t=null){e.startsWith("#")&&(e=e.substring(1));let s=e.substring(0,2),i=e.substring(2,4),a=e.substring(4,6),n=e.substring(6,8),o=parseInt(s,16),r=parseInt(i,16),h=parseInt(a,16),c=t||parseInt(n,16);return new Laya.Vector4(o/255,r/255,h/255,c)}}class W{constructor(){this.items={}}set(e,t){return this.items[e]=t,!0}has(e){return this.items.hasOwnProperty(e)}remove(e){return!!this.has(e)&&(delete this.items[e],!0)}get(e){return this.has(e)?this.items[e]:void 0}keys(){return Object.keys(this.items)}get length(){return this.keys().length}clear(){this.items={}}}class z{}z.timestep=1/60,z.iterations=24,z.broadphase=2,z.worldscale=1,z.random=!0,z.info=!1,z.gravity=[0,-9.8,0];class j{constructor(){this._oimoRigDic=new W,this._transformDic=new W,this._oimoOffset=new W,this._oimoRigDicR=new W,this._transformDicR=new W,this._oimoOffsetR=new W,this._tempOimoV3=new OIMO.Vec3,this._tempOimoQuat=new OIMO.Quat,this._tempQuaternion=new Laya.Quaternion,this._init()}get oimoWorld(){return this._oimoWorld}static get instance(){return j._instance||(j._instance=new j),j._instance}_init(){this._oimoWorld=this.CreateWolrd(),window.oimoWorld=this._oimoWorld}CreateWolrd(){return new OIMO.World({timestep:z.timestep,iterations:z.iterations,broadphase:z.broadphase,worldscale:z.worldscale,random:z.random,info:z.info,gravity:z.gravity})}_createRigBox(e,t,s,i,a,n="box"){return e.add({type:n,size:[i.x,i.y,i.z],pos:[t.x,t.y,t.z],rot:[s.x,s.y,s.z],move:a,density:10,belongsTo:1,collidesWith:4294967295})}CreateCompoundRig(e,t,s=!0,i=!0,a=!1,n=!1,o=10,r=1,h=4294967295){for(var c=[],l=[],d=[],_=[],u=0;u<t.length;u++){let e=t[u];c.push(e.type),l.push(e.pos.x,e.pos.y,e.pos.z),d.push(e.eular.x,e.eular.y,e.eular.z),_.push(e.size.x,e.size.y,e.size.z)}let m=this.oimoWorld.add({type:c,pos:[e.position.x,e.position.y,e.position.z],rot:[e.rotationEuler.x,e.rotationEuler.y,e.rotationEuler.z],posShape:l,rotShape:d,size:_,move:s,density:o,friction:.999,restitution:.1,isKinematic:n,belongsTo:r,collidesWith:h});return m.id=j.m_rigId,j.m_rigId++,i&&(this._oimoRigDic.set(m.id,m),this._transformDic.set(m.id,e),this._oimoOffset.set(m.id,new Laya.Vector3)),a&&(this._oimoRigDicR.set(m.id,m),this._transformDicR.set(m.id,e),this._oimoOffsetR.set(m.id,new Laya.Vector3)),m}static SetCollideData(e,t,s,i,a){for(var n=e.shapes;null!==n;n=n.next)null!=t&&(n.belongsTo=t),null!=s&&(n.collidesWith=s),null!=i&&(n.restitution=i),null!=a&&(n.friction=a)}setCanMove(e,t){t?e.setupMass(OIMO.BODY_DYNAMIC,!1):e.setupMass(OIMO.BODY_STATIC,!1)}clearRig(){this._oimoWorld.clear(),this._oimoRigDic.clear(),this._transformDic.clear(),this._oimoOffset.clear(),this._oimoRigDicR.clear(),this._transformDicR.clear(),this._oimoOffsetR.clear()}addRig(e,t=this._oimoWorld){e&&t.addRigidBody(e)}RemoveRig(e,t=this._oimoWorld,s=!1){e&&(s&&(this._oimoRigDic.remove(e.id),this._transformDic.remove(e.id),this._oimoOffset.remove(e.id),this._oimoRigDicR.remove(e.id),this._transformDicR.remove(e.id),this._oimoOffsetR.remove(e.id)),t.removeRigidBody(e))}AddJoint(e,t,s,i,a,n){return this.oimoWorld.add({type:e,body1:t,body2:s,pos1:null!=i?[i.x,i.y,i.z]:i,pos2:null!=a?[a.x,a.y,a.z]:a,spring:n})}RemoveJoint(e){this.oimoWorld.removeJoint(e)}updateAllTrans(){this._oimoRigDic.keys().forEach(e=>{this.UpdateTrans(this._transformDic.get(e),this._oimoRigDic.get(e),this._oimoOffset.get(e))})}updateAllTransReverse(){this._oimoRigDicR.keys().forEach(e=>{this.UpdateTransReverse(this._transformDicR.get(e),this._oimoRigDicR.get(e))})}UpdateTransReverse(e,t){if(!e||!t||!t.parent)return;let s=e.position;this._tempOimoV3.set(s.x,s.y,s.z),t.awake(),t.setPosition(this._tempOimoV3);let i=e.rotation;this._tempOimoQuat.set(i.x,i.y,i.z,i.w),t.setQuaternion(this._tempOimoQuat)}UpdateTrans(e,t,s){if(!e||!t||!t.parent)return;let i=t.getPosition();if(e.position.x=i.x,e.position.y=i.y,e.position.z=i.z,s&&!this.isZero(s)){let t=s.clone();Laya.Quaternion.createFromYawPitchRoll(this.deg2rad(e.rotationEuler.y),this.deg2rad(e.rotationEuler.x),this.deg2rad(e.rotationEuler.z),this._tempQuaternion),Laya.Vector3.transformQuat(t,this._tempQuaternion,t),Laya.Vector3.subtract(e.position,t,e.position)}e.position=e.position;let a=t.getQuaternion();e.rotation.x=a.x,e.rotation.y=a.y,e.rotation.z=a.z,e.rotation.w=a.w,e.rotation=e.rotation}isZero(e){return Laya.MathUtils3D.isZero(e.x)&&Laya.MathUtils3D.isZero(e.y)&&Laya.MathUtils3D.isZero(e.z)}deg2rad(e){return e*Math.PI/180}GetRig(e){return this._oimoRigDic.get(e)}}j.m_rigId=0;class J extends Laya.Script3D{onUpdate(){j.instance.oimoWorld.timeStep=Laya.timer.delta/1e3,j.instance.oimoWorld.step(),j.instance.updateAllTrans(),j.instance.updateAllTransReverse()}}class Q{}Q.support2D=!1,Q.support3D=!0,Q.ifAddOimoSystem=!1,Q.ifTest=!0;class q{static InitAll(){Q.support3D?(this.s3d=Laya.stage.addChildAt(new Laya.Scene3D,0),this.camera=new Laya.Camera,this.s3d.addChild(this.camera),C.initCamera(this.camera),this.light=new Laya.DirectionLight,this.s3d.addChild(this.light),C.initLight(this.light),Q.ifAddOimoSystem&&this.addOimoSystem(),y.s3d=this.s3d,y.camera=this.camera,y.light=this.light):console.log(...p.packLog("请设置支持3D!"))}static addOimoSystem(){let e=new Laya.Sprite3D;this.s3d.addChild(e),e.addComponent(J)}}!function(e){e.LookAd="_EEventScene_LookAd",e.UnLookAd="_EEventScene_UnLookAd",e.GameLevelsBuild="_EEventScene_GameLevelsBuild",e.GameLevelsBuildBefore="_EEventScene_GameLevelsBuildBefore",e.GameLevelsOnBuild="_EEventScene_GameLevelsOnBuild",e.GameLevelsDelete="_EEventScene_GameLevelsDelete",e.GameStart="_EEventScene_Start",e.GameSuspend="_EEventScene_GameSuspend",e.GameGoOn="_EEventScene_GameGoOn",e.GameRestart="_EEventScene_GameRestart",e.GameEnd="_EEventScene_GameEnd",e.GameCom="_EEventScene_GameCom",e.GameWin="_EEventScene_gameWin",e.GameFail="_EEventScene_gameFail",e.RoleDie="_EEventScene_RoleDie",e.RoleRevive="_EEventScene_Revive",e.MouseClick="_EEventScene_MouseClick",e.MouseMove="_EEventScene_MouseMove",e.MouseUp="_EEventScene_MouseUp"}(r||(r={}));class K extends Laya.EventDispatcher{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new K),this._instance}init(){}eventGlobal(e,t){K.instance.event(e,t)}eventAudio(e,t){K.instance.event(e,t)}eventUI(e,t){K.instance.event(e,t)}event3D(e,t){K.instance.event(e,t)}onGlobal(e,t,s,i){K.instance.on(e,t,s,i)}onAudio(e,t,s,i){K.instance.on(e,t,s,i)}onUI(e,t,s,i){K.instance.on(e,t,s,i)}on3D(e,t,s,i){K.instance.on(e,t,s,i)}offGlobal(e,t,s){K.instance.off(e,t,s)}offAudio(e,t,s){K.instance.off(e,t,s)}offUI(e,t,s){K.instance.off(e,t,s)}off3D(e,t,s){K.instance.off(e,t,s)}}class ${}$.GameWhatTeam="小小游戏",$.GameName="LayaMiniGame",$.GameName_="LayaBox小游戏",$.GameExplain="LayaBox小游戏",$.versions="0.0.0",$.OnLine=!1;class Z{static SplitToIntArray(e,t){for(var s=e.split(t),i=[],a=0;a<s.length;++a){var n=parseInt(s[a]);isNaN(n)&&(n=0),i.push(n)}return i}static IntArrToStr(e){for(var t="",s=0;s<e.length;++s)t+=e[s].toFixed(0),s<e.length-1&&(t+=",");return t}static IsNullOrEmpty(e){return null==e||""==e}}class Y{constructor(){this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}static hashStr(e,t=!1){return this.onePassHasher.start().appendStr(e).end(t)}static hashAsciiStr(e,t=!1){return this.onePassHasher.start().appendAsciiStr(e).end(t)}static _hex(e){const t=Y.hexChars,s=Y.hexOut;let i,a,n,o;for(o=0;o<4;o+=1)for(a=8*o,i=e[o],n=0;n<8;n+=2)s[a+1+n]=t.charAt(15&i),i>>>=4,s[a+0+n]=t.charAt(15&i),i>>>=4;return s.join("")}static _md5cycle(e,t){let s=e[0],i=e[1],a=e[2],n=e[3];i=((i+=((a=((a+=((n=((n+=((s=((s+=(i&a|~i&n)+t[0]-680876936|0)<<7|s>>>25)+i|0)&i|~s&a)+t[1]-389564586|0)<<12|n>>>20)+s|0)&s|~n&i)+t[2]+606105819|0)<<17|a>>>15)+n|0)&n|~a&s)+t[3]-1044525330|0)<<22|i>>>10)+a|0,i=((i+=((a=((a+=((n=((n+=((s=((s+=(i&a|~i&n)+t[4]-176418897|0)<<7|s>>>25)+i|0)&i|~s&a)+t[5]+1200080426|0)<<12|n>>>20)+s|0)&s|~n&i)+t[6]-1473231341|0)<<17|a>>>15)+n|0)&n|~a&s)+t[7]-45705983|0)<<22|i>>>10)+a|0,i=((i+=((a=((a+=((n=((n+=((s=((s+=(i&a|~i&n)+t[8]+1770035416|0)<<7|s>>>25)+i|0)&i|~s&a)+t[9]-1958414417|0)<<12|n>>>20)+s|0)&s|~n&i)+t[10]-42063|0)<<17|a>>>15)+n|0)&n|~a&s)+t[11]-1990404162|0)<<22|i>>>10)+a|0,i=((i+=((a=((a+=((n=((n+=((s=((s+=(i&a|~i&n)+t[12]+1804603682|0)<<7|s>>>25)+i|0)&i|~s&a)+t[13]-40341101|0)<<12|n>>>20)+s|0)&s|~n&i)+t[14]-1502002290|0)<<17|a>>>15)+n|0)&n|~a&s)+t[15]+1236535329|0)<<22|i>>>10)+a|0,i=((i+=((a=((a+=((n=((n+=((s=((s+=(i&n|a&~n)+t[1]-165796510|0)<<5|s>>>27)+i|0)&a|i&~a)+t[6]-1069501632|0)<<9|n>>>23)+s|0)&i|s&~i)+t[11]+643717713|0)<<14|a>>>18)+n|0)&s|n&~s)+t[0]-373897302|0)<<20|i>>>12)+a|0,i=((i+=((a=((a+=((n=((n+=((s=((s+=(i&n|a&~n)+t[5]-701558691|0)<<5|s>>>27)+i|0)&a|i&~a)+t[10]+38016083|0)<<9|n>>>23)+s|0)&i|s&~i)+t[15]-660478335|0)<<14|a>>>18)+n|0)&s|n&~s)+t[4]-405537848|0)<<20|i>>>12)+a|0,i=((i+=((a=((a+=((n=((n+=((s=((s+=(i&n|a&~n)+t[9]+568446438|0)<<5|s>>>27)+i|0)&a|i&~a)+t[14]-1019803690|0)<<9|n>>>23)+s|0)&i|s&~i)+t[3]-187363961|0)<<14|a>>>18)+n|0)&s|n&~s)+t[8]+1163531501|0)<<20|i>>>12)+a|0,i=((i+=((a=((a+=((n=((n+=((s=((s+=(i&n|a&~n)+t[13]-1444681467|0)<<5|s>>>27)+i|0)&a|i&~a)+t[2]-51403784|0)<<9|n>>>23)+s|0)&i|s&~i)+t[7]+1735328473|0)<<14|a>>>18)+n|0)&s|n&~s)+t[12]-1926607734|0)<<20|i>>>12)+a|0,i=((i+=((a=((a+=((n=((n+=((s=((s+=(i^a^n)+t[5]-378558|0)<<4|s>>>28)+i|0)^i^a)+t[8]-2022574463|0)<<11|n>>>21)+s|0)^s^i)+t[11]+1839030562|0)<<16|a>>>16)+n|0)^n^s)+t[14]-35309556|0)<<23|i>>>9)+a|0,i=((i+=((a=((a+=((n=((n+=((s=((s+=(i^a^n)+t[1]-1530992060|0)<<4|s>>>28)+i|0)^i^a)+t[4]+1272893353|0)<<11|n>>>21)+s|0)^s^i)+t[7]-155497632|0)<<16|a>>>16)+n|0)^n^s)+t[10]-1094730640|0)<<23|i>>>9)+a|0,i=((i+=((a=((a+=((n=((n+=((s=((s+=(i^a^n)+t[13]+681279174|0)<<4|s>>>28)+i|0)^i^a)+t[0]-358537222|0)<<11|n>>>21)+s|0)^s^i)+t[3]-722521979|0)<<16|a>>>16)+n|0)^n^s)+t[6]+76029189|0)<<23|i>>>9)+a|0,i=((i+=((a=((a+=((n=((n+=((s=((s+=(i^a^n)+t[9]-640364487|0)<<4|s>>>28)+i|0)^i^a)+t[12]-421815835|0)<<11|n>>>21)+s|0)^s^i)+t[15]+530742520|0)<<16|a>>>16)+n|0)^n^s)+t[2]-995338651|0)<<23|i>>>9)+a|0,i=((i+=((n=((n+=(i^((s=((s+=(a^(i|~n))+t[0]-198630844|0)<<6|s>>>26)+i|0)|~a))+t[7]+1126891415|0)<<10|n>>>22)+s|0)^((a=((a+=(s^(n|~i))+t[14]-1416354905|0)<<15|a>>>17)+n|0)|~s))+t[5]-57434055|0)<<21|i>>>11)+a|0,i=((i+=((n=((n+=(i^((s=((s+=(a^(i|~n))+t[12]+1700485571|0)<<6|s>>>26)+i|0)|~a))+t[3]-1894986606|0)<<10|n>>>22)+s|0)^((a=((a+=(s^(n|~i))+t[10]-1051523|0)<<15|a>>>17)+n|0)|~s))+t[1]-2054922799|0)<<21|i>>>11)+a|0,i=((i+=((n=((n+=(i^((s=((s+=(a^(i|~n))+t[8]+1873313359|0)<<6|s>>>26)+i|0)|~a))+t[15]-30611744|0)<<10|n>>>22)+s|0)^((a=((a+=(s^(n|~i))+t[6]-1560198380|0)<<15|a>>>17)+n|0)|~s))+t[13]+1309151649|0)<<21|i>>>11)+a|0,i=((i+=((n=((n+=(i^((s=((s+=(a^(i|~n))+t[4]-145523070|0)<<6|s>>>26)+i|0)|~a))+t[11]-1120210379|0)<<10|n>>>22)+s|0)^((a=((a+=(s^(n|~i))+t[2]+718787259|0)<<15|a>>>17)+n|0)|~s))+t[9]-343485551|0)<<21|i>>>11)+a|0,e[0]=s+e[0]|0,e[1]=i+e[1]|0,e[2]=a+e[2]|0,e[3]=n+e[3]|0}start(){return this._dataLength=0,this._bufferLength=0,this._state.set(Y.stateIdentity),this}appendStr(e){const t=this._buffer8,s=this._buffer32;let i,a,n=this._bufferLength;for(a=0;a<e.length;a+=1){if((i=e.charCodeAt(a))<128)t[n++]=i;else if(i<2048)t[n++]=192+(i>>>6),t[n++]=63&i|128;else if(i<55296||i>56319)t[n++]=224+(i>>>12),t[n++]=i>>>6&63|128,t[n++]=63&i|128;else{if((i=1024*(i-55296)+(e.charCodeAt(++a)-56320)+65536)>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");t[n++]=240+(i>>>18),t[n++]=i>>>12&63|128,t[n++]=i>>>6&63|128,t[n++]=63&i|128}n>=64&&(this._dataLength+=64,Y._md5cycle(this._state,s),n-=64,s[0]=s[16])}return this._bufferLength=n,this}appendAsciiStr(e){const t=this._buffer8,s=this._buffer32;let i,a=this._bufferLength,n=0;for(;;){for(i=Math.min(e.length-n,64-a);i--;)t[a++]=e.charCodeAt(n++);if(a<64)break;this._dataLength+=64,Y._md5cycle(this._state,s),a=0}return this._bufferLength=a,this}appendByteArray(e){const t=this._buffer8,s=this._buffer32;let i,a=this._bufferLength,n=0;for(;;){for(i=Math.min(e.length-n,64-a);i--;)t[a++]=e[n++];if(a<64)break;this._dataLength+=64,Y._md5cycle(this._state,s),a=0}return this._bufferLength=a,this}getState(){const e=this._state;return{buffer:String.fromCharCode.apply(null,this._buffer8),buflen:this._bufferLength,length:this._dataLength,state:[e[0],e[1],e[2],e[3]]}}setState(e){const t=e.buffer,s=e.state,i=this._state;let a;for(this._dataLength=e.length,this._bufferLength=e.buflen,i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],a=0;a<t.length;a+=1)this._buffer8[a]=t.charCodeAt(a)}end(e=!1){const t=this._bufferLength,s=this._buffer8,i=this._buffer32,a=1+(t>>2);let n;if(this._dataLength+=t,s[t]=128,s[t+1]=s[t+2]=s[t+3]=0,i.set(Y.buffer32Identity.subarray(a),a),t>55&&(Y._md5cycle(this._state,i),i.set(Y.buffer32Identity)),(n=8*this._dataLength)<=4294967295)i[14]=n;else{const e=n.toString(16).match(/(.*?)(.{0,8})$/);if(null===e)return;const t=parseInt(e[2],16),s=parseInt(e[1],16)||0;i[14]=t,i[15]=s}return Y._md5cycle(this._state,i),e?this._state:Y._hex(this._state)}}Y.ifUse=!0,Y.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]),Y.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Y.hexChars="0123456789abcdef",Y.hexOut=[],Y.onePassHasher=new Y,"5d41402abc4b2a76b9719d911017c592"!==Y.hashStr("hello")&&(Y.ifUse=!1,console.warn("Md5 self test failed."));class X{}class ee{static encode(e){let t,s,i,a,n,o,r,h="",c=0;for(e=this._utf8_encode(e);c<e.length;)a=(t=e.charCodeAt(c++))>>2,n=(3&t)<<4|(s=e.charCodeAt(c++))>>4,o=(15&s)<<2|(i=e.charCodeAt(c++))>>6,r=63&i,isNaN(s)?o=r=64:isNaN(i)&&(r=64),h=h+this._keyStr.charAt(a)+this._keyStr.charAt(n)+this._keyStr.charAt(o)+this._keyStr.charAt(r);return h}static decode(e){let t,s,i,a,n,o,r,h="",c=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<e.length;)t=(a=this._keyStr.indexOf(e.charAt(c++)))<<2|(n=this._keyStr.indexOf(e.charAt(c++)))>>4,s=(15&n)<<4|(o=this._keyStr.indexOf(e.charAt(c++)))>>2,i=(3&o)<<6|(r=this._keyStr.indexOf(e.charAt(c++))),h+=String.fromCharCode(t),64!==o&&(h+=String.fromCharCode(s)),64!==r&&(h+=String.fromCharCode(i));return h=this._utf8_decode(h)}static _utf8_encode(e){e=e.replace(/\r\n/g,"\n");let t="";for(let s=0;s<e.length;s++){const i=e.charCodeAt(s);i<128?t+=String.fromCharCode(i):i>127&&i<2048?(t+=String.fromCharCode(i>>6|192),t+=String.fromCharCode(63&i|128)):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128),t+=String.fromCharCode(63&i|128))}return t}static _utf8_decode(e){let t="",s=0,i=0,a=0,n=0;for(;s<e.length;)(i=e.charCodeAt(s))<128?(t+=String.fromCharCode(i),s++):i>191&&i<224?(a=e.charCodeAt(s+1),t+=String.fromCharCode((31&i)<<6|63&a),s+=2):(a=e.charCodeAt(s+1),n=e.charCodeAt(s+2),t+=String.fromCharCode((15&i)<<12|(63&a)<<6|63&n),s+=3);return t}}ee._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";class te extends X{get saveName(){return $.GameName+this._saveName}get differName(){return this.encrypt(this.saveName+"-(-__DifferData__LayaMiniGame__-)-")}_SaveToDisk(e){let t=JSON.stringify(e);if(Laya.LocalStorage.setJSON(this.saveName,t),$.OnLine){let e=this.getDifferData(t);Laya.LocalStorage.setJSON(this.differName,e)}}_ReadFromFile(){let e=Laya.LocalStorage.getJSON(this.saveName);if($.OnLine){let t=Laya.LocalStorage.getJSON(this.differName);if(this.getDifferData(e)!=t)return this._saveNewData()}let t=this.getNewData();t.versions=void 0;try{if(Z.IsNullOrEmpty(e))return this._saveNewData();{let s=JSON.parse(e);for(let e in s)t[e]=s[e]}}catch(e){return this._saveNewData()}return t.versions==$.versions?t:this._saveNewData()}_saveNewData(){let e=this.getNewData();return e.versions=$.versions,e.GameName=$.GameName,e.GameExplain=$.GameExplain,this._SaveToDisk(e),e}getDifferData(e){return Z.IsNullOrEmpty(e)?"":this.encrypt(e)}encrypt(e){let t="LayaMiniGame-(-"+e+"-)-ModifiedWithout-"+$.GameName+"-"+$.versions;return Y.ifUse?Y.hashStr(t).toString():ee.encode(t)}}class se{}class ie extends se{clone(){}}class ae extends ie{constructor(){super(...arguments),this.maxCustoms=0,this.ifOpenBgm=!0,this.ifOpenSound=!0,this.ifOpenVibrate=!0,this.coinCount=0,this.onCustoms=a.DebugLeveId,this.maxCustomsRecord=1}clone(){return JSON.parse(JSON.stringify(this))}}class ne extends te{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new ne),this._instance}get _saveName(){return"->GameDataSave<-"}InitData(){this._saveData=this._ReadFromFile()}static get gameData(){return this._instance._saveData.clone()}static initCustoms(e){this._instance._saveData.maxCustoms!=e&&(this._instance._saveData.maxCustoms=e,this._instance._saveData.onCustoms>e&&(this._instance._saveData.onCustoms=e),this._instance._saveData.maxCustomsRecord>e&&(this._instance._saveData.maxCustomsRecord=e),this.SaveToDisk())}static ifNewHandCustoms(){return this._instance._saveData.onCustoms==a.NewHandLeveId&&this._instance._saveData.maxCustomsRecord<=a.NewHandLeveId}static setIfOpenBGM(e){this._instance._saveData.ifOpenBgm=e,this.SaveToDisk()}static setIfOpenSound(e){this._instance._saveData.ifOpenSound=e,this.SaveToDisk()}static setIfOpenVibrate(e){this._instance._saveData.ifOpenVibrate=e,this.SaveToDisk()}static setCustoms(e){e>this._instance._saveData.maxCustoms||(this._instance._saveData.onCustoms=e)}static addCustoms(e=1){let t=this._instance._saveData.onCustoms+e,s=!1;return t<=this._instance._saveData.maxCustoms?(this._instance._saveData.onCustoms=t,t>this._instance._saveData.maxCustomsRecord&&(this._instance._saveData.maxCustomsRecord=t),s=!0):(this._instance._saveData.onCustoms=a.DefaultLeveId,s=!0),this.SaveToDisk(),s}static getDefaultCustoms(){return this._instance._saveData.onCustoms>this._instance._saveData.maxCustoms&&(this._instance._saveData.onCustoms=a.DefaultLeveId,this.SaveToDisk()),this._instance._saveData.onCustoms}static getPreloadCustoms(){return this.getNextCustoms()}static getNextCustoms(){let e=this._instance._saveData.onCustoms+1;return e>this._instance._saveData.maxCustoms&&(e=a.DefaultLeveId),e}getNewData(){return new ae}static SaveToDisk(){this._instance._SaveToDisk(this._instance._saveData)}}class oe{constructor(){}static get instance(){return this.m_instance||(this.m_instance=new oe),this.m_instance}init(){this.m_s3d=q.s3d,this.m_camera=q.camera,this.m_light=q.light}setEnvironment(e){this.m_scene=e;let t=ne.gameData.onCustoms;this.m_enviromentConfig=H.instance.byLevelIdGetData(t),console.log("关卡环境配置参数->"+t+"->",this.m_enviromentConfig),this.setS3D(this.m_s3d),this.setCamera(this.m_camera),this.setLight(this.light),this.addAmbient(this.s3d),K.instance.on3D(r.GameLevelsDelete,this,this.gameLevelsDelete)}get s3d(){return this.m_s3d}get camera(){return this.m_camera}get scene(){return this.m_scene}get light(){return this.m_light}setS3D(e){this.m_ifSetS3D||(this.m_ifSetS3D=!0)}setCamera(e){e.clearColor=F.HexToV4(this.m_enviromentConfig.clear_color)}setLight(e){e.color=F.HexToV3(this.m_enviromentConfig.light_color),e.intensity=this.m_enviromentConfig.light_intensity,e.shadowMode=Laya.ShadowMode.SoftLow,e.shadowResolution=2500,e.shadowNormalBias=.5}addAmbient(e){e.ambientMode=Laya.AmbientMode.SolidColor,e.ambientColor=F.HexToV3(this.m_enviromentConfig.ambient_color)}addFog(e){}gameLevelsDelete(){}}class re extends M{constructor(){super(...arguments),this.ifAddProStampScript=!1}retainVidicon(){this.m_retainNode||(this.m_retainNode=new Laya.Sprite3D),this.m_retainNode.addChild(this.m_cameraNode)}sprInit(){this.m_camera||(this.m_sprList[0]||console.log(...p.packError("没有找到摄像机!")),this.m_camera=this.m_sprList[0],this.m_cameraNode=new Laya.Sprite3D,this.m_rootPos=this.m_camera.transform.position.clone(),this.m_rootAng=this.m_camera.transform.rotationEuler.clone(),this.m_rootAng.x=-this.m_rootAng.x,this.m_rootAng.y=this.m_rootAng.y-180,this.m_cameraNode.addChild(this.m_camera),this.m_camera.transform.localPosition=T.zeroV3,this.m_camera.transform.localRotationEuler=new Laya.Vector3(0,-180,0),this.m_Scr=this.addScript(this.m_camera,N),this.m_Scr.cameraNode=this.m_cameraNode),oe.instance.s3d.addChild(this.m_cameraNode),this.m_cameraNode.transform.position=this.m_rootPos,this.m_cameraNode.transform.rotationEuler=new Laya.Vector3(this.m_rootAng.x,this.m_rootAng.y,0),this.m_Scr.init()}}class he extends M{constructor(){super(...arguments),this.ifAddProStampScript=!1}}class ce extends L{constructor(){super()}static get instance(){return this._instance?this._instance:(this._instance=new ce,this._instance)}getPro(e){return this.ProList[e]}get cameraPro(){return this.getPro(s.CameraPro)}get heightFogCubePro(){return this.getPro(s.HeightFogCubePro)}}class le{}le.Cube="Cube",le.Sphere="Sphere",le.Cylinder="Cylinder";class de extends le{}de.Camera="camera",de.Environment="environment",de.HeightFog="heightFog";class _e extends x{constructor(){super()}static get instance(){return this._instance?this._instance:(this._instance=new _e,this._instance)}init(){ce.instance.ProList=this.m_proList}register(){this.m_proList[s.CameraPro]=new re(s.CameraPro),this.m_proList[s.HeightFogCubePro]=new he(s.HeightFogCubePro)}allotPrefab(e){this.m_proList[s.CameraPro].startPor({[de.Camera]:[oe.instance.camera]}),this.m_proList[s.HeightFogCubePro].startPor({[de.HeightFog]:e[de.HeightFog]})}allotMediator(){}}!function(e){e.LookAd="_EEventUI_LookAd",e.UnLookAd="_EEventUI_UnLookAd",e.CustomsChange="_EEventUI_CustomsChange",e.GameStart="_EEventUI_Start",e.GameEnd="_EEventUI_GameEnd",e.GamePasue="_EEventUI_GamePause",e.GameResume="_EEventUI_GameResume",e.GameCom="_EEventUI_GameCom",e.GameWin="_EEventUI_GameWin",e.GameFail="_EEventUI_GameFail",e.RoleDie="_EEventUI_RoleDie",e.RoleRevive="_EEventUI_RoleRevive",e.GameCoinChange="_EEventUI_GameCoinChange",e.SoundStateChange="_EEventUI_SoundStateChange",e.VibrateStateChange="_EEventUI_VibrateStateChange",e.SceneGameCustomsInit="_EEventUI_SceneGameCustomsInit",e.SceneGameCustomsLoading="_EEventUI_SceneGameCustomsLoading",e.SceneGameCustomDelete="_EEventUI_SceneGameCustomDelete"}(h||(h={}));class ue{constructor(){this.m_ifInit=!1}static get instance(){return this.m_instance||(this.m_instance=new ue),this.m_instance}init(){this.m_ifSceneLoading=!1,ne.initCustoms(P.instance.getLevelNumber()),K.instance.on3D(r.GameLevelsBuild,this,this.gameLevelsBuild),K.instance.on3D(r.GameLevelsDelete,this,this.gameLevelsDelete)}initLevelBuild(){this.gameLevelsBuild()}gameLevelsBuild(){let e;this.m_ifInit?e=ne.gameData.onCustoms:(this.m_ifInit=!0,e=ne.getDefaultCustoms());let s=R.instance.getSceneByLv(e);this.m_scene=s,this.m_ifSceneLoading=!0,K.instance.event3D(r.GameLevelsBuildBefore),K.instance.eventUI(h.SceneGameCustomsLoading,[-1]),s.buildScene(Laya.Handler.create(this,this.customsProgress,null,!1)).then(()=>{if(this.m_ifSceneLoading=!1,oe.instance.setEnvironment(this.m_scene.scene),_e.instance.AllotPre(s.prefabs),t.addScrCon(s.scene),t.addCommonCon(),K.instance.event3D(r.GameLevelsOnBuild),E.ifPreloadCustoms){let e=ne.getPreloadCustoms();R.instance.preloadSceneRes(e)}this.onCustomsInit(e),K.instance.eventUI(h.SceneGameCustomsInit)})}onCustomsInit(e){}customsProgress(e){this.m_ifSceneLoading&&(void 0===e&&(e=1),K.instance.eventUI(h.SceneGameCustomsLoading,[100*e]))}gameLevelsDelete(){_e.instance.getPro(s.CameraPro).retainVidicon(),this.m_scene&&this.m_scene.scene&&this.m_scene.clearScene(),this.m_scene=null,K.instance.eventUI(h.SceneGameCustomDelete)}}class me{constructor(){this.needFitScreen=!1}}!function(e){e.bottom_group="m_bottom_group",e.anim_enter="m_anim_enter",e.anim_exit="m_anim_exit"}(c||(c={})),function(e){e.Bg="EUILayer_Bg",e.Main="EUILayer_Main",e.OneUI="EUILayer_OneUI",e.Panel="EUILayer_Panel",e.Popup="EUILayer_Popup",e.Prop="EUILayer_Prop",e.Tip="EUILayer_Tip",e.Pause="EUILayer_Pause",e.Set="EUILayer_Set",e.Top="EUILayer_Top",e.Loading="EUILayer_Loading"}(l||(l={}));class ge{static getLayer(e){return this.LayerList[e]}static Init(){fgui.UIConfig.packageFileExtension="bin",Laya.stage.addChild(fgui.GRoot.inst.displayObject),this.LayerList={};for(let e in l)this.LayerList[l[e]]=fgui.GRoot.inst.addChild(new fgui.GComponent);this.UpdateAllUI(),Laya.stage.on(Laya.Event.RESIZE,this,this.UpdateAllUI)}static AddUI(e,t=null,s){let i=e.createInstance();if(s==l.OneUI){let e=ge.oneUIs;e.length>0&&e.forEach(e=>{e&&e.Hide()}),ge.oneUIs=[]}return this.getLayer(s).addChild(i),null==t&&(t=new me),null!=t&&t.needFitScreen?(i.setSize(fgui.GRoot.inst.width,fgui.GRoot.inst.height-this.top-this.bottom),i.y=this.top):i.setSize(fgui.GRoot.inst.width,fgui.GRoot.inst.height),this._cacheMap.set(i.constructor.name,t),window[i.constructor.name]=i,i}static setUIToTopShow(e,t){let s=this.getLayer(t);-1!=s.getChildIndex(e)?(e.removeFromParent(),s.addChild(e)):console.log(...p.packWarn("设置ui到最顶层失败，因为该层级里面没有该UI！"))}static UpdateAllUI(){let e=Laya.stage.width,t=Laya.stage.height;fgui.GRoot.inst.setSize(e,t);let s=fgui.GRoot.inst.numChildren;for(let e=0;e<s;++e){let t=fgui.GRoot.inst.getChildAt(e),s=this._cacheMap.get(t.constructor.name);null!=s&&s.needFitScreen?(t.setSize(fgui.GRoot.inst.width,fgui.GRoot.inst.height-this.top-this.bottom),t.y=this.top):t.setSize(fgui.GRoot.inst.width,fgui.GRoot.inst.height)}}static CheckIn(e,t,s){return t>e.x&&t<e.x+e.width&&s>e.y&&s<e.y+e.height}}ge.top=0,ge.bottom=0,ge._cacheMap=new W,ge.oneUIs=[];class pe{constructor(){this._scaleSmall=.8,this._tweenTime=180,this._layer=l.Panel,this._ifBelongUIMediator=!1,this._belongDownUIMediator=[],this._belongUpUIMediator=[],this._needFilScreen=!1,this._isShow=!1,this._sortOrder=10,this.m_serialNumber=fe.GlobalSerialNumber}get ui(){return this._ui}get serialNumber(){return this.m_serialNumber}get layer(){return this._layer}get ifBelongUIMediator(){return this._ifBelongUIMediator}get belongDownUIMediator(){return this._belongDownUIMediator}get belongUpUIMediator(){return this._belongUpUIMediator}get isShow(){return this._isShow}get isDispose(){return this.ui.isDisposed}set keyId(e){this.m_keyId=e}get keyId(){return this.m_keyId}_InitBottom(){let e=this._ui[c.bottom_group];this._defaultBottomHeight=null==e?0:e.y}_SetBottomDown(e=0){let t=this._ui[c.bottom_group];null!=t&&(t.y=this._defaultBottomHeight+e)}setUIToTopShow(){this._ui&&ge.setUIToTopShow(this._ui,this._layer)}Show(e=null){if(this._isShow)this.setUIToTopShow();else{if(this.OnshowBefore(),this._isShow=!0,this._openParam=e,!this._ui||this._ui&&this._ui.isDisposed){let e=new me;e.needFitScreen=this._needFilScreen,this._ui=ge.AddUI(this._classDefine,e,this._layer),this._layer==l.OneUI&&ge.oneUIs.push(this)}else this.ui.visible=!0;if(this.setUIToTopShow(),this._OnShow(),this._ui.sortingOrder=this._sortOrder,this._ui[c.anim_enter]){this._ui[c.anim_enter].play(Laya.Handler.create(this,this._CallEnterAnimEnd))}else this.OnEnterAnimEnd()}}_CallEnterAnimEnd(){this.OnEnterAnimEnd()}OnEnterAnimEnd(){}OnshowBefore(){}_OnShow(){}Hide(e=!0){if(null!=this._ui&&!this._ui.isDisposed&&this._isShow)if(this._isShow=!1,this.OnHideBefore(),this._ui[c.anim_exit]){this._ui[c.anim_exit].play(Laya.Handler.create(this,this._DoHide,[e]))}else this._DoHide(e)}_DoHide(e){e?this._ui.dispose():this._ui.visible=!1,this._OnHide()}OnHideBefore(){}_OnHide(){}}class fe{static get GlobalSerialNumber(){return this.m_GlobalSerialNumber++,this.m_GlobalSerialNumber}}fe.m_GlobalSerialNumber=0,function(e){e.GameInit="_EEventGlobal_GameInit",e.GameOnInit="_EEventGlobal_GameOnInit",e.GameLoading="_EEventGlobal_GameLoading",e.GameResLoading="_EEventGlobal_GameResLoading"}(d||(d={}));class Ie extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGameLoading")}onConstruct(){this.m_shade=this.getChildAt(0),this.m_text=this.getChildAt(1),this.m_progress=this.getChildAt(2)}}Ie.URL="ui://kk7g5mmmg7a1o";class Se extends pe{constructor(){super(),this._layer=l.Loading}static get instance(){return this.m_instance||(this.m_instance=new Se,this.m_instance._classDefine=Ie),this.m_instance}_OnShow(){K.instance.onGlobal(d.GameLoading,this,this.gameLoading)}gameLoading(e){this.ui.m_progress.value=e}_OnHide(){K.instance.offGlobal(d.GameLoading,this,this.gameLoading)}}class Le extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGameMain")}onConstruct(){this.m_text=this.getChildAt(0)}}Le.URL="ui://kk7g5mmmsyta9f";class ye extends pe{constructor(){super(),this._layer=l.Main}static get instance(){return this.m_instance||(this.m_instance=new ye,this.m_instance._classDefine=Le),this.m_instance}_OnShow(){}_OnHide(){}}class we extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGamePlay")}onConstruct(){this.m_text=this.getChildAt(0)}}we.URL="ui://kk7g5mmmg7a1r";class ve extends pe{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new ve,this.m_instance._classDefine=we),this.m_instance}_OnShow(){}_OnHide(){}}class be extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGameStart")}onConstruct(){this.m_text=this.getChildAt(0)}}be.URL="ui://kk7g5mmmg7a1v";class Ce extends pe{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new Ce,this.m_instance._classDefine=be),this.m_instance}_OnShow(){}_OnHide(){}}!function(e){e.GameLoading="EUI_GameLoading",e.CustomsLoading="EUI_CustomsLoading",e.TestMain="EUI_TestMain",e.TestPlatform="EUI_TestPlatform",e.Main="EUI_Main",e.Set="EUI_Set",e.Pause="EUI_Pause",e.Play="EUI_Play",e.Start="EUI_Start",e.Com="EUI_Com",e.End="EUI_End"}(_||(_={}));class Ae{static Unique(e){return Array.from(new Set(e))}static ReverseReserveUnique(e){return Array.from(new Set(e.reverse())).reverse()}static ObjUnique(e,t){for(let s=0,i=e.length;s<i;s++)for(let i=s+1,a=e.length;i<a;i++)t(e[s])===t(e[i])&&(e.splice(i,1),i--,a--);return e}static Replace(e,t,s){let i=e.indexOf(t);return!(i<0)&&(e.splice(i,1,s),!0)}static RemoveItem(e,t){let s=e.indexOf(t);return!(s<0)&&(e.splice(s,1),!0)}static RemoveAt(e,t){return!(e.length<=t)&&(e.splice(t,1),!0)}static Contains(e,t){return e.indexOf(t)>=0}static Copy(e){let t=[];for(let s=0;s<e.length;++s)t.push(e[s]);return t}static upsetArray(e){e.sort(()=>Math.random()-.5)}}class Ue extends L{constructor(){super(...arguments),this.m_UIMediator={},this.m_onShowUI=[],this.m_ifSetMediatroList=!1}setProxyMediatroList(e){this.m_UIMediator=e,this.m_onShowUI=[],this.m_ifSetMediatroList=!0,this.Init()}Init(){}get ifSetMediatroList(){return this.m_ifSetMediatroList}get onShowUIs(){return this.m_onShowUI}getUIMeiatro(e){return this.m_UIMediator[e]}closeUI(e){this.setUIState([{typeIndex:e.keyId,state:!1}],!1)}setUIState(e,t=!0,s={state:!1,dispose:!0},i){if(!this.m_ifSetMediatroList)return void console.log(...p.packError("还没有为UI代理类设置代理UI调度者列表！"));for(let t of e)void 0===t.state&&(t.state=!0),void 0===t.dispose&&(t.dispose=!0);void 0===s.dispose&&(s.dispose=!0);let a,n=[],o=[];e=Ae.ObjUnique(e,e=>e.typeIndex),this.statesFilter(e);for(let t of e)t.state?(-1!=(a=this.m_onShowUI.findIndex(e=>e.typeIndex==t.typeIndex))&&this.m_onShowUI.splice(a,1),n.push(t)):-1!=(a=this.m_onShowUI.findIndex(e=>e.typeIndex==t.typeIndex))&&(this.m_onShowUI.splice(a,1),o.push(t));if(t){let e=[];for(let t in this.m_UIMediator)-1==n.findIndex(e=>e.typeIndex==t)&&-1==o.findIndex(e=>e.typeIndex==t)&&e.push({typeIndex:t,state:s.state,dispose:s.dispose});s.state?n.unshift(...e):o.push(...e)}else n.unshift(...this.m_onShowUI);void 0!==i&&(Ae.Unique(i),n.filter(e=>-1!=i.findIndex(t=>t==this.m_UIMediator[e.typeIndex].layer)),o.filter(e=>-1!=i.findIndex(t=>t==this.m_UIMediator[e.typeIndex].layer)));for(let e of o)this.m_UIMediator[e.typeIndex].ifBelongUIMediator?console.log(...p.packWarn("注意：有一个附属UI的UI调度者试图被隐藏，KEY为",this.m_UIMediator[e.typeIndex].keyId)):this.hideUIMediator(this.m_UIMediator[e.typeIndex],e.dispose);for(let e of n)this.m_UIMediator[e.typeIndex].ifBelongUIMediator?console.log(...p.packWarn("注意：有一个附属UI的UI调度者试图被显示，KEY为",this.m_UIMediator[e.typeIndex].keyId)):this.showUIMediator(this.m_UIMediator[e.typeIndex]);this.m_onShowUI=n}statesFilter(e){e.filter(e=>void 0!==this.m_UIMediator[e.typeIndex])}hideUIMediator(e,t,s=!1){e.belongUpUIMediator.length>0&&e.belongUpUIMediator.forEach(e=>{this.hideUIMediator(e,t,!0)}),!s||e.ifBelongUIMediator?e.Hide(t):console.log(...p.packWarn("注意：有一个不是附属UI的UI调度者试图被隐藏，KEY为",e.keyId)),e.belongDownUIMediator.length>0&&e.belongDownUIMediator.forEach(e=>{this.hideUIMediator(e,t,!0)})}showUIMediator(e,t=!1){e.belongDownUIMediator.length>0&&e.belongDownUIMediator.forEach(e=>{this.showUIMediator(e,!0)}),!t||e.ifBelongUIMediator?e.Show():console.log(...p.packWarn("注意：有一个不是附属UI的UI调度者试图被显示，KEY为",e.keyId)),e.belongUpUIMediator.length>0&&e.belongUpUIMediator.forEach(e=>{this.showUIMediator(e,!0)})}}class De extends Ue{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new De),this.m_instance}get gameMainMediator(){return this.getUIMeiatro(_.Main)}Init(){K.instance.onGlobal(d.GameLoading,this,this.gameLoading),K.instance.onGlobal(d.GameResLoading,this,this.gameResLoading),K.instance.onUI(h.SceneGameCustomsLoading,this,this.gameCustomsLoading)}Start(){this.setUIState([{typeIndex:_.Main},{typeIndex:_.Start},{typeIndex:_.TestMain}])}gameLoading(){}gameResLoading(){}gameCustomsLoading(e){-1==e&&this.setUIState([{typeIndex:_.CustomsLoading}],!1)}}class Pe extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGameCustomsLoading")}onConstruct(){this.m_shade=this.getChildAt(0),this.m_text=this.getChildAt(1),this.m_progress=this.getChildAt(2)}}Pe.URL="ui://kk7g5mmmdbmi13";class Oe extends pe{constructor(){super(),this._layer=l.Loading}static get instance(){return this.m_instance||(this.m_instance=new Oe,this.m_instance._classDefine=Pe),this.m_instance}_OnShow(){K.instance.onUI(h.SceneGameCustomsLoading,this,this.CustomsLoading)}CustomsLoading(e){this.ui.m_progress.value=e,100==e&&De.instance.setUIState([{typeIndex:_.CustomsLoading,state:!1}],!1)}_OnHide(){K.instance.offUI(h.SceneGameCustomsLoading,this,this.CustomsLoading)}}class Re extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGamePause")}onConstruct(){this.m_text=this.getChildAt(0)}}Re.URL="ui://kk7g5mmm6vcq5g";class Ee extends pe{constructor(){super(),this._layer=l.Pause}static get instance(){return this.m_instance||(this.m_instance=new Ee,this.m_instance._classDefine=Re),this.m_instance}_OnShow(){}_OnHide(){}}class xe extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGameSet")}onConstruct(){this.m_text=this.getChildAt(0)}}xe.URL="ui://kk7g5mmm6vcq4u";class Ge extends pe{constructor(){super(),this._layer=l.Set}static get instance(){return this.m_instance||(this.m_instance=new Ge,this.m_instance._classDefine=xe),this.m_instance}_OnShow(){}_OnHide(){}}class ke extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGameCom")}onConstruct(){this.m_text=this.getChildAt(0)}}ke.URL="ui://kk7g5mmmq3ng9w";class Me extends pe{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new Me,this.m_instance._classDefine=ke),this.m_instance}_OnShow(){}_OnHide(){}}class Ve extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGameEnd")}onConstruct(){this.m_text=this.getChildAt(0)}}Ve.URL="ui://kk7g5mmmlaxd19";class Be extends pe{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new Be,this.m_instance._classDefine=Ve),this.m_instance}_OnShow(){}_OnHide(){}}class Ne extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGameTestMain")}onConstruct(){this.m_test=this.getChildAt(0),this.m_testText=this.getChildAt(1),this.m__test=this.getChildAt(2)}}Ne.URL="ui://kk7g5mmmo9js9x";class Te extends pe{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new Te,this.m_instance._classDefine=Ne),this.m_instance}_OnShow(){this.ui.m_test.onClick(this,this.Test)}Test(){De.instance.setUIState([{typeIndex:_.TestPlatform}],!1)}_OnHide(){}}class He{constructor(){this.appId="",this.appKey="",this.bannerId="",this.rewardVideoId="",this.interstitialId="",this.nativeId="",this.nativeBannerIds=[],this.nativeIconIds=[],this.nativeinterstitialIds=[],this.nativeinpageIds=[],this.shareId=""}}class Fe extends He{constructor(){super(...arguments),this.appId="",this.appKey="",this.bannerId="",this.rewardVideoId="",this.interstitialId="",this.nativeId="",this.nativeBannerIds=[],this.nativeIconIds=[],this.nativeinterstitialIds=[],this.nativeinpageIds=[],this.shareId=""}}class We extends He{constructor(){super(...arguments),this.appId="",this.appKey="",this.bannerId="",this.rewardVideoId="",this.interstitialId="",this.nativeId="",this.nativeBannerIds=[],this.nativeIconIds=[],this.nativeinterstitialIds=[],this.nativeinpageIds=[],this.shareId=""}}class ze extends He{constructor(){super(...arguments),this.appId="",this.appKey="",this.bannerId="",this.rewardVideoId="",this.interstitialId="",this.nativeId="",this.nativeBannerIds=[],this.nativeIconIds=[],this.nativeinterstitialIds=[],this.nativeinpageIds=[],this.shareId=""}}class je extends He{constructor(){super(...arguments),this.appId="",this.appKey="",this.bannerId="",this.rewardVideoId="",this.interstitialId="",this.nativeId="",this.nativeBannerIds=[],this.nativeIconIds=[],this.nativeinterstitialIds=[],this.nativeinpageIds=[],this.shareId=""}}class Je extends He{constructor(){super(...arguments),this.appId="",this.appKey="",this.bannerId="",this.rewardVideoId="",this.interstitialId="",this.nativeId="",this.nativeBannerIds=[],this.nativeIconIds=[],this.nativeinterstitialIds=[],this.nativeinpageIds=[],this.shareId=""}}class Qe extends He{constructor(){super(...arguments),this.appId="",this.appKey="",this.bannerId="",this.rewardVideoId="",this.interstitialId="",this.nativeId="",this.nativeBannerIds=[],this.nativeIconIds=[],this.nativeinterstitialIds=[],this.nativeinpageIds=[],this.shareId=""}}!function(e){e.PAUSE_AUDIO="PAUSE_AUDIO",e.RESUM_AUDIO="RESUM_AUDIO",e.AD_CONFIG_GETTED="AD_CONFIG_GETTED",e.SELF_AD_INITED="SELF_AD_INITED"}(u||(u={})),function(e){e.None="EPlatformType_None",e.Web="EPlatformType_Web",e.WX="EPlatformType_WX",e.TT="EPlatformType_TT",e.QQ="EPlatformType_QQ",e.VIVO="EPlatformType_VIVO",e.OPPO="EPlatformType_OPPO",e.BD="EPlatformType_BD",e.KG="EPlatformType_KG",e.Alipay="EPlatformType_Alipay",e.HW="EPlatformType_HW",e.QTT="EPlatformType_QTT"}(m||(m={}));class qe{static NextFrame(){return this.Frames(2)}static Frames(e){return new Promise(function(t){Laya.timer.frameOnce(e,null,()=>{t()})})}static Seconds(e){return new Promise(function(t){Laya.timer.once(1e3*e,null,()=>{t()})})}}class Ke{Vibrate(e){console.log("调用震动",e),navigator.vibrate?e?navigator.vibrate(400):navigator.vibrate(15):console.log("不支持设备震动！")}}class $e extends Ke{Vibrate(e){console.log("调用震动",e),window.wx&&(e?Laya.timer.callLater(wx,wx.vibrateLong,[null]):Laya.timer.callLater(wx,wx.vibrateShort,[null]))}}class Ze extends L{static get instance(){return null==this._instance&&(this._instance=new Ze),this._instance}get PlatformInstance(){return this.m_platformInstance||console.log(...p.packError("还没有设置过平台实例代理！")),this.m_platformInstance}set PlatformInstance(e){this.m_platformInstance=e}static get platformStr(){return Ze.GetPlatformStr(this._instance.m_platformInstance.platform)}static GetPlatformStr(e){switch(e){case m.None:return"未识别";case m.Web:return"网页";case m.BD:return"百度";case m.OPPO:return"Oppo";case m.QQ:return"QQ";case m.TT:return"头条";case m.VIVO:return"Vivo";case m.WX:return"微信";case m.QTT:return"趣头条";default:return"未定义"+e}}}class Ye{constructor(){this.supportRecord=!1,this.isRecording=!1,this.isPausing=!1,this.isRecordSuccess=!1}StartRecord(e,t){console.log("该平台"+Ze.platformStr+"不支持录制视频")}StopRecord(e){console.log("该平台"+Ze.platformStr+"不支持录制视频")}Pause(e){console.log("该平台"+Ze.platformStr+"不支持录制视频")}Resume(e){console.log("该平台"+Ze.platformStr+"不支持录制视频")}RecordClip(e){console.log("该平台"+Ze.platformStr+"不支持录制视频")}ShareVideo(e,t,s){s&&s.run()}}class Xe{static ToHex(e){return e.toString(16)}static RandomFromArrayExcept(e,t){let s=[];for(let i=0;i<e.length;++i)t!=e[i]&&s.push(e[i]);return this.RandomFromArray(s)}static RandomFromArray(e){return e[Xe.RandomInt(0,e.length)]}static RandomArrayFromArray(e,t){let s=[],i=[];for(let t=0;t<e.length;++t)i.push(t);for(let a=0;a<t;++a){let t=Xe.RandomInt(0,i.length),a=i[t];Ae.RemoveAt(i,t),s.push(e[a])}return s}static RandomFromWithWeight(e,t){if(null==e||0==e.length)return null;var s=0;for(var i of t)s+=i;for(var a=Xe.Random(0,s),n=0,o=0;o<e.length;++o)if(a<(n+=t[o]))return e[o];return e[e.length-1]}static RandomInt(e,t){return Math.floor(this.Random(e,t))}static Random(e,t){return(t-e)*Math.random()+e}static RandomRatio(e){return e>.01*Xe.RandomInt(0,1e4)}static Clamp(e,t,s){return e<t?t:e>s?s:e}static Clamp01(e){return this.Clamp(e,0,1)}static Sign(e){return 0==e?1:e>0?1:-1}static GetNumCount(e){for(var t=0,s=e;s/10>0;)s=Math.floor(s/10),t++;return t}static Lerp(e,t,s){return e+(t-e)*Xe.Clamp01(s)}static MoveTowardsAngle(e,t,s){var i=Xe.DeltaAngle(e,t);return 0-s<i&&i<s?t:(t=e+i,Xe.MoveTowards(e,t,s))}static MoveTowards(e,t,s){return Math.abs(t-e)<=s?t:e+Math.sign(t-e)*s}static DeltaAngle(e,t){var s=Xe.Repeat(t-e,360);return s>180&&(s-=360),s}static Repeat(e,t){return Xe.Clamp(e-Math.floor(e/t)*t,0,t)}static IsSimilar(e,t){return e==t}}Xe.Deg2Rad=.0175,Xe.Rad2Deg=57.2958;class et{}class tt{constructor(){this._shareInfoList=[]}static get instance(){return null==this._instance&&(this._instance=new tt),this._instance}AddShareInfo(e){for(let t of this._shareInfoList)if(t.shareId==e.shareId)return;this._shareInfoList.push(e)}GetShareInfo(e=null){if(0==this._shareInfoList.length){return new et}if(null!=e)for(let t of this._shareInfoList)if(t.shareId==e)return t;return Xe.RandomFromArray(this._shareInfoList)}ShareAppMessage(e){Ze.instance.PlatformInstance.ShareAppMessage(e,Laya.Handler.create(this,()=>{console.log("分享成功")}),null)}}class st{constructor(){this.platform=m.WX,this.safeArea=null,this.recordManager=new Ye,this.device=new $e,this.loginCode=null,this.isSupportJumpOther=!0,this._isBannerLoaded=!1,this._isVideoLoaded=!1,this._isInterstitialLoaded=!1,this._cacheVideoAD=!1,this.NavigateToAppSuccess=null}Init(e){this._base=window.wx,null!=this._base?(this.platformData=e,this.recordManager.Platform=this,this._InitLauchOption(),this._Login(),this._InitShareInfo(),this._InitSystemInfo(),this._CreateBannerAd(),this._CreateVideoAd(),this._CreateInterstitalAd(),window.iplatform=this):console.error(...p.packError("平台初始化错误",Ze.platformStr))}_CheckUpdate(){let e=this._base.getUpdateManager();null!=e&&(e.onCheckForUpdate(function(e){console.log("onCheckForUpdate",e.hasUpdate),e.hasUpdate&&this._base.showToast({title:"即将有更新请留意"})}),e.onUpdateReady(()=>{this._base.showModal({title:"更新提示",content:"新版本已经准备好，是否立即使用？",success:function(t){t.confirm?e.applyUpdate():this._base.showToast({icon:"none",title:"小程序下一次「冷启动」时会使用新版本"})}})}),e.onUpdateFailed(()=>{this._base.showToast({title:"更新失败，下次启动继续..."})}))}_Login(){this.loginState={isLogin:!1,code:""};let e={};e.success=(e=>{this.loginCode=e.code,this._OnLoginSuccess(e),console.error(this.loginState)}),e.fail=(e=>{console.error(Ze.platformStr,"登录失败",e),this.loginState.isLogin=!1,this.loginState.code=""}),e.complete=(()=>{null!=this.onLoginEnd&&this.onLoginEnd.run()}),this._base.login(e)}GetStorage(e){if(this.base&&this.base.getStorageSync&&e)try{return this.base.getStorageSync(e)}catch(e){return console.log("getStorageSync error: ",JSON.stringify(e)),null}}SetStorage(e,t){if(this.base&&this.base.getStorageSync&&e)try{return this.base.setStorageSync(e,t)}catch(e){console.log("setStorageSync error: ",JSON.stringify(e))}}_OnLoginSuccess(e){console.log(Ze.platformStr,"登录成功",e),this.loginState.isLogin=!0,this.loginState.code=e.code}_InitLauchOption(){this._base.onShow(this._OnShow),this._base.onHide(this._OnHide);let e=this._base.getLaunchOptionsSync();this._OnShow(e)}_InitShareInfo(){this._base.showShareMenu({withShareTicket:!0,success:e=>{console.log("InitShareSuccess",e)},fail:e=>{console.log("InitShareFailed",e)},complete:e=>{console.log("InitShareComplete",e)}}),this._base.onShareAppMessage(()=>{let e=tt.instance.GetShareInfo();return st._WrapShareInfo(e)})}static _WrapShareInfo(e){let t={};if(e.shareTitle&&(t.title=e.shareTitle),e.shareImg&&(t.imageUrl=e.shareImg),e.sharePath){t.query={};let s=e.sharePath.split("?")[1].split("&");for(let e of s){let s=e.split("=");t.query[s[0]]=s[1]}}return t}_InitSystemInfo(){this.base=this._base;try{this.systemInfo=this._base.getSystemInfoSync(),console.log("系统信息已获取",this.systemInfo),this.safeArea=this.systemInfo.safeArea,this._cacheScreenScale=this.systemInfo.screenWidth/Laya.stage.width}catch(e){console.error(e),console.error("获取设备信息失败,执行默认初始化"),this.safeArea=null}}_CreateInterstitalAd(){if(Z.IsNullOrEmpty(this.platformData.interstitialId))return void console.log("无有效的插页广告ID,取消加载");this._interstitalFailedCount=0;let e={};e.adUnitId=this.platformData.interstitialId,this._intersitialAd=this._base.createInterstitialAd(e),this._intersitialAd&&(this._intersitialAd.onLoad(()=>{console.log("插页广告加载成功"),this._isInterstitialLoaded=!0}),this._intersitialAd.onError(e=>{this._interstitalFailedCount++,console.error("插页广告加载失败",e),this._interstitalFailedCount>10&&(console.log("第",this._interstitalFailedCount,"次重新加载插页广告"),this._intersitialAd.load())}))}_CreateVideoAd(){if(console.log("vedio ad id",this.platformData.rewardVideoId),!this._cacheVideoAD)return void console.log("当前策略为不缓存视频广告");let e=this._base.createRewardedVideoAd;if(null==e)return void console.error("无createRewardedVideoAd方法,跳过初始化");if(Z.IsNullOrEmpty(this.platformData.rewardVideoId))return void console.log("无有效的视频广告ID,取消加载");this._videoFailedCount=0;let t={};t.adUnitId=this.platformData.rewardVideoId,this._rewardVideo=e(t),this._rewardVideo.onLoad(()=>{console.log("视频广告加载成功"),this._isVideoLoaded=!0}),this._rewardVideo.onError(e=>{this._videoFailedCount++,console.error("视频广告加载失败",e),this._videoFailedCount>10&&(console.log("第",this._videoFailedCount,"次重新加载视频广告"),this._rewardVideo.load())}),this._rewardVideo.onClose(e=>{Laya.stage.event(u.RESUM_AUDIO),console.log("视频回调",e);let t=e.isEnded;qe.NextFrame().then(()=>{t?this._rewardSuccessed&&this._rewardSuccessed.run():this._rewardSkipped&&this._rewardSkipped.run()})})}_CreateBannerAd(){if(Z.IsNullOrEmpty(this.platformData.bannerId))return void console.log("无有效的banner广告ID,取消加载");let e=this._base.getSystemInfoSync().windowWidth,t=this._base.getSystemInfoSync().windowHeight,s={};s.adUnitId=this.platformData.bannerId,s.adIntervals=30;let i={left:0,top:0,width:300};s.style=i,this._bannerAd=this._base.createBannerAd(s),this._isBannerLoaded=!1,this._bannerAd.onLoad(()=>{console.log("banner加载成功"),this._isBannerLoaded=!0,this._bannerAd.style.top=t-this._bannerAd.style.realHeight,this._bannerAd.style.left=(e-this._bannerAd.style.realWidth)/2}),this._bannerAd.onError(e=>{console.error("banner广告加载失败",e)})}IsBannerAvaliable(){return this._isBannerLoaded}IsVideoAvaliable(){return this._isVideoLoaded}IsInterstitalAvaliable(){return this._isInterstitialLoaded}ShowBannerAd(){this.IsBannerAvaliable()&&this._bannerAd.show()}HideBannerAd(){this._bannerAd.hide()}_DoCacheShowVideo(e,t){this._isVideoLoaded?(this._rewardSuccessed=e,this._rewardSkipped=t,this._isVideoLoaded=!1,Laya.stage.event(u.PAUSE_AUDIO),this._rewardVideo.show()):console.error("视频广告尚未加载好")}_DoNoCacheShowVideo(e,t){if(this._rewardSuccessed=e,this._rewardSkipped=t,Z.IsNullOrEmpty(this.platformData.rewardVideoId))return console.log("无有效的视频广告ID,取消加载"),void t.run();let s=this._base.createRewardedVideoAd;if(null==s)return console.error("无createRewardedVideoAd方法,跳过初始化"),void t.run();this._videoFailedCount=0;let i={};i.adUnitId=this.platformData.rewardVideoId,this._rewardVideo&&this._rewardVideo.offClose(this.onVideoClose),this._rewardVideo=s(i),this._rewardVideo.onLoad(()=>{console.log("视频广告加载成功"),this._isVideoLoaded=!0}),this._rewardVideo.onError(e=>{this._videoFailedCount++,console.error("视频广告加载失败",e,this._videoFailedCount)}),this._rewardVideo.onClose(e=>{Laya.stage.event(u.RESUM_AUDIO),console.log("视频回调",e);let t=e.isEnded;qe.NextFrame().then(()=>{t?this._rewardSuccessed&&this._rewardSuccessed.run():this._rewardSkipped&&this._rewardSkipped.run()})}),this._rewardVideo.load().then(()=>(console.log("激励视频 加载成功"),this._rewardVideo.show().then(()=>{}).catch(e=>{console.error(e)})))}onVideoClose(e){Laya.stage.event(u.RESUM_AUDIO),console.log("视频回调",e);let t=e.isEnded;qe.NextFrame().then(()=>{t?this._rewardSuccessed&&this._rewardSuccessed.run():this._rewardSkipped&&this._rewardSkipped.run()})}ShowRewardVideoAd(e,t){this._cacheVideoAD?this._DoCacheShowVideo(e,t):this._DoNoCacheShowVideo(e,t)}ShowRewardVideoAdAsync(){return new Promise(function(e){Ze.instance.PlatformInstance.ShowRewardVideoAd(Laya.Handler.create(this,()=>{e(!0)}),Laya.Handler.create(this,()=>{e(!1)}))})}ShowInterstitalAd(){this._isInterstitialLoaded?this._intersitialAd.show():console.error("插页广告尚未加载好")}GetFromAppId(){return null==this.lauchOption.referrerInfo?null:Z.IsNullOrEmpty(this.lauchOption.referrerInfo.appId)?null:this.lauchOption.referrerInfo.appId}_OnShow(e){console.log(Ze.platformStr,"OnShow",e),Ze.instance.PlatformInstance.lauchOption=e,Ze.instance.PlatformInstance._CheckUpdate(),this.NavigateToAppSuccess=null,qe.NextFrame().then(()=>{Ze.instance.PlatformInstance.onResume&&Ze.instance.PlatformInstance.onResume.runWith(e)})}_OnHide(e){console.log(Ze.platformStr,"OnHide",e),Ze.instance.PlatformInstance.onPause&&Ze.instance.PlatformInstance.onPause.runWith(e),this.NavigateToAppSuccess&&this.NavigateToAppSuccess()}ShareAppMessage(e,t,s){console.log("分享消息",e);let i=st._WrapShareInfo(e);this._base.shareAppMessage(i),t&&t.run()}LoadSubpackage(e,t,s,i){if(null==this._base.loadSubpackage)return console.log("无加载子包方法,跳过加载子包",e),void(t&&t.run());let a={};a.name=e,a.success=(()=>{console.log("分包加载成功",e),t&&t.run()}),a.fail=(()=>{console.error("分包加载失败",e),s&&s.run()}),this._base.loadSubpackage(a).onProgressUpdate(e=>{Laya.Browser.onMobile&&console.log("分包加载进度",e),i&&i.runWith(e.progress/100)})}RecordEvent(e,t){console.log("记录事件",e,t);let s=this._base.aldSendEvent;null!=s?null!=t?s(e,t):s(e):console.error("阿拉丁sdk尚未接入,请检查配置")}CreateShareVideoBtn(e,t,s,i){let a={};a.style={left:e*this._cacheScreenScale,top:t*this._cacheScreenScale,height:i*this._cacheScreenScale,width:s*this._cacheScreenScale},a.share={query:{tick:1},bgm:"",timeRange:[0,6e4]},null==this._shareVideoBtn?this._shareVideoBtn=this._base.createGameRecorderShareButton(a):this._shareVideoBtn.show()}HideShareVideoBtn(){null!=this._shareVideoBtn&&this._shareVideoBtn.hide()}ShowToast(e){this._base.showToast({title:e,duration:2e3})}OpenGameBox(e){console.error("当前平台",Ze.platformStr,"暂不支持互推游戏盒子")}NavigateToApp(e,t,s,i,a,n){return new Promise((i,a)=>{wx.navigateToMiniProgram({appId:e,path:t,extraData:s,envVersion:"",success:e=>{console.log("小游戏跳转成功",e),i(!0)},fail:()=>{console.log("小游戏跳转失败："),a(!1)},complete:()=>{}})})}createShortcut(){console.log("暂未实现")}}class it extends st{constructor(){super(...arguments),this.platform=m.BD,this._showVideoLoad=!1}Init(e){this._base=window.swan,null!=this._base?(this.platformData=e,this.recordManager.Platform=this,this._InitLauchOption(),this._InitShareInfo(),this._InitSystemInfo(),this._isBannerLoaded=!1,this._isBannerShowed=!1,this._CreateVideoAd(),this._CreateInterstitalAd(),window.iplatform=this):console.error(...p.packError("平台初始化错误"))}_CreateBannerAd(){if(Z.IsNullOrEmpty(this.platformData.bannerId))return void console.log("无有效的banner广告ID,取消加载");let e=this._base.getSystemInfoSync().windowWidth,t=this._base.getSystemInfoSync().windowHeight,s={};s.adUnitId=this.platformData.bannerId,s.appSid=this.platformData.sid;let i={left:0,top:0};i.width=e,s.style=i,this._bannerAd=this._base.createBannerAd(s),this._bannerAd.onLoad(()=>{console.log("banner加载成功"),this._isBannerLoaded=!0,this._bannerAd.style.top=t-this._bannerAd.style.height,this._bannerAd.show()}),this._bannerAd.onError(e=>{console.error("banner广告加载失败",e)})}_CreateVideoAd(){if(Z.IsNullOrEmpty(this.platformData.rewardVideoId))return void console.log("无有效的视频广告ID,取消加载");this._videoFailedCount=0;let e={};e.adUnitId=this.platformData.rewardVideoId,e.appSid=this.platformData.sid,this._rewardVideo=this._base.createRewardedVideoAd(e),this._rewardVideo.onLoad(()=>{console.log("视频广告加载成功"),this._isVideoLoaded=!0}),this._rewardVideo.onError(e=>{this._videoFailedCount++,console.error("视频广告加载失败",e),this._videoFailedCount>10&&(console.log("第",this._videoFailedCount,"次重新加载视频广告"),this._rewardVideo.load())}),this._rewardVideo.onClose(e=>{this._base.hideLoading(),Laya.stage.event(u.RESUM_AUDIO),console.log("视频回调",e),e.isEnded?this._rewardSuccessed&&this._rewardSuccessed.run():this._rewardSkipped&&this._rewardSkipped.run(),this._rewardVideo.load()})}_CreateInterstitalAd(){}LoadSubpackage(e,t,s,i){let a={};a.name=e,a.success=(()=>{console.log("分包加载成功",e),t&&t.run()}),a.fail=(()=>{console.error("分包加载失败",e),s&&s.run()}),this._base.loadSubpackage(a).onProgressUpdate(e=>{if(i){let t=e.progress/100;isNaN(t)&&(t=e.loaded/e.total),i.runWith(t)}})}RecordEvent(e,t){this._base.reportAnalytics(e,t)}ShowBannerAd(){this._isBannerLoaded||this._CreateBannerAd()}HideBannerAd(){this._isBannerLoaded&&(this._isBannerLoaded=!1,this._bannerAd&&this._bannerAd.destroy())}}class at extends Ye{constructor(){super(...arguments),this.supportRecord=!1}ShareVideo(e,t,s){this.supportRecord?(console.log("强制模拟成功"),e&&e.run()):(console.log("强制模拟失败"),s&&s.run())}}class nt{constructor(){this.platform=m.Web,this.safeArea=null,this.recordManager=new at,this.device=new Ke,this.systemInfo=null,this.isSupportJumpOther=!0}Init(e){this.loginState={isLogin:!1,code:null},this.recordManager.Platform=this,Laya.timer.once(500,this,this._FakeLoginEnd)}_FakeLoginEnd(){this.onLoginEnd&&this.onLoginEnd.run()}IsBannerAvaliable(){return!1}IsVideoAvaliable(){return!0}IsInterstitalAvaliable(){return!1}ShowBannerAd(){console.log("调用ShowBannerAd")}HideBannerAd(){console.log("调用HideBannerAd")}ShowRewardVideoAd(e,t){console.log("调用ShowRewardVideoAd"),e.run()}ShowRewardVideoAdAsync(){return new Promise(function(e){Ze.instance.PlatformInstance.ShowRewardVideoAd(Laya.Handler.create(this,()=>{e(!0)}),Laya.Handler.create(this,()=>{e(!1)}))})}ShowInterstitalAd(){console.log("调用ShowInterstitalAd")}GetFromAppId(){return null}ShareAppMessage(e,t=null,s=null){console.log("分享消息",e),t&&t.run()}LoadSubpackage(e,t,s){t&&t.run()}RecordEvent(e,t){console.log("记录事件",e,t)}ShareVideoInfo(){console.log(Ze.platformStr,"暂未实现录屏功能")}_CheckUpdate(){}ShowToast(e){console.log("显示消息：",e)}OpenGameBox(){console.error("当前平台",Ze.platformStr,"暂不支持互推游戏盒子")}NavigateToApp(e,t,s){return new Promise((t,s)=>{console.error("当前平台",Ze.platformStr,`暂不支持小程序跳转appid:${e}`),t(!1)})}createShortcut(){console.log("创建桌面图标")}GetStorage(e){return console.log("读本地存储"),Laya.LocalStorage.getItem(e)}SetStorage(e,t){console.log("写本地存储"),Laya.LocalStorage.setItem(e,t)}}var ot,rt,ht,ct,lt,dt,_t,ut,mt,gt,pt;function __awaiter(e,t,s,i){return new(s||(s=Promise))(function(a,n){function fulfilled(e){try{step(i.next(e))}catch(e){n(e)}}function rejected(e){try{step(i.throw(e))}catch(e){n(e)}}function step(e){e.done?a(e.value):new s(function(t){t(e.value)}).then(fulfilled,rejected)}step((i=i.apply(e,t||[])).next())})}class ft extends st{constructor(){super(...arguments),this.platform=m.OPPO,this.safeArea=null,this.recordManager=new Ye,this.device=new Ke,this.isSupportJumpOther=!0,this._isBannerLoaded=!1,this._isVideoLoaded=!1,this._isInterstitialLoaded=!1,this._isInterstitialCanShow=!0,this._nativeAdLoaded=!1,this._cacheVideoAD=!1}Init(e){this._base=window.qg,null!=this._base?(this.platformData=e,this.recordManager.Platform=this,this._InitLauchOption(),this._Login(),this._InitSystemInfo(),this.getSystemInfo(),this.systemInfo.platformVersion>=1051||this._base.initAdService({appId:e.appId,isDebug:!0,success:()=>{console.log("oppo广告","初始化广告服务成功",e),this._CreateVideoAd()},fail:()=>{console.error("oppo广告","初始化广告服务失败")}}),window.iplatform=this):console.error(...p.packError("平台初始化错误",Ze.platformStr))}getSystemInfo(){this._base.getSystemInfo({success:e=>{this.systemInfo=e,console.log(this.systemInfo)},fail:()=>{},complete:()=>{}})}reportMonitor(){console.log("oppo上报数据",this.systemInfo),this.systemInfo&&this.systemInfo.platformVersion>=1060&&this._base.reportMonitor("game_scene",0)}_CheckUpdate(){}_Login(){this.loginState={isLogin:!1,code:""};let e={};e.success=(e=>{this._OnLoginSuccess(e)}),e.fail=(e=>{console.error(Ze.platformStr,"登录失败",e),this.loginState.isLogin=!1,this.loginState.code=""}),e.complete=(e=>{null!=this.onLoginEnd&&this.onLoginEnd.run()}),this._base.login(e)}_OnLoginSuccess(e){console.log(Ze.platformStr,"登录成功",e),this.loginState.isLogin=!0,this.loginState.code=e.token}ShareAppMessage(e,t,s){}_InitLauchOption(){this._base.onShow(this._OnShow),this._base.onHide(this._OnHide);let e=this._base.getLaunchOptionsSync();this._OnShow(e)}canCreateShortcut(){return new Promise((e,t)=>{qg.hasShortcutInstalled({success:function(t){e(t)},fail:function(e){t()},complete:function(){}})})}createShortcut(){return new Promise((e,t)=>{qg.hasShortcutInstalled({success:function(s){0==s?qg.installShortcut({success:function(){e()},fail:function(e){t()},complete:function(){}}):e()},fail:function(e){t()},complete:function(){}})})}_CreateInterstitalAd(){}_CreateVideoAd(){if(!this._cacheVideoAD)return void console.log("当前策略为不缓存视频广告");let e=this._base.createRewardedVideoAd;if(null==e)return void console.error("无createRewardedVideoAd方法,跳过初始化");if(Z.IsNullOrEmpty(this.platformData.rewardVideoId))return void console.log("无有效的视频广告ID,取消加载");this._videoFailedCount=0;let t={};t.adUnitId=this.platformData.rewardVideoId,this._rewardVideo=e(t),this._rewardVideo.onLoad(()=>{console.log("视频广告加载成功"),this._isVideoLoaded=!0}),this._rewardVideo.onError(e=>{this._videoFailedCount++,console.error("视频广告加载失败",e),this._videoFailedCount>10&&(console.log("第",this._videoFailedCount,"次重新加载视频广告"),this._rewardVideo.load())}),this._rewardVideo.onClose(e=>{Laya.stage.event(u.RESUM_AUDIO),console.log("视频回调",e);let t=e.isEnded;qe.NextFrame().then(()=>{t?this._rewardSuccessed&&this._rewardSuccessed.run():this._rewardSkipped&&this._rewardSkipped.run()})})}IsBannerAvaliable(){return this._isBannerLoaded}IsVideoAvaliable(){return this._isVideoLoaded}IsInterstitalAvaliable(){return!1}IsNativeAvaliable(){return this._nativeAdLoaded}ShowBannerAd(){return __awaiter(this,void 0,void 0,function*(){if(Z.IsNullOrEmpty(this.platformData.bannerId))return void console.log("无有效的banner广告ID,取消加载");if(this._bannerAd)return this._bannerAd.show(),void console.log("展示已有banner");this.HideBannerAd(),this._bannerAd=this._base.createBannerAd({adUnitId:this.platformData.bannerId});let e=!0,t=!1;for(this._bannerAd.show().then(s=>{console.log("banner加载成功",s),0==s.code&&(t=!0),e=!1}).catch(t=>{console.error("banner加载失败",t),e=!1});e;)yield qe.NextFrame();if(!t){console.log("banner展示失败,展示native广告"),this._bannerAd&&(this._bannerAd.destroy(),this._bannerAd=null);for(let e=0;e<this.platformData.nativeIconIds.length;++e){if(yield this._ShowNativeBanner(e))break;this._bannerAd.destroy()}}})}_ShowNativeBanner(e){return __awaiter(this,void 0,void 0,function*(){let t=this.base.createNativeAd({adUnitId:this.platformData.nativeBannerIds[e]});this._bannerAd=t;let s=yield t.load();if(0==s.code){let e=s.adList;return null==e||0==e.length?(console.error("native banner加载失败",s),!1):null!=e[0]||(console.error("native banner加载失败",s),!1)}return console.error("native banner加载失败",s),!1})}HideBannerAd(){this._bannerAd&&(this._bannerAd.destroy(),this._bannerAd=null)}ShowNativeAd(){return __awaiter(this,void 0,void 0,function*(){this.IsNativeAvaliable()})}HideNativeAd(){this.IsNativeAvaliable()}_DoCacheShowVideo(e,t){this._isVideoLoaded?(this._rewardSuccessed=e,this._rewardSkipped=t,this._isVideoLoaded=!1,Laya.stage.event(u.PAUSE_AUDIO),this._rewardVideo.show()):console.error("视频广告尚未加载好")}_DoNoCacheShowVideo(e,t){if(this._rewardSuccessed=e,this._rewardSkipped=t,Z.IsNullOrEmpty(this.platformData.rewardVideoId))return console.log("无有效的视频广告ID,取消加载"),void(this._rewardSkipped&&this._rewardSkipped.run());let s=this._base.createRewardedVideoAd;if(null==s)return console.error("无createRewardedVideoAd方法,跳过初始化"),void(this._rewardSkipped&&this._rewardSkipped.run());this._rewardVideo&&this._rewardVideo.destroy();let i={};i.adUnitId=this.platformData.rewardVideoId,this._rewardVideo=s(i),console.log("广告创建完成",i),this._rewardVideo.onClose(e=>{Laya.stage.event(u.RESUM_AUDIO),console.log("视频回调",e);let t=e.isEnded;qe.NextFrame().then(()=>{t?this._rewardSuccessed&&this._rewardSuccessed.run():this._rewardSkipped&&this._rewardSkipped.run()})}),this._rewardVideo.onError(e=>{console.log("广告组件出现问题",e),this._rewardSkipped&&this._rewardSkipped.run()}),this._rewardVideo.onLoad(e=>{console.log("广告加载成功",e)}),this._rewardVideo.load().then(()=>{this._rewardVideo.show()})}ShowRewardVideoAd(e,t){this._cacheVideoAD?this._DoCacheShowVideo(e,t):this._DoNoCacheShowVideo(e,t)}ShowRewardVideoAdAsync(){return new Promise(function(e){Ze.instance.PlatformInstance.ShowRewardVideoAd(Laya.Handler.create(this,()=>{e(!0)}),Laya.Handler.create(this,()=>{e(!1)}))})}_DisableInterstitalAd(){return __awaiter(this,void 0,void 0,function*(){this._isInterstitialCanShow=!1,yield qe.Seconds(60),this._isInterstitialCanShow=!0})}GetFromAppId(){return null==this.lauchOption.referrerInfo?null:Z.IsNullOrEmpty(this.lauchOption.referrerInfo.appId)?null:this.lauchOption.referrerInfo.appId}CreatShortcut(){return new Promise((e,t)=>{qg.hasShortcutInstalled({success:function(s){0==s?qg.installShortcut({success:function(){e()},fail:function(e){t()},complete:function(){}}):e()},fail:function(e){t()},complete:function(){}})})}LoadSubpackage(e,t,s,i){let a={};a.name=e,a.success=(()=>{console.log("分包加载成功",e),t&&t.run()}),a.fail=(()=>{console.error("分包加载失败",e),s&&s.run()}),this._base.loadSubpackage(a).onProgressUpdate(e=>{console.log("分包加载进度",e),i&&i.runWith(e.progress/100)})}RecordEvent(e,t){console.log("[记录事件]",e,t)}CreateShareVideoBtn(e,t,s,i){}HideShareVideoBtn(){null!=this._shareVideoBtn&&this._shareVideoBtn.hide()}ShowToast(e){this._base.showToast({title:e,duration:2e3})}OpenGameBox(e){console.error("当前平台",Ze.platformStr,"暂不支持互推游戏盒子")}NavigateToApp(e,t,s){return new Promise((i,a)=>{Laya.Browser.window.qg.navigateToMiniGame({pkgName:e,path:t,extraData:s,success:function(){i(!0),console.log("oppo小游戏跳转成功")},fail:function(e){a(!1),console.log("oppo小游戏跳转失败：",JSON.stringify(e))}})})}}class It extends st{constructor(){super(...arguments),this.platform=m.QQ,this.isBannerShowing=!1}Init(e){this._base=window.qq,null!=this._base?(this.platformData=e,this.recordManager.Platform=this,this._InitLauchOption(),this._Login(),this._InitShareInfo(),this._InitSystemInfo(),this._CreateBannerAd(),this._CreateVideoAd(),this._CreateInterstitalAd(),window.iplatform=this,console.error("平台初始化完成",Ze.platformStr)):console.error(...p.packError("平台初始化错误",Ze.platformStr))}_InitSystemInfo(){try{let e=this._base.getSystemInfoSync();this._cacheScreenScale=e.screenWidth/Laya.stage.width,this.safeArea={},this.safeArea.width=e.windowWidth,this.safeArea.height=e.windowHeight,this.safeArea.top=e.statusBarHeight,this.safeArea.bottom=0,console.log("QQ覆写_InitSystemInfo",this.safeArea)}catch(e){console.error(e),console.error("获取设备信息失败,执行默认初始化"),this.safeArea=null}}_CreateBannerAd(e){if(Z.IsNullOrEmpty(this.platformData.bannerId))return void console.log("无有效的banner广告ID,取消加载");let t=this._base.getSystemInfoSync().windowWidth,s=this._base.getSystemInfoSync().windowHeight,i={};i.adUnitId=this.platformData.bannerId;let a={};a.top=s-80,a.width=300,a.left=(t-a.width)/2,i.style=a,this._bannerAd=this._base.createBannerAd(i),this._isBannerLoaded=!1,this._bannerAd.onLoad(()=>{console.log("qq banner加载成功",this._bannerAd),this._isBannerLoaded=!0,e&&this._bannerAd.show()}),this._bannerAd.onError(e=>{console.error("banner广告加载失败",e)}),this._bannerAd.onResize(e=>{console.log("onResize",e),this._bannerAd.style.top=s-80,this._bannerAd.style.left=(t-300)/2,console.log("onResize",this._bannerAd)})}IsBannerAvaliable(){return this._isBannerLoaded}IsVideoAvaliable(){return this._isVideoLoaded}IsInterstitalAvaliable(){return this._isInterstitialLoaded}ShowBannerAd(){this.IsBannerAvaliable()&&(this._bannerAd.show(),this.isBannerShowing=!0,Laya.timer.loop(15e3,this,this.refreshBanner))}refreshBanner(){this.isBannerShowing&&(console.log("refresh banner"),this._bannerAd.hide(),this._CreateBannerAd(!0))}HideBannerAd(){this.IsBannerAvaliable()&&(this._bannerAd&&(this._bannerAd.hide(),Laya.timer.clear(this,this.refreshBanner),this.isBannerShowing=!1),this._CreateBannerAd())}_DoCacheShowVideo(e,t){this._isVideoLoaded?(this._rewardSuccessed=e,this._rewardSkipped=t,this._isVideoLoaded=!1,Laya.stage.event(u.PAUSE_AUDIO),this._rewardVideo.show()):console.error("视频广告尚未加载好")}_DoNoCacheShowVideo(e,t){if(this._rewardSuccessed=e,this._rewardSkipped=t,!this._isVideoLoaded||!this._rewardVideo){if(Z.IsNullOrEmpty(this.platformData.rewardVideoId))return console.log("无有效的视频广告ID,取消加载"),void t.run();let e=this._base.createRewardedVideoAd;if(null==e)return console.error("无createRewardedVideoAd方法,跳过初始化"),void t.run();this._videoFailedCount=0;let s={};s.adUnitId=this.platformData.rewardVideoId,this._rewardVideo=e(s),this._rewardVideo.onLoad(()=>{console.log("视频广告加载成功"),this._isVideoLoaded=!0}),this._rewardVideo.onError(e=>{this._videoFailedCount++,console.error("视频广告加载失败",e,this._videoFailedCount)}),this._rewardVideo.onClose(e=>{Laya.stage.event(u.RESUM_AUDIO),console.log(" NoCache - 视频回调",e);let t=e.isEnded;console.log("noCache---",t,"----",!!this._rewardSuccessed,"-----",!!this._rewardSkipped),t?this._rewardSuccessed&&this._rewardSuccessed.run():this._rewardSkipped&&this._rewardSkipped.run()})}this._rewardVideo.show().then(()=>{}).catch(e=>{console.log("广告组件出现问题",e),this._rewardVideo.load().then(()=>(console.log("手动加载成功"),this._rewardVideo.show().then(()=>{})))})}ShowRewardVideoAd(e,t){this._cacheVideoAD?this._DoCacheShowVideo(e,t):this._DoNoCacheShowVideo(e,t)}ShowRewardVideoAdAsync(){return new Promise(function(e){Ze.instance.PlatformInstance.ShowRewardVideoAd(Laya.Handler.create(this,()=>{e(!0)},null,!0),Laya.Handler.create(this,()=>{e(!1)},null,!0))})}ShowInterstitalAd(){this._isInterstitialLoaded?this._intersitialAd.show():console.error("插页广告尚未加载好")}OpenGameBox(e=[]){this.showAppBox()}showAppBox(){this.appBox&&this.appBox.show()}createAppBox(e){this.appBox||(this.appBox=this._base.createAppBox({adUnitId:""})),this.appBox.load().then(()=>{e&&this.appBox.show()}),this.appBox.onClose(()=>{console.log("关闭盒子")})}hideAppBox(){this.appBox&&this.appBox.destroy()}showBlockAd(e=1){let t={adUnitId:"",style:{left:55,top:Laya.stage.height/2},size:e,orientation:"vertical"};this.blockAd=this._base.createBlockAd(t),this.blockAd.onLoad(()=>{console.log("积木广告加载完成"),this.blockAd.show().then(()=>{console.log("积木展示成功")}).catch(e=>{console.error("积木展示失败",e)})}),this.blockAd.onError(e=>{console.error("积木广告加载错误",e)}),this.blockAd.onResize(e=>{console.log("积木resize",e)})}hideBlockAd(){this.blockAd&&(this.blockAd.hide(),this.blockAd.destroy())}}class St extends st{constructor(){super(...arguments),this.platform=m.QTT}Init(e){this._base=window.qttGame,null!=this._base?(this.platformData=e,this.recordManager.Platform=this,window.iplatform=this):console.error(...p.packError("平台初始化错误"))}IsBannerAvaliable(){return!0}ShowBannerAd(){this._base.showBanner({index:1})}HideBannerAd(){this._base.hideBanner()}IsVideoAvaliable(){return!0}ShowRewardVideoAd(e,t){let s={index:1,gametype:1,rewardtype:1,data:{}};s.data.title="获得奖励",Laya.stage.event(u.PAUSE_AUDIO),this._base.showVideo(s=>{Laya.stage.event(u.RESUM_AUDIO),1==s?e&&e.run():t&&t.run()},s)}ShowInterstitalAd(){this.ShowHDReward()}ShowHDReward(){let e={index:1,rewardtype:1};this._base.showHDReward(e)}RecordEvent(e,t){console.log("记录事件",e,t)}}class Lt extends Ke{constructor(e){super(),this._base=e}Vibrate(e){console.log("调用震动",e),e?this._base.vibrateLong({success(e){},fail(e){console.error("调用震动失败",e)},complete(e){}}):this._base.vibrateShort({success(e){},fail(e){console.error("调用震动失败",e)},complete(e){}})}}class yt extends Ye{constructor(e){super(),this.supportRecord=!0,this._base=e,this.isRecording=!1,this.isRecordSuccess=!1,this.isPausing=!1,this._nativeManager=this._base.getGameRecorderManager(),this._nativeManager.onStart(e=>{console.log("平台开始录制",e),this.isRecording=!0,this.isRecordSuccess=!1,this._cacheStartHandle&&this._cacheStartHandle.run()}),this._nativeManager.onStop(e=>{console.log("平台停止录制",e),this.videoSavePath=e.videoPath,this.isRecording=!1,this.isRecordSuccess=!0,this._cacheStopHandle?this._cacheStopHandle.run():this._cacheOverTimeHandle&&this._cacheOverTimeHandle.run()}),this._nativeManager.onError(e=>{console.log("录制发生错误",e),this.isRecordSuccess=!1,this.isRecording=!1}),this._nativeManager.onPause(e=>{console.log("暂停录制视频",e),this.isPausing=!0,this._cachePauseHandle&&this._cachePauseHandle.run()}),this._nativeManager.onResume(e=>{console.log("暂停录制视频",e),this.isPausing=!1,this._cacheResumeHandle&&this._cacheResumeHandle.run()})}StartRecord(e,t){console.log("调用开始录屏"),this._cacheStartHandle=e,this._cacheOverTimeHandle=t,this._cacheStopHandle=null,this._nativeManager.start({duration:300})}Pause(e){this.isRecording?this.isPausing?console.log("当前录制状态已暂停"):(console.log("调用暂停录制"),this._cachePauseHandle=e,this._nativeManager.pause()):console.error("当前未开始录制,无法暂停录制")}Resume(e){this.isRecording?this.isPausing?(console.log("调用恢复录制"),this._cacheResumeHandle=e,this._nativeManager.resume()):console.log("当前录制状态正在进行中"):console.error("当前未开始录制,无法恢复录制")}RecordClip(e){this.isRecording?this.isPausing?console.log("当前录制状态已暂停,无法记录精彩时刻"):null==e?this._nativeManager.recordClip({}):this._nativeManager.recordClip({timeRange:e}):console.error("当前未开始录制,无法记录精彩时刻")}StopRecord(e){console.log("调用结束录屏"),this._cacheStopHandle=e,this._nativeManager.stop()}ShareVideo(e,t,s){if(this.isRecordSuccess){let s={channel:"video",title:"",desc:"",imageUrl:"",templateId:this.Platform.platformData.shareId,query:"",extra:{videoPath:this.videoSavePath,videoTopics:["抖音小游戏","猫眼金币跑酷"]},success(){e&&e.run()},fail(e){t&&t.run()}};this._base.shareAppMessage(s)}else console.log("无视频可以分享"),s&&s.run()}}class wt extends st{constructor(){super(...arguments),this.platform=m.TT,this._showVideoLoad=!1}Init(e){if(this._base=window.tt,null==this._base)return void console.error(...p.packError("平台初始化错误"));this.platformData=e;let t=this._base.getSystemInfoSync();"ios"==t.platform&&(this.isSupportJumpOther=!1);let[s,i]=t.SDKVersion.split(".");s>=1&&i>=33||(this.isSupportJumpOther=!1),this._InitLauchOption(),this._InitShareInfo(),this._InitSystemInfo(),this._CreateBannerAd(),this._CreateVideoAd(),this._CreateInterstitalAd(),this.recordManager=new yt(this._base),this.recordManager.Platform=this,this.device=new Lt(this._base),window.iplatform=this}_CreateBannerAd(){if(Z.IsNullOrEmpty(this.platformData.bannerId))return void console.log("无有效的banner广告ID,取消加载");let e=this._base.getSystemInfoSync().windowWidth,t=this._base.getSystemInfoSync().windowHeight,s={};s.adUnitId=this.platformData.bannerId,s.adIntervals=30;let i={left:0,top:0};i.width=e,s.style=i,this._bannerAd=this._base.createBannerAd(s),this._isBannerLoaded=!1,this._bannerAd&&(this._bannerAd.onLoad(()=>{console.log("banner加载成功",this._bannerAd),this._isBannerLoaded=!0}),this._bannerAd.onError(e=>{console.error("banner广告加载失败",e),this._bannerAd}),this._bannerAd.onResize(s=>{this._bannerAd.style.top=t-s.height,this._bannerAd.style.left=(e-s.width)/2}))}RecordEvent(e,t){let s=this._base.reportAnalytics;s?(null==t&&(t={}),s(e,t)):console.error("reportAnalytics 方法不存在")}ShowBannerAd(){this.IsBannerAvaliable()&&this._bannerAd.show()}ShareAppMessage(e,t,s){console.log("分享消息",e);let i=st._WrapShareInfo(e);i.success=(()=>{t&&t.run()}),i.fail=(()=>{s&&s.run()}),this._base.shareAppMessage(i)}OpenGameBox(e){let t=[];for(let s=0;s<e.length;++s)t.push({appId:e[s]});this._base.showMoreGamesModal({appLaunchOptions:t})}NavigateToApp(e,t,s){return new Promise((t,s)=>{this.isSupportJumpOther?this._base.showMoreGamesModal({appLaunchOptions:[{appId:this.platformData.appId,query:"foo=bar&baz=qux",extraData:{}}],success(s){t(!0),console.log("跳转小游戏成功",e)},fail(t){s(!1),console.log("跳转小游戏失败",e)}}):(s(!1),console.log("当前平台不支持小游戏跳转",this))})}}class vt{static get instance(){return null==this._instance&&(this._instance=new vt),this._instance}static get PlatformInstance(){return this.instance.m_platformInstance||console.log(...p.packError("还没有设置过平台实例代理！")),this.instance.m_platformInstance}init(){if(null!=this.m_platformInstance)return console.error(...p.packError("已调用过平台创建为",Ze.GetPlatformStr(this.m_platformInstance.platform),"不能重复创建")),this.m_platformInstance;let e,t=null!=window.qttGame;null!=window.tt?(e=new wt,this.m_platformData=new Je):Laya.Browser.onMiniGame?(e=new st,this.m_platformData=new Qe):Laya.Browser.onBDMiniGame?(e=new it,this.m_platformData=new Fe):t?(e=new St,this.m_platformData=new je):Laya.Browser.onQQMiniGame?(e=new It,this.m_platformData=new ze):Laya.Browser.onQGMiniGame?(e=new ft,this.m_platformData=new We):(console.log(...p.packWarn("未识别平台,默认创建为web",Laya.Browser.userAgent)),e=new nt),this.m_platformInstance=e,Ze.instance.PlatformInstance=e,window.$Platform=this.m_platformInstance,console.log(...p.packPlatform("平台实例创建完成",Ze.GetPlatformStr(this.m_platformInstance.platform)))}initPlatform(){this.m_platformInstance.Init(this.m_platformData),console.log(...p.packPlatform("平台初始化完成"))}}class bt extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGameTestPlatform")}onConstruct(){this.m_bg=this.getChildAt(0),this.m_lookVAd=this.getChildAt(1),this.m_lookVAdText=this.getChildAt(2),this.m__lookVAd=this.getChildAt(3),this.m_share=this.getChildAt(4),this.m_shareText=this.getChildAt(5),this.m__share=this.getChildAt(6),this.m_showToast=this.getChildAt(7),this.m_showToastText=this.getChildAt(8),this.m__showToast=this.getChildAt(9)}}bt.URL="ui://kk7g5mmmt1pw9y";class Ct extends pe{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new Ct,this.m_instance._classDefine=bt),this.m_instance}_OnShow(){this.ui.m_bg.onClick(this,this.close),this.ui.m_lookVAd.onClick(this,this.lookVAd),this.ui.m_showToast.onClick(this,this.showToast),this.ui.m_share.onClick(this,this.share)}lookVAd(){console.log("看广告测试"),vt.PlatformInstance.ShowRewardVideoAdAsync().then(e=>{console.log("看广告完成测试",e)})}showToast(){console.log("显示消息测试"),vt.PlatformInstance.ShowToast("显示消息测试")}share(){console.log("分享测试"),vt.PlatformInstance.ShareAppMessage({shareId:void 0,shareImg:void 0,sharePath:void 0,shareTitle:"分享消息"},Laya.Handler.create(this,()=>{console.log("分享成功")}),Laya.Handler.create(this,()=>{console.log("分享失败！")}))}close(){De.instance.setUIState([{typeIndex:_.TestPlatform,state:!1}],!1)}_OnHide(){}}class At{constructor(){this.initUIMediator(),this._initUIMediator()}initUIMediator(){}_initUIMediator(){let e,t;this.m_UIMediator||console.log(...p.packWarn("注意！没有注册UI代理类。")),this.m_UIProxy.setProxyMediatroList(this.m_UIMediator);for(let s in this.m_UIMediator)this.m_UIMediator[s].keyId=s,e=[],this.getUIBelongSerialNumber(this.m_UIMediator[s],e),(t=e.length)!=(e=Ae.Unique(e)).length&&console.log(...p.packError("UI调度者",s,"的附属UI有重复出现！"))}getUIBelongSerialNumber(e,t,s=!1){e.belongDownUIMediator.length>0&&e.belongDownUIMediator.forEach(e=>{this.getUIBelongSerialNumber(e,t,!0)}),s?e.ifBelongUIMediator||console.log(...p.packWarn("注意！有一个不是附属的UI调度者被添加进了附属列表中")):e.ifBelongUIMediator&&console.log(...p.packWarn("注意！有一个附属UI调度者被添加进了UI管理器列表中，它将不会被显示。")),t.push(e.serialNumber),e.belongUpUIMediator.length>0&&e.belongUpUIMediator.forEach(e=>{this.getUIBelongSerialNumber(e,t,!0)})}}class Ut extends At{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new Ut),this.m_instance}initUIMediator(){this.m_UIMediator={[_.GameLoading]:Se.instance,[_.CustomsLoading]:Oe.instance,[_.TestMain]:Te.instance,[_.TestPlatform]:Ct.instance,[_.Main]:ye.instance,[_.Set]:Ge.instance,[_.Play]:ve.instance,[_.Start]:Ce.instance,[_.Pause]:Ee.instance,[_.Com]:Me.instance,[_.End]:Be.instance},this.m_UIProxy=De.instance}init(){}Start(){this.m_UIProxy.Start()}}class Dt{constructor(){this.m_GameIfInit=!1}static get instance(){return this.m_instance||(this.m_instance=new Dt),this.m_instance}init(){}get gameIfInit(){return this.m_GameIfInit}GameInit(){this.m_GameIfInit=!1,K.instance.eventGlobal(d.GameInit)}GameOnInit(){this.m_GameIfInit=!0,K.instance.eventGlobal(d.GameOnInit)}}class Pt extends X{}class Ot extends se{clone(){return JSON.parse(JSON.stringify(this))}}class Rt extends se{constructor(){super(...arguments),this.onCustomsData=new Ot}clone(){return JSON.parse(JSON.stringify(this))}}class Et extends Pt{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new Et),this._instance}InitData(){this._shortData=new Rt}static get shortData(){return this._instance._shortData.clone()}static get getEditableOnCustomData(){return this._instance._shortData.onCustomsData}static initShortData(){}static syncShortData(){}static emptyGameOnCustomData(){this._instance._shortData=new Rt}}class xt{constructor(){}static get instance(){return this.m_instance||(this.m_instance=new xt),this.m_instance}init(){K.instance.on3D(r.GameLevelsBuildBefore,this,this.gameLevelsBuildBefore),K.instance.on3D(r.GameLevelsOnBuild,this,this.gameLevelsOnBuild),K.instance.on3D(r.GameLevelsDelete,this,this.gameLevelsDelete),K.instance.on3D(r.GameStart,this,this.gameStart)}gameLevelsBuildBefore(){Et.emptyGameOnCustomData()}gameLevelsOnBuild(){}gameLevelsDelete(){}gameStart(){}}!function(e){e.config=class{},e.path="res/config/TestConst.json"}(ot||(ot={}));class Gt extends D{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new Gt),this._instance}get data(){}initData(){this.m_data=ot.data}get ifDebug(){return!$.OnLine&&this.m_data.if_debug}get ifShowOimoMesh(){return!$.OnLine&&this.m_data.if_show_oimo_mesh}get oimoMeshDiaphaneity(){return this.m_data.oimo_mesh_diaphaneity}}!function(e){e.BGMSuspend="_EEventAudio_BGMSuspend",e.BGMGoOn="_EEventAudio_BGMGoOn",e.SoundSuspend="_EEventAudio_SoundSuspend",e.SoundGoOn="_EEventAudio_SoundGoOn",e.BGMVolumeChange="_EEventAudio_BGMVolumeChange",e.SoundVolumeChange="_EEventAudio_BGMVolumeChange"}(rt||(rt={}));class kt{static music_url(e){return w.instance.getResURL(i.music)+e+".mp3"}static sound_url(e){return w.instance.getResURL(i.sound)+e+".mp3"}static icon_url(e){return w.instance.getResURL(i.icon)+e+".png"}static img_url(e,t="png"){return w.instance.getResURL(i.img)+e+"."+t}static skin_url(e,t="png"){return w.instance.getResURL(i.skin)+e+"."+t}}class Mt{constructor(){this._bgPast=[],this._urlBGM="",this._urlSOUND="",this._sounds=[]}static get instance(){return null==this._instance&&(this._instance=new Mt),this._instance}init(){}playBGM(e,t,s,i){null!=e&&this._bgPast.slice(-1)[0]!=e?(this._bgPast.push(e),this._urlBGM=kt.music_url(e),this._playMusic(t,s,i),console.log(...p.packLog("播放背景音乐",e))):""!=this._urlBGM&&(this._playMusic(t,s,i),console.log(...p.packLog("播放背景音乐",e)))}shiftBGM(e,t,s,i){if(this._bgPast.slice(-1)[0]==e){this._bgPast.pop(),this._bgPast.slice(-1)[0]&&(this._urlBGM=kt.music_url(e),this._playMusic(t,s,i))}}pauseBGM(){Laya.SoundManager.stopMusic(),console.log(...p.packLog("停止播放音乐",this._urlBGM))}pauseSound(){Laya.SoundManager.stopAllSound()}playSound(e,t,s,i,a){this._urlSOUND=kt.sound_url(e);for(let e=0;e<this._sounds.length;e++)if(this._sounds[e]&&this._sounds[e].url.indexOf(this._urlSOUND)>=0){this._sounds[e].stop(),this._sounds.splice(e,1);break}let n=Laya.SoundManager.playSound(this._urlSOUND,t,s,i,a);this._sounds.push(n)}stopSound(e){this._urlSOUND=kt.sound_url(e),Laya.SoundManager.stopSound(this._urlSOUND)}_playMusic(e=0,t,s){Laya.SoundManager.stopMusic(),Laya.SoundManager.playMusic(this._urlBGM,e,t,s)}}class Vt{constructor(){this.m_stop=!1,this.m_onLoopSoundList=new Set}static get instance(){return this.m_instance||(this.m_instance=new Vt),this.m_instance}stopBGM(){Mt.instance.pauseBGM()}BGMGoOn(){this.playBGM(this.m_onBGM)}soundSuspend(){this.m_stop=!0;for(let e of this.m_onLoopSoundList)Mt.instance.stopSound(e)}soundGoOn(){this.m_stop=!1;for(let e of this.m_onLoopSoundList)Mt.instance.playSound(e,0)}playBGM(e,t,s,i){ne.gameData.ifOpenBgm&&!this.m_stop&&(Mt.instance.playBGM(e,t,s,i),this.m_onBGM=e)}playSound(e,t,s,i,a){ne.gameData.ifOpenSound&&!this.m_stop&&(0==t&&this.m_onLoopSoundList.add(e),Mt.instance.playSound(e,t,s,i,a))}stopSound(e){Mt.instance.stopSound(e),this.m_onLoopSoundList.has(e)&&this.m_onLoopSoundList.delete(e)}}class Bt{constructor(){}static get instance(){return null==this._instance&&(this._instance=new Bt),this._instance}init(){K.instance.onAudio(rt.BGMSuspend,this,this.BGMsuSpend),K.instance.onAudio(rt.BGMGoOn,this,this.BGMGoOn),K.instance.onAudio(rt.SoundSuspend,this,this.soundSuspend),K.instance.onAudio(rt.SoundGoOn,this,this.soundGoOn),K.instance.onAudio(rt.BGMVolumeChange,this,this.bgmVolumeChange),K.instance.onAudio(rt.SoundVolumeChange,this,this.soundVolumeChange)}BGMsuSpend(){Vt.instance.stopBGM()}BGMGoOn(){Vt.instance.BGMGoOn()}soundSuspend(){Vt.instance.soundSuspend()}soundGoOn(){Vt.instance.soundGoOn()}bgmVolumeChange(e=1){Laya.SoundManager.setMusicVolume(e)}soundVolumeChange(e=1){Laya.SoundManager.setSoundVolume(e)}}class Nt{constructor(){}static get instance(){return null==this._instance&&(this._instance=new Nt),this._instance}enterGame(){this.initGame(),this._startGame(),this.startGame()}initGame(){Dt.instance.init(),K.instance.init(),Bt.instance.init(),xt.instance.init(),oe.instance.init(),Ut.instance.init(),ue.instance.init()}_startGame(){Gt.instance.ifDebug?Laya.Stat.show():Laya.Stat.hide()}startGame(){Ut.instance.Start(),ue.instance.initLevelBuild()}}class Tt{static get needLoadCount(){return this._configList.length}static AddConfig(e){Tt._configList.push(e)}static AddExtraConfig(e){e.length>0&&(Tt._extraConfig.push(...e),Tt._extraConfig=Ae.Unique(Tt._extraConfig))}static StartLoad(e,t=null){if(0==Tt._configList.length)return void(e&&e.run());var s=[];for(let e of Tt._configList)s.push(v.ConfigURL(e.path.match(/[a-zA-Z0-9.]*$/)[0]));let i=[];s.forEach(e=>{i.push(e)}),s.push(...this._extraConfig),Laya.loader.create(s,Laya.Handler.create(this,()=>{for(let e of Tt._configList){e.data=Laya.loader.getRes(v.ConfigURL(e.path.match(/[a-zA-Z0-9.]*$/)[0])),e.dataList=[];for(let t in e.data){let s=e.data[t];null!=s&&e.dataList.push(s)}e.dataList.length>0&&(e.lastData=e.dataList[e.dataList.length-1])}e&&e.run(),i.forEach(e=>{f.Unload(e)})}),t)}}Tt._configList=[],Tt._extraConfig=[],function(e){e.config=class{},e.path="res/config/GameConst.json"}(ht||(ht={}));class Ht{constructor(e,t=-1,s){this.packPath=e,this.atliasCount=t,this.m_extraURL=s}PushUrl(e){if(e.push({url:this.packPath+".bin",type:Laya.Loader.BUFFER}),this.m_extraURL&&this.m_extraURL.length>0&&e.push(...this.m_extraURL),this.atliasCount>=0){e.push({url:this.packPath+"_atlas0.png",type:Laya.Loader.IMAGE});for(let t=1;t<=this.atliasCount;t++)e.push({url:this.packPath+"_atlas0_"+t+".png",type:Laya.Loader.IMAGE})}}AddPackage(){fgui.UIPackage.addPackage(this.packPath)}}class Ft extends ie{}class Wt extends te{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new Wt),this._instance}static get comData(){return this._instance._saveData}get _saveName(){return"->CommonDataSave<-"}InitData(){this._saveData=this._ReadFromFile()}getNewData(){return new Ft}static SaveToDisk(){this._instance._SaveToDisk(this._instance._saveData)}}class zt{}zt.subpackages=[];class jt{constructor(){this._needLoadOtherUIPack=[],this._loadProgressWeight={config:1,gameRes:5,otherUI:3},this._configProgress=0,this._otherUIProgress=0,this._resProgress=0}get loadProgress(){let e=0;for(let t in this._loadProgressWeight)e+=this._loadProgressWeight[t];return(this._loadProgressWeight.config*this._configProgress+this._loadProgressWeight.gameRes*this._resProgress+this._loadProgressWeight.otherUI*this._otherUIProgress)/e*100}loadSubpackage(){return new Promise(e=>{if(zt.subpackages.length>0){let t=[];for(let e of zt.subpackages)w.instance.editKeyResList(e.name,e.root),e.name&&t.push(new Promise(t=>{vt.PlatformInstance.LoadSubpackage(e.name,Laya.Handler.create(this,()=>{t()}),Laya.Handler.create(this,()=>{t()}),void 0)}));Promise.all(t).then(()=>{e()})}else e()})}__Init(){return new Promise(e=>{vt.instance.init(),vt.instance.initPlatform(),this.loadSubpackage().then(()=>{R.instance.init(),e()})})}Enter(e){this.m_backHandler=e,this.__Init().then(()=>{this.Init()})}_Init(){}Init(){this._Init(),this.initEmptyScreen()}initEmptyScreen(){ge.Init(),this.OnBindUI();let e=[];this._initEmptyScreen.PushUrl(e),0!=e.length?Laya.loader.load(e,Laya.Handler.create(this,this.InitUI)):this.InitUI()}InitUI(){this._initEmptyScreen.AddPackage(),this._OnInitEmptyScreen();let e=[];this._initUiPack.PushUrl(e),0!=e.length?Laya.loader.load(e,Laya.Handler.create(this,this.OnInitUILoaded)):this.OnInitUILoaded()}OnInitUILoaded(){this._initUiPack.AddPackage(),this._OnInitUILoaded(),this.onLoading(this.loadProgress),this.OnConfigLoaded()}OnConfigLoaded(){if(this.OnSetLoadConfig(),Tt.AddExtraConfig(v.EssentialConfigUrl()),Tt.needLoadCount<=0)return this._OnConfigProgress(1),void this._OnConfigLoaded();Tt.StartLoad(Laya.Handler.create(this,this._OnConfigLoaded),Laya.Handler.create(this,this._OnConfigProgress,null,!1))}_OnConfigProgress(e){this._configProgress=e,this.onLoading(this.loadProgress)}_OnConfigLoaded(){R.instance.initConfig();let e=[];for(let t=0;t<this._needLoadOtherUIPack.length;++t)this._needLoadOtherUIPack[t].PushUrl(e);if(0==e.length)return this._OnOtherUIProgress(1),void this._OnOtherUILoaded();Laya.loader.load(e,Laya.Handler.create(this,this._OnOtherUILoaded),Laya.Handler.create(this,this._OnOtherUIProgress,null,!1))}_OnOtherUIProgress(e){this._otherUIProgress=e,this.onLoading(this.loadProgress)}_OnOtherUILoaded(){for(let e=0;e<this._needLoadOtherUIPack.length;++e)this._needLoadOtherUIPack[e].AddPackage();let e=[];if(this.OnGameResPrepared(e),e.push(...v.EssentialOtherResUrl()),R.instance.Preload(e),0==e.length)return this._OnResProgress(1),void this._OnResLoaded();Laya.loader.create(e,Laya.Handler.create(this,this._OnResLoaded),Laya.Handler.create(this,this._OnResProgress,null,!1))}_OnResProgress(e){this._resProgress=e,this.onLoading(this.loadProgress)}_OnResLoaded(){q.InitAll(),this.loginCommonData(),this.loginData(),this.OnComplete(),this.m_backHandler.run()}loginCommonData(){Wt.instance.InitData()}OnBindUI(){}OnSetLoadConfig(){}OnGameResPrepared(e){}_OnInitEmptyScreen(){}_OnInitUILoaded(){}onLoading(e){}loginData(){}OnComplete(){}}!function(e){e.config=class{},e.path="res/config/SkinConfig.json"}(ct||(ct={}));class Jt extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("InitLoad","splash")}onConstruct(){this.m_bg=this.getChildAt(0),this.m_progress=this.getChildAt(1),this.m_loading_progress=this.getChildAt(2),this.m_text_logo=this.getChildAt(3),this.m_text_progress=this.getChildAt(4),this.m_text_laya=this.getChildAt(5),this.m_text_explain=this.getChildAt(6),this.m_text_v=this.getChildAt(7),this.m_text_laya_v=this.getChildAt(8),this.m_text_game_explain=this.getChildAt(9)}}Jt.URL="ui://n3oedpp6nihr0",function(e){e.config=class{},e.path="res/config/GameStateConst.json"}(lt||(lt={}));class Qt{static bindAll(){}}class qt{static bindAll(){fairygui.UIObjectFactory.setPackageItemExtension(xe.URL,xe),fairygui.UIObjectFactory.setPackageItemExtension(Re.URL,Re),fairygui.UIObjectFactory.setPackageItemExtension(Pe.URL,Pe),fairygui.UIObjectFactory.setPackageItemExtension(Ie.URL,Ie),fairygui.UIObjectFactory.setPackageItemExtension(we.URL,we),fairygui.UIObjectFactory.setPackageItemExtension(be.URL,be),fairygui.UIObjectFactory.setPackageItemExtension(Ve.URL,Ve),fairygui.UIObjectFactory.setPackageItemExtension(Ne.URL,Ne),fairygui.UIObjectFactory.setPackageItemExtension(ke.URL,ke),fairygui.UIObjectFactory.setPackageItemExtension(Le.URL,Le),fairygui.UIObjectFactory.setPackageItemExtension(bt.URL,bt)}}class Kt extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("InitEmptyScreen","EmptyScreen")}onConstruct(){this.m_bg=this.getChildAt(0)}}Kt.URL="ui://7ktzib8oq3ng0";class $t{static bindAll(){fairygui.UIObjectFactory.setPackageItemExtension(Kt.URL,Kt)}}class Zt{static bindAll(){fairygui.UIObjectFactory.setPackageItemExtension(Jt.URL,Jt)}}!function(e){e.null=""}(dt||(dt={})),function(e){e.config=class{},e.path="res/config/CameraConst.json"}(_t||(_t={})),function(e){e.config=class{},e.path="res/config/LightingConst.json"}(ut||(ut={}));class Yt extends ie{constructor(){super(...arguments),this.coinCount=0}clone(){return JSON.parse(JSON.stringify(this))}}class Xt extends te{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new Xt),this._instance}get _saveName(){return"->GamePropDataSave<-"}InitData(){this._saveData=this._ReadFromFile()}static get propData(){return this._instance._saveData.clone()}static addCoin(e){this._instance._saveData.coinCount+=e,this._instance._saveData.coinCount<0&&(this._instance._saveData.coinCount=0),this.SaveToDisk()}getNewData(){return new Yt}static SaveToDisk(){this._instance._SaveToDisk(this._instance._saveData)}}class es extends ie{clone(){return JSON.parse(JSON.stringify(this))}}class ts extends te{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new ts),this._instance}get _saveName(){return"->GameSkinData<-"}InitData(){this._saveData=this._ReadFromFile()}static get skinData(){return this._instance._saveData.clone()}getNewData(){return new es}static SaveToDisk(){this._instance._SaveToDisk(this._instance._saveData)}}class ss extends ie{constructor(){super(...arguments),this.ifSignIn=!1,this.ifOneDay=!1}clone(){return JSON.parse(JSON.stringify(this))}}class is extends te{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new is),this._instance}get _saveName(){return"->GameSignDataSave<-"}InitData(){this._saveData=this._ReadFromFile()}static get signData(){return this._instance._saveData.clone()}getNewData(){return new ss}static SaveToDisk(){this._instance._SaveToDisk(this._instance._saveData)}}!function(e){e.config=class{},e.path="res/config/LevelPropConfig.json"}(mt||(mt={})),function(e){e.config=class{},e.path="res/config/OtherConst.json"}(gt||(gt={})),function(e){e.null=""}(pt||(pt={}));class as extends te{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new as),this._instance}get _saveName(){return"->GameNewHandDataSave<-"}InitData(){this._saveData=this._ReadFromFile()}static get propData(){return this._instance._saveData.clone()}getNewData(){return new Yt}static SaveToDisk(){this._instance._SaveToDisk(this._instance._saveData)}}class ns extends jt{_Init(){Dt.instance.GameInit(),this._initEmptyScreen=new Ht(v.FGUIPack("InitEmptyScreen")),this._initUiPack=new Ht(v.FGUIPack("InitLoad"),0),this._needLoadOtherUIPack=[new Ht(v.FGUIPack("GameCommon")),new Ht(v.FGUIPack("GameMain"),0)]}_OnInitEmptyScreen(){this._emptyScreenShowUI=ge.AddUI(Kt,new me,l.Main)}_OnInitUILoaded(){this._emptyScreenShowUI.dispose(),this._loadShowUI=ge.AddUI(Jt,new me,l.Loading),this._loadShowUI.sortingOrder=Number.MAX_SAFE_INTEGER,this._loadShowUI.m_text_explain.text=$.GameWhatTeam,this._loadShowUI.m_text_logo.text=$.GameName_,this._loadShowUI.m_text_v.text=$.versions,this._loadShowUI.m_text_game_explain.text=$.GameExplain,this._loadShowUI.m_text_laya_v.text=Laya.version,this._loadingProgress=this._loadShowUI.m_progress,this._loadingProgressText=this._loadShowUI.m_loading_progress,this._loadingProgress.value=0}OnBindUI(){$t.bindAll(),Zt.bindAll(),Qt.bindAll(),qt.bindAll()}OnSetLoadConfig(){Tt.AddConfig(_t),Tt.AddConfig(o),Tt.AddConfig(ht),Tt.AddConfig(lt),Tt.AddConfig(n),Tt.AddConfig(mt),Tt.AddConfig(ut),Tt.AddConfig(gt),Tt.AddConfig(ct),Tt.AddConfig(ot)}loginData(){ne.instance.InitData(),as.instance.InitData(),Xt.instance.InitData(),ts.instance.InitData(),is.instance.InitData(),Et.instance.InitData()}OnGameResPrepared(e){let t;for(let s in pt)""!=(t=pt[s])&&e.push(kt.music_url(t));for(let s in dt)""!=(t=dt[s])&&e.push(kt.sound_url(t))}onLoading(e){this._loadingProgress.value=e,this._loadingProgressText.text=Math.floor(e).toString()+"%"}OnComplete(){this._loadShowUI.dispose(),Dt.instance.GameOnInit()}}class os{constructor(){}static get instance(){return null==this._instance&&(this._instance=new os),this._instance}enterGame(){this.initGame()}initGame(){}}class rs{constructor(){this.startTest()}startTest(){}}class hs extends rs{startTest(){console.log("->开启测试<-"),console.log(...p.packLog("输出测试")),console.log(...p.packWarn("输出测试")),console.log(...p.packError("输出测试"))}}class cs extends rs{startTest(){new hs}}class ls extends rs{startTest(){this.asyncTest()}asyncTest(){return __awaiter(this,void 0,void 0,function*(){console.log("异步开始"),yield this._asyncTest(),console.log("异步结束")})}_asyncTest(){return new Promise(e=>{Laya.timer.once(1e3,this,()=>{console.log("异步函数执行中"),e()})})}}class ds extends rs{static get instance(){return this._instance?this._instance:(this._instance=new ds,this._instance)}start(e){}}class _s extends rs{startTest(){new ls,new ds}}class us{constructor(){this.upGameLoad(),this.gameLoad()}upGameLoad(){Q.ifTest&&(new cs,new _s)}gameLoad(){let e=new ns;console.log(...p.comLog("开始加载游戏")),e.Enter(Laya.Handler.create(this,this.OnGameLoad))}OnGameLoad(){console.log(...p.comLog("游戏加载完成")),Q.support3D&&Nt.instance.enterGame(),Q.support2D&&os.instance.enterGame(),this.OnGameEnter()}OnGameEnter(){}}new class{constructor(){window.Laya3D?Laya3D.init(e.width,e.height):Laya.init(e.width,e.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=e.scaleMode,Laya.stage.screenMode=e.screenMode,Laya.stage.alignV=e.alignV,Laya.stage.alignH=e.alignH,Laya.URL.exportSceneToJson=e.exportSceneToJson,(e.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),e.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),e.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){new us}}}();