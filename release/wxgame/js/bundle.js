!function(){"use strict";class e{constructor(){}static init(){Laya.ClassUtils.regClass}}e.width=750,e.height=1334,e.scaleMode="fixedwidth",e.screenMode="none",e.alignV="top",e.alignH="left",e.startScene="",e.sceneRoot="",e.debug=!1,e.stat=!1,e.physicsDebug=!1,e.exportSceneToJson=!0,e.init();class t{static addScrCon(e){}static addCommonCon(){}}class s{}s.logStyle="\n        color: #fff;\n        background-color: #8d93ab;\n        border-radius: 3px;\n        line-height: 15px;\n        ",s.logLightStyle="\n        color: #52575d;\n        background-color: #EBEBEB;\n        border-radius: 3px;\n        line-height: 15px;\n        ",s.comStyle="\n        color: #fff;\n        background-color: #ade498;\n        border-radius: 3px;\n        line-height: 15px;\n        ",s.warnStyle="\n        color: #5c6e06;\n        background-color: #ffa931;\n        border-radius: 3px;\n        line-height: 15px;\n        ",s.errorStyle="\n        color: #fff;\n        background-color: #ec0101;\n        border-radius: 3px;\n        line-height: 15px;\n        ",s.platformStyle="\n        color: #52575d;\n        background-color: #e3fdfd;\n        border-radius: 3px;\n        line-height: 15px;\n        ";class i{static log(...e){console.log(`%c ${e}`,s.logStyle)}static warn(...e){console.log(`%c ${e}`,s.warnStyle)}static error(...e){console.log(`%c ${e}`,s.errorStyle)}static packLog(...e){return[`%c ${e} `,s.logStyle]}static packLogLight(...e){return[`%c ${e} `,s.logLightStyle]}static comLog(...e){return[`%c ${e} `,s.comStyle]}static packWarn(...e){return[`%c 警告: ${e} `,s.warnStyle]}static packError(...e){return[`%c 错误: ${e} `,s.errorStyle]}static packPlatform(...e){return[`%c 平台: ${e} `,s.platformStyle]}}class a{static Load(e,t,s=null){if(s&&s.once&&(s.once=!1),!e||0==e.length)return t.run(),void s.run();Laya.loader.create(e,t,s)}static Load2d(e,t,s=null){if(s&&s.once&&(s.once=!1),!e||0==e.length)return t.run(),void s.run();Laya.loader.load(e,t,s)}static LoadAsync(e,t=null){return new Promise(s=>{a.Load(e,Laya.Handler.create(null,()=>{s()}),t)})}static Load2dAsync(e,t=null){return new Promise(function(s){a.Load2d(e,Laya.Handler.create(null,()=>{s()}),t)})}static Get(e,t=!1){let s=Laya.loader.getRes(e);return null==s?(console.error(...i.packError("资源尚未加载",e)),null):t?s:s.clone()}static LoadAndGet(e,t=!1){return new Promise(s=>{a.LoadAsync(e).then(i=>{s(a.Get(e,t))})})}static Unload(e){Laya.loader.clearRes(e)}}class n{static parseVector3(e,t){var s=e.split(",");t.setValue(Number(s[0]),Number(s[1]),Number(s[2]))}static setV3Length(e,t){let s=Laya.Vector3.scalarLength(e);if(0!=s){let i=t/s;e.x=e.x*i,e.y=e.y*i,e.z=e.z*i}}static PotLerpMove(e,t,s,i,a){if(!i)return void console.error("必须有一个输出的向量！");let n=Laya.Vector3.distance(e,t);return Laya.Vector3.lerp(e,t,s,i),1-n/a}static PotConstantSpeedMove(e,t,s,i){if(!i)return void console.error("必须有一个输出的向量！");let a,n=new Laya.Vector3;return Laya.Vector3.subtract(t,e,n),Laya.Vector3.scalarLength(n)>s?(this.setV3Length(n,s),a=!1):a=!0,Laya.Vector3.add(e,n,i),a}}class o{static initNode(e,t){e.name=t.name,t.position?n.parseVector3(t.position,e.transform.localPosition):e.transform.localPosition.setValue(0,0,0),e.transform.localPosition=e.transform.localPosition,t.euler?n.parseVector3(t.euler,e.transform.localRotationEuler):e.transform.localRotationEuler.setValue(0,0,0),e.transform.localRotationEuler=e.transform.localRotationEuler,t.scale?n.parseVector3(t.scale,e.transform.localScale):e.transform.localScale.setValue(1,1,1),e.transform.localScale=e.transform.localScale,"undefined"!=(t=t).prefabName&&t.differ&&this.setDiffer(e,t.differ)}static setDiffer(e,t){if(t.child)for(let s of t.child)this.setDiffer(e.getChildAt(s.index),s);t.position&&(n.parseVector3(t.position,this._centreV3),Laya.Vector3.add(e.transform.localPosition,this._centreV3,this._centreV3),this._centreV3.cloneTo(e.transform.localPosition),e.transform.localPosition=e.transform.localPosition),t.euler&&(n.parseVector3(t.euler,this._centreV3),Laya.Vector3.add(e.transform.localRotationEuler,this._centreV3,this._centreV3),this._centreV3.cloneTo(e.transform.localRotationEuler),e.transform.localRotationEuler=e.transform.localRotationEuler),t.scale&&(n.parseVector3(t.scale,this._centreV3),Laya.Vector3.add(e.transform.localScale,this._centreV3,this._centreV3),this._centreV3.cloneTo(e.transform.localScale),e.transform.localScale=e.transform.localScale)}}o._centreV3=new Laya.Vector3;class r{static get Datas(){return this.m_datas}static set Datas(e){this.m_datas=e}static get Handlers(){return this.m_handlers}static set Handlers(e){this.m_handlers=e}}r.m_ifSetProxy=!1;class h extends r{}class l{constructor(){this.Prefabs="@Camera@@DirectionalLight@",this.Prefabs2="@Cube@@Sphere@@Cylinder@"}}var c,d,u,m;!function(e){e.Export="export"}(c||(c={}));class _ extends l{}class g{static get defaultLevelSceneName(){return c.Export}}!function(e){e.RootRes="res",e.Config="Config",e.Font="Font",e.FGUI="FGUI",e.LvConfig="LvConfig",e.Other="Other",e.icon="icon",e.img="img",e.music="music",e.sound="sound",e.skin="skin"}(d||(d={}));class f{}f.CDNURLs=[];class p{}p.subpackages=[];class I{constructor(){this.m_KeyResList={},this.m_KeyResList_={},this.m_KeyResList={[d.RootRes]:d.RootRes+"/",[d.Config]:d.RootRes+"/"+d.Config+"/",[d.FGUI]:d.RootRes+"/"+d.FGUI+"/",[d.LvConfig]:d.RootRes+"/"+d.LvConfig+"/",[d.Font]:d.RootRes+"/"+d.Font+"/",[d.Other]:d.RootRes+"/"+d.Other+"/",[d.icon]:d.RootRes+"/"+d.Other+"/"+d.icon+"/",[d.img]:d.RootRes+"/"+d.Other+"/"+d.img+"/",[d.music]:d.RootRes+"/"+d.Other+"/"+d.music+"/",[d.sound]:d.RootRes+"/"+d.Other+"/"+d.sound+"/",[d.skin]:d.RootRes+"/"+d.Other+"/"+d.skin+"/"};let e=new _;for(let t in e)d[t]=t,this.m_KeyResList[d[t]]=d.RootRes+"/"+d[t]+"/",console.log(...i.packLogLight("注入预制体资源路径",this.m_KeyResList[d[t]]));for(let e in this.m_KeyResList)this.m_KeyResList_[e]=this.m_KeyResList[e];this.setRes()}static get instance(){return null==this._instance&&(this._instance=new I),this._instance}setRes(){for(let e of p.subpackages)this.editKeyResList(e.name,e.root);for(let e of f.CDNURLs)this.editKeyResList(e.name,e.root)}ifKeyRes(e){let t=!1;for(let s in d)if(e==d[s]){t=!0;break}return t}getResURL(e){return this.m_KeyResList[e]}editKeyResList(e,t){let s=this.m_KeyResList_[e];if(s){console.log(...i.packLog("修改关键点资源路径",s,"替换成",t));for(let e in this.m_KeyResList)this.m_KeyResList[e]=this.m_KeyResList[e].replace(s,t);this.m_KeyResList_[e]=t}else console.warn(...i.packWarn("修改资源路径失败，没有"+e+"这个关键路径！"))}}class y{static EssentialOtherResUrl(){return[]}static levelConfigURL(e){return I.instance.getResURL(d.LvConfig)+e+".json"}static ConfigURL(e){return I.instance.getResURL(d.Config)+e}static FGUIPack(e){return I.instance.getResURL(d.FGUI)+e}static fontURL(e){return I.instance.getResURL(d.Font)+e}static prefab_url(e){if(this._prefabsSceneCache[e])return I.instance.getResURL(d[this._prefabsSceneCache[e]])+"Conventional/"+e+".lh";for(let t in this._AllScenePrefabsNames)if(-1!=this._AllScenePrefabsNames[t].indexOf("@"+e+"@"))return this._prefabsSceneCache[e]=t,I.instance.getResURL(d[t])+"Conventional/"+e+".lh";console.error(...i.packError("没有在场景找到预制体",e,"可能是没有导出场景预制体列表导致的。"))}}y._AllScenePrefabsNames=new _,y._prefabsSceneCache={};class S{static Unique(e){return Array.from(new Set(e))}static ReverseReserveUnique(e){return Array.from(new Set(e.reverse())).reverse()}static ObjUnique(e,t){for(let s=0,i=e.length;s<i;s++)for(let i=s+1,a=e.length;i<a;i++)t(e[s])===t(e[i])&&(e.splice(i,1),i--,a--);return e}static Replace(e,t,s){let i=e.indexOf(t);return!(i<0)&&(e.splice(i,1,s),!0)}static RemoveItem(e,t){let s=e.indexOf(t);return!(s<0)&&(e.splice(s,1),!0)}static RemoveAt(e,t){return!(e.length<=t)&&(e.splice(t,1),!0)}static Contains(e,t){return e.indexOf(t)>=0}static Copy(e){let t=[];for(let s=0;s<e.length;++s)t.push(e[s]);return t}static upsetArray(e){return e.sort(()=>Math.random()-.5)}static RandomGet(e,t=1,s=e.map(e=>1)){if(e.length<=0)return;let i,a=[],n=[],o=[],r=s[0];s.forEach(e=>{r=Math.min(r,e)}),s=s.map(e=>Math.floor(e*(1/r))),e.forEach((e,t)=>{a.push(e);for(let e=0;e<s[t];e++)o.push(t)});for(let e=0;e<t&&!(a.length<=0);e++)i=Math.floor(Math.random()*o.length),o=o.filter(e=>e!=i),n.push(a.splice(o[i],1)[0]);return n}}class w{constructor(e,t,s){this._prefabRes=[],this.m_affiliateResURLs=[],this.prefabs={},this.sprite3Ds=[],this.sceneNode=e,this.sceneNode_=t,this._lvConfig=s}get ifDestroy(){return!Boolean(this._scene)}get scene(){return this._scene}set affiliateResURLs(e){this.m_affiliateResURLs=e}get affiliateResURLs(){return this.m_affiliateResURLs}get allResURLs(){let e=this.scenePrefabUrl();return e.push(...this.m_affiliateResURLs),e}addAffiliateResURLs(e){e.length<=0||(this.m_affiliateResURLs.push(...e),this.m_affiliateResURLs=S.Unique(this.m_affiliateResURLs))}loadRes(e=null){return a.LoadAsync(this.allResURLs,e)}buildScene(e=null){return new Promise(t=>{if(this._scene)return console.warn(...i.packWarn("重复构建关卡，请注意")),void t(this._scene);console.log(...i.packLog("开始构建关卡->"+this._lvConfig.key)),this.loadRes(e).then(()=>{let e=Date.now();this._scene=new Laya.Sprite3D,h.s3d.addChild(this._scene);for(let e in this.sceneNode){let t=new Laya.Sprite3D;t.name=e,this._scene.addChild(t),this._buildScene(this.sceneNode[e],t)}console.log(...i.packLog("关卡->"+this._lvConfig.key+"构建完成")),console.log("关卡->"+this._lvConfig.key,"\n场景->",this._scene,"\n预制体->",this.prefabs,"\n物体->",this.sprite3Ds),t(this._scene),(e=Date.now()-e)>1e3&&console.warn(...i.packWarn("场景构建时间过长",this._lvConfig.key,e))})})}clearScene(){this._scene&&(console.log(...i.packLog("清除关卡->"+this._lvConfig.key)),this._scene.destroy(),this._prefabRes=[],this.prefabs={},this._scene=null,this.sprite3Ds=[])}scenePrefabUrl(){let e=[],t=this.scenePrefabResName();return t&&t.forEach(t=>{e.push(y.prefab_url(t))}),e}sceneDirectPrefabUrl(){let e=[],t=this.sceneDirectPrefabResName();return t&&t.forEach(t=>{e.push(y.prefab_url(t))}),e}scenePreloadPrefabUrl(){let e=[],t=this.scenePreloadPrefabResName();return t&&t.forEach(t=>{e.push(y.prefab_url(t))}),e}scenePrefabResName(){let e=0;for(let t in this.sceneNode)e++;if(0!=e){if(!this._prefabRes||this._prefabRes.length<=0){for(let e in this.sceneNode)this._getPrefabName(this._prefabRes,this.sceneNode[e]);this.sceneNode_&&this.sceneNode_.length>0&&this.sceneNode_.forEach(e=>{this._getPrefabName(this._prefabRes,e)})}return this._prefabRes}console.error(...i.packError("关卡->"+this._lvConfig.key+"<-不存在,或者是没有内容"))}sceneDirectPrefabResName(){let e=[];for(let t in this.sceneNode)this._getPrefabName(e,this.sceneNode[t]);return e}scenePreloadPrefabResName(){let e=[];return this.sceneNode_.forEach(t=>{this._getPrefabName(e,t)}),e}_getPrefabName(e,t){if(t){let s=t.prefabName;s?(t=t,e.indexOf(s)<0&&e.push(s)):(t=t).child&&t.child.forEach(t=>{this._getPrefabName(e,t)})}}_buildScene(e,t){let s=e.prefabName;if(s){e=e;let i=a.Get(y.prefab_url(s));i&&(o.initNode(i,e),t.addChild(i),this.prefabs[s]=this.prefabs[s]||[],this.prefabs[s].push(i),this.sprite3Ds.push(i))}else if((e=e).child){let s=new Laya.Sprite3D;o.initNode(s,e),t.addChild(s),e.child.forEach(e=>{this._buildScene(e,s)})}}}class L{static set sevelConfig(e){this.m_sevelConfig=e}static initCamera(e,t=g.defaultLevelSceneName){let s=this.m_sevelConfig[t].camera;s&&o.initNode(e,s)}static initLight(e,t=g.defaultLevelSceneName){let s=this.m_sevelConfig[t].light;s&&o.initNode(e,s)}}L.m_sevelConfig={},function(e){e.config=class{},e.path="res/config/LevelConfig.json"}(u||(u={}));class b{constructor(){this.initData()}initData(){}}class v extends b{get dataList(){return this.m_dataList}}class D extends b{get data(){return this.m_data}}class C extends v{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new C),this._instance}initData(){this.m_dataList=u.dataList}getLevelNumber(){let e=0;return this.m_dataList.forEach(t=>{t.id>0&&e++}),e}byIdGetData(e){return this.m_dataList.find(t=>t.id==e)}}!function(e){e.config=class{},e.path="res/config/OtherLevelConfig.json"}(m||(m={}));class A extends v{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new A),this._instance}initData(){this.m_dataList=m.dataList}byIdGetData(e){return this.m_dataList.find(t=>t.id==e)}byNameGetData(e){return this.m_dataList.find(t=>t.name==e)}}class U{static byLevelIdGetLevelData(e){let t=C.instance.byIdGetData(e);return this.getLevelData("ID",t.id,t.sceneName,t.sceneOtherRes,t.rootScene)}static byLevelNameGetOtherLevelData(e){let t=A.instance.byNameGetData(e);return this.getLevelData("Name",t.id,t.sceneName,t.sceneOtherRes,t.rootScene)}static getLevelData(e,t,s,i,a){return s.replace(/\s+/g,"").replace(/^,+/,"").replace(/,+$/,"").replace(/,+/g,","),i.replace(/\s+/g,"").replace(/^,+/,"").replace(/,+$/,"").replace(/,+/g,","),{key:"$"+a+":"+e+"-"+t+"-"+s,rootScene:a,sceneName:s.split(","),sceneOtherRes:i.split(",")}}}class R{}R.PrestrainLeveId=["prestrain"];class O{constructor(){this._levelConfig={},this._scenes={},L.sevelConfig=this._levelConfig}static get instance(){return null==this._instance&&(this._instance=new O),this._instance}init(){}initConfig(){let e,t;for(let s in c)if(e=c[s]){if(e=y.levelConfigURL(e),(t=a.Get(e,!0)).zip){let s=Date.now();t.root=JSON.parse(pako.inflate(t.root,{to:"string"})),(s=Date.now()-s)>500&&console.warn(...i.packWarn("配置表解压时间过长",e,s))}if(t.root){this._levelConfig[c[s]]={};for(let e=0;e<t.root.length;e++){let i=t.root[e];this._levelConfig[c[s]][i.name]=i}}else console.error(...i.packError("找不到配置表root节点数据",e));a.Unload(e)}}Preload(e){let t=[];R.PrestrainLeveId.forEach(e=>{t.push(...this.getOtherSceneByName(e).scenePrefabUrl())}),e.push(...t)}preloadSceneRes(e){console.log(...i.packLog("预加载关卡->",e)),this.getSceneByLv(e).loadRes()}preloadOtherSceneRes(e){console.log(...i.packLog("预加载其它关卡->",e)),this.getOtherSceneByName(e).loadRes()}getSceneByLv(e){let t=U.byLevelIdGetLevelData(e);return t||console.error(...i.packError("不存在此关卡->",e)),this._scenes[t.key]||(this._scenes[t.key]=this.getSceneByData(t)),this._scenes[t.key]}getOtherSceneByName(e){let t=U.byLevelNameGetOtherLevelData(e);return t||console.error(...i.packError("不存在此关卡->",e)),this._scenes[t.key]||(this._scenes[t.key]=this.getSceneByData(t)),this._scenes[t.key]}getSceneByData(e){let t=this.getSceneConfig(e);return new w(t.sceneNodes,t.sceneNodes_,e)}getSceneConfig(e){let t=e.sceneName,s=e.sceneOtherRes,a={},n=[];this._levelConfig[e.rootScene]||console.error(...i.packError("没有找到场景-",e.rootScene," 请先注册。"));for(let i in this._levelConfig[e.rootScene])-1!=t.findIndex(e=>e==i)&&(a[i]=this._levelConfig[e.rootScene][i]),-1!=s.findIndex(e=>e==i)&&n.push(this._levelConfig[e.rootScene][i]);return{sceneNodes:a,sceneNodes_:n}}getLvResName(e){return this.getSceneByLv(e).scenePrefabResName()}getLvResUrl(e){return this.getSceneByLv(e).scenePrefabUrl()}}class x{}x.gravity=-10,x.ifPreloadCustoms=!1;class P{static RgbToHex(e,t,s){for(var i=(e<<16|t<<8|s).toString(16);i.length<6;)i="0"+i;return"#"+i}static ColorToHex(e){return this.RgbToHex(255*e.r,255*e.g,255*e.b)}static HexToColor(e,t=null){e.startsWith("#")&&(e=e.substring(1));let s=e.substring(0,2),i=e.substring(2,4),a=e.substring(4,6),n=e.substring(6,8),o=parseInt(s,16),r=parseInt(i,16),h=parseInt(a,16),l=t||parseInt(n,16);return new Laya.Color(o/255,r/255,h/255,l)}static ToV3(e){return new Laya.Vector3(e.r,e.g,e.b)}static ToV4(e){return new Laya.Vector4(e.r,e.g,e.b,e.a)}static HexToV3(e){e.startsWith("#")&&(e=e.substring(1));let t=e.substring(0,2),s=e.substring(2,4),i=e.substring(4,6),a=parseInt(t,16),n=parseInt(s,16),o=parseInt(i,16);return new Laya.Vector3(a/255,n/255,o/255)}static HexToV4(e,t=null){e.startsWith("#")&&(e=e.substring(1));let s=e.substring(0,2),i=e.substring(2,4),a=e.substring(4,6),n=e.substring(6,8),o=parseInt(s,16),r=parseInt(i,16),h=parseInt(a,16),l=t||parseInt(n,16);return new Laya.Vector4(o/255,r/255,h/255,l)}}class k{constructor(){this.items={}}set(e,t){return this.items[e]=t,!0}has(e){return this.items.hasOwnProperty(e)}remove(e){return!!this.has(e)&&(delete this.items[e],!0)}get(e){return this.has(e)?this.items[e]:void 0}keys(){return Object.keys(this.items)}get length(){return this.keys().length}clear(){this.items={}}}class M{}M.timestep=1/60,M.iterations=24,M.broadphase=2,M.worldscale=1,M.random=!0,M.info=!1,M.gravity=[0,-9.8,0];class E{constructor(){this._oimoRigDic=new k,this._transformDic=new k,this._oimoOffset=new k,this._oimoRigDicR=new k,this._transformDicR=new k,this._oimoOffsetR=new k,this._tempOimoV3=new OIMO.Vec3,this._tempOimoQuat=new OIMO.Quat,this._tempQuaternion=new Laya.Quaternion,this._init()}get oimoWorld(){return this._oimoWorld}static get instance(){return E._instance||(E._instance=new E),E._instance}_init(){this._oimoWorld=this.CreateWolrd(),window.oimoWorld=this._oimoWorld}CreateWolrd(){return new OIMO.World({timestep:M.timestep,iterations:M.iterations,broadphase:M.broadphase,worldscale:M.worldscale,random:M.random,info:M.info,gravity:M.gravity})}_createRigBox(e,t,s,i,a,n="box"){return e.add({type:n,size:[i.x,i.y,i.z],pos:[t.x,t.y,t.z],rot:[s.x,s.y,s.z],move:a,density:10,belongsTo:1,collidesWith:4294967295})}CreateCompoundRig(e,t,s=!0,i=!0,a=!1,n=!1,o=10,r=1,h=4294967295){for(var l=[],c=[],d=[],u=[],m=0;m<t.length;m++){let e=t[m];l.push(e.type),c.push(e.pos.x,e.pos.y,e.pos.z),d.push(e.eular.x,e.eular.y,e.eular.z),u.push(e.size.x,e.size.y,e.size.z)}let _=this.oimoWorld.add({type:l,pos:[e.position.x,e.position.y,e.position.z],rot:[e.rotationEuler.x,e.rotationEuler.y,e.rotationEuler.z],posShape:c,rotShape:d,size:u,move:s,density:o,friction:.999,restitution:.1,isKinematic:n,belongsTo:r,collidesWith:h});return _.id=E.m_rigId,E.m_rigId++,i&&(this._oimoRigDic.set(_.id,_),this._transformDic.set(_.id,e),this._oimoOffset.set(_.id,new Laya.Vector3)),a&&(this._oimoRigDicR.set(_.id,_),this._transformDicR.set(_.id,e),this._oimoOffsetR.set(_.id,new Laya.Vector3)),_}static SetCollideData(e,t,s,i,a){for(var n=e.shapes;null!==n;n=n.next)null!=t&&(n.belongsTo=t),null!=s&&(n.collidesWith=s),null!=i&&(n.restitution=i),null!=a&&(n.friction=a)}setCanMove(e,t){t?e.setupMass(OIMO.BODY_DYNAMIC,!1):e.setupMass(OIMO.BODY_STATIC,!1)}clearRig(){this._oimoWorld.clear(),this._oimoRigDic.clear(),this._transformDic.clear(),this._oimoOffset.clear(),this._oimoRigDicR.clear(),this._transformDicR.clear(),this._oimoOffsetR.clear()}addRig(e,t=this._oimoWorld){e&&t.addRigidBody(e)}RemoveRig(e,t=this._oimoWorld,s=!1){e&&(s&&(this._oimoRigDic.remove(e.id),this._transformDic.remove(e.id),this._oimoOffset.remove(e.id),this._oimoRigDicR.remove(e.id),this._transformDicR.remove(e.id),this._oimoOffsetR.remove(e.id)),t.removeRigidBody(e))}AddJoint(e,t,s,i,a,n){return this.oimoWorld.add({type:e,body1:t,body2:s,pos1:null!=i?[i.x,i.y,i.z]:i,pos2:null!=a?[a.x,a.y,a.z]:a,spring:n})}RemoveJoint(e){this.oimoWorld.removeJoint(e)}updateAllTrans(){this._oimoRigDic.keys().forEach(e=>{this.UpdateTrans(this._transformDic.get(e),this._oimoRigDic.get(e),this._oimoOffset.get(e))})}updateAllTransReverse(){this._oimoRigDicR.keys().forEach(e=>{this.UpdateTransReverse(this._transformDicR.get(e),this._oimoRigDicR.get(e))})}UpdateTransReverse(e,t){if(!e||!t||!t.parent)return;let s=e.position;this._tempOimoV3.set(s.x,s.y,s.z),t.awake(),t.setPosition(this._tempOimoV3);let i=e.rotation;this._tempOimoQuat.set(i.x,i.y,i.z,i.w),t.setQuaternion(this._tempOimoQuat)}UpdateTrans(e,t,s){if(!e||!t||!t.parent)return;let i=t.getPosition();if(e.position.x=i.x,e.position.y=i.y,e.position.z=i.z,s&&!this.isZero(s)){let t=s.clone();Laya.Quaternion.createFromYawPitchRoll(this.deg2rad(e.rotationEuler.y),this.deg2rad(e.rotationEuler.x),this.deg2rad(e.rotationEuler.z),this._tempQuaternion),Laya.Vector3.transformQuat(t,this._tempQuaternion,t),Laya.Vector3.subtract(e.position,t,e.position)}e.position=e.position;let a=t.getQuaternion();e.rotation.x=a.x,e.rotation.y=a.y,e.rotation.z=a.z,e.rotation.w=a.w,e.rotation=e.rotation}isZero(e){return Laya.MathUtils3D.isZero(e.x)&&Laya.MathUtils3D.isZero(e.y)&&Laya.MathUtils3D.isZero(e.z)}deg2rad(e){return e*Math.PI/180}GetRig(e){return this._oimoRigDic.get(e)}}E.m_rigId=0;class G extends Laya.Script3D{onUpdate(){E.instance.oimoWorld.timeStep=Laya.timer.delta/1e3,E.instance.oimoWorld.step(),E.instance.updateAllTrans(),E.instance.updateAllTransReverse()}}class B{}B.GameWhatTeam="小小游戏",B.GameName="LayaMiniGame",B.GameName_="LayaBox小游戏",B.GameExplain="LayaBox小游戏",B.versions="0.0.0",B.OnLine=!1;class V{}V.support2D=!1,V.support3D=!0,V.ifAddOimoSystem=!1,V.ifGameTest=!B.OnLine&&!1,V.ifTest=!B.OnLine&&!1,V.ifDebug=!B.OnLine&&!0,V.ifOpenWindowDebug=!B.OnLine&&!1;class N{constructor(){this.m_mesList=[]}onMes(e,t,s){this.m_mesList.push({this:e,key:t,f:s})}eventMes(e,...t){this.m_mesList.forEach(s=>{s.key==e&&s.f.call(s.this,...t)})}removeMes(e,t){this.m_mesList=this.m_mesList.filter(s=>void 0!==t?s.this!=e&&s.key!=t:s.this!=e)}}const T='<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/favicon.ico"><title>DebugWindow</title><link href="/css/app.d6b301ef.css" rel="preload" as="style"><link href="/css/chunk-vendors.84bb20f7.css" rel="preload" as="style"><link href="/js/app.2e279fb7.js" rel="preload" as="script"><link href="/js/chunk-vendors.ee9c6a8c.js" rel="preload" as="script"><link href="/css/chunk-vendors.84bb20f7.css" rel="stylesheet"><link href="/css/app.d6b301ef.css" rel="stylesheet"></head><body><noscript><strong>We\'re sorry but DebugWindow doesn\'t work properly without JavaScript enabled. Please enable it to continue.</strong></noscript><div id="app"></div><script src="/js/chunk-vendors.ee9c6a8c.js"><\/script><script src="/js/app.2e279fb7.js"><\/script></body></html>';var H,F,W,j,K,$,z,Q,q,J,Z,Y,X,ee,te;!function(e){e.DebugWindow="$DebugWindow",e.Mes="$Mes"}(H||(H={}));class se{constructor(){this._ifStart=!1}static addItem(e,t){let s=this.prefix+":"+e;this[s]&&console.warn(...i.packWarn("该调试对象已经存在了，将会被第二个覆盖",s)),this[s]=t}startDebug(){this._ifStart=!0,window[se.prefix][this._name]&&console.warn(...i.packWarn("有一个调试对象名字重名了，将会被第二个覆盖",this._name)),window[se.prefix][this._name]=this,this._startDebug()}addItem(e,t){this._ifStart&&(this[e]&&console.warn(...i.packWarn("该调试对象已经存在了，将会被第二个覆盖",this._name,"-",e)),this[e]=t)}_startDebug(){}static openWindowDebug(){let e=window.open("",B.GameName);window[H.DebugWindow]=e;let t=window.location.href.replace("bin/index.html","DebugWindow/dist/");e.document.getElementsByTagName("html")[0].innerHTML=T.replace(/"\//g,'"'+t),console.warn(...i.packWarn("打开调式窗口。"));let s=e.document.getElementsByTagName("body")[0].getElementsByTagName("script");e[H.Mes]=new N;let a=[];for(let e of s)a.push(e.src);a.forEach(t=>{let s=e.document.createElement("script");s.async=!1,s.src=t,e.document.body.appendChild(s)})}static fendDebugWindow(e,...t){window[H.DebugWindow][H.Mes].eventMes(e,...t)}}se.prefix="$Debug",window[se.prefix]={},V.ifDebug&&console.warn(...i.packWarn("开启调试模式，通过",se.prefix,"访问"));class ie extends se{constructor(){super(),this._name="Environment"}static get instance(){return this._instance?this._instance:(this._instance=new ie,this._instance)}_startDebug(){console.log("开启环境调试")}}class ae{static InitAll(){V.support3D?(this.s3d=Laya.stage.addChildAt(new Laya.Scene3D,0),this.camera=new Laya.Camera,this.s3d.addChild(this.camera),L.initCamera(this.camera),this.light=new Laya.DirectionLight,this.s3d.addChild(this.light),L.initLight(this.light),V.ifAddOimoSystem&&this.addOimoSystem(),h.s3d=this.s3d,h.camera=this.camera,h.light=this.light,ie.instance.s3d=this.s3d,ie.instance.camera=this.camera,ie.instance.light=this.light):console.log(...i.packLog("请设置支持3D!"))}static addOimoSystem(){let e=new Laya.Sprite3D;this.s3d.addChild(e),e.addComponent(G)}}!function(e){e.GameLevelsBuild="GameLevelsBuild",e.GameOtherLevelsBuild="GameOtherLevelsBuild",e.GameLevelsBuildBefore="GameLevelsBuildBefore",e.GameLevelsOnBuild="GameLevelsOnBuild",e.GameLevelsDelete="GameLevelsDelete",e.GameOtherLevelsDelete="GameOtherLevelsDelete",e.GameLevelsDeleteBefore="GameLevelsDeleteBefore",e.GameLevelsOnDelete="GameLevelsOnDelete",e.GameStart="Start",e.GameSuspend="GameSuspend",e.GameGoOn="GameGoOn",e.GameRestart="GameRestart",e.GameEnd="GameEnd",e.GameCom="GameCom",e.GameFail="gameFail",e.RoleDie="RoleDie",e.RoleRevive="Revive"}(F||(F={})),function(e){e.LookAd="LookAd",e.UnLookAd="UnLookAd"}(W||(W={})),function(e){e.BGMSuspend="BGMSuspend",e.BGMGoOn="BGMGoOn",e.SoundSuspend="SoundSuspend",e.SoundGoOn="SoundGoOn",e.BGMVolumeChange="BGMVolumeChange",e.SoundVolumeChange="BGMVolumeChange"}(j||(j={})),function(e){e.GameInit="GameInit",e.GameOnInit="GameOnInit",e.GameLoading="GameLoading",e.GameResLoading="GameResLoading"}(K||(K={})),function(e){e.CustomsChange="CustomsChange",e.GameCoinChange="GameCoinChange",e.SoundStateChange="SoundStateChange",e.VibrateStateChange="VibrateStateChange",e.SceneGameCustomsLoading="SceneGameCustomsLoading",e.Updata3D="Updata3D"}($||($={}));class ne extends Laya.EventDispatcher{constructor(){super(),this.enumerationEegistrationMes()}static get onlyKey(){return ne._onlyKey++,"$key"+ne._onlyKey}static get instance(){return null==this._instance&&(this._instance=new ne),this._instance}init(){}enumerationEegistrationMes(){this.enumerationEegistrationMes_(W),this.enumerationEegistrationMes_(K),this.enumerationEegistrationMes_($),this.enumerationEegistrationMes_(F),this.enumerationEegistrationMes_(j)}enumerationEegistrationMes_(e){for(let t in e)e[t]={value:e[t],[ne._mesKey]:ne.onlyKey}}sendEvent(e,t){void 0!==e[ne._mesKey]?ne.instance.event(e[ne._mesKey],t):console.log("事件",e,"没有被注册。")}onEvent(e,t,s,i){void 0!==e[ne._mesKey]?ne.instance.on(e[ne._mesKey],t,s,i):console.log("事件",e,"没有被注册。")}offEnent(e,t,s){void 0!==e[ne._mesKey]?ne.instance.off(e[ne._mesKey],t,s):console.log("事件",e,"没有被注册。")}}ne._mesKey=Symbol("$MesKey"),ne._onlyKey=0,function(e){e.config=class{},e.path="res/config/EnvironmentConfig.json"}(z||(z={}));class oe extends v{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new oe),this._instance}initData(){this.m_dataList=z.dataList}byLevelIdGetData(e){return this.m_dataList.find(t=>t.id==e)}}!function(e){e.config=class{},e.path="res/config/OtherEnvironmentConfig.json"}(Q||(Q={}));class re extends v{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new re),this._instance}initData(){this.m_dataList=Q.dataList}byLevelIdGetData(e){return this.m_dataList.find(t=>t.id==e)}byLevelNameGetData(e){return this.m_dataList.find(t=>t.name==e)}}!function(e){e.SetEnvironment="setEnvironment"}(q||(q={})),function(e){e[e.MinLeveNumber=3]="MinLeveNumber",e[e.DefaultLeveId=1]="DefaultLeveId",e[e.DebugLeveId=0]="DebugLeveId",e[e.NewHandLeveId=1]="NewHandLeveId"}(J||(J={}));class he{constructor(){this.initData()}initData(){}}class le{static SplitToIntArray(e,t){for(var s=e.split(t),i=[],a=0;a<s.length;++a){var n=parseInt(s[a]);isNaN(n)&&(n=0),i.push(n)}return i}static IntArrToStr(e){for(var t="",s=0;s<e.length;++s)t+=e[s].toFixed(0),s<e.length-1&&(t+=",");return t}static IsNullOrEmpty(e){return null==e||""==e}}class ce{constructor(){this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}static hashStr(e,t=!1){return this.onePassHasher.start().appendStr(e).end(t)}static hashAsciiStr(e,t=!1){return this.onePassHasher.start().appendAsciiStr(e).end(t)}static _hex(e){const t=ce.hexChars,s=ce.hexOut;let i,a,n,o;for(o=0;o<4;o+=1)for(a=8*o,i=e[o],n=0;n<8;n+=2)s[a+1+n]=t.charAt(15&i),i>>>=4,s[a+0+n]=t.charAt(15&i),i>>>=4;return s.join("")}static _md5cycle(e,t){let s=e[0],i=e[1],a=e[2],n=e[3];i=((i+=((a=((a+=((n=((n+=((s=((s+=(i&a|~i&n)+t[0]-680876936|0)<<7|s>>>25)+i|0)&i|~s&a)+t[1]-389564586|0)<<12|n>>>20)+s|0)&s|~n&i)+t[2]+606105819|0)<<17|a>>>15)+n|0)&n|~a&s)+t[3]-1044525330|0)<<22|i>>>10)+a|0,i=((i+=((a=((a+=((n=((n+=((s=((s+=(i&a|~i&n)+t[4]-176418897|0)<<7|s>>>25)+i|0)&i|~s&a)+t[5]+1200080426|0)<<12|n>>>20)+s|0)&s|~n&i)+t[6]-1473231341|0)<<17|a>>>15)+n|0)&n|~a&s)+t[7]-45705983|0)<<22|i>>>10)+a|0,i=((i+=((a=((a+=((n=((n+=((s=((s+=(i&a|~i&n)+t[8]+1770035416|0)<<7|s>>>25)+i|0)&i|~s&a)+t[9]-1958414417|0)<<12|n>>>20)+s|0)&s|~n&i)+t[10]-42063|0)<<17|a>>>15)+n|0)&n|~a&s)+t[11]-1990404162|0)<<22|i>>>10)+a|0,i=((i+=((a=((a+=((n=((n+=((s=((s+=(i&a|~i&n)+t[12]+1804603682|0)<<7|s>>>25)+i|0)&i|~s&a)+t[13]-40341101|0)<<12|n>>>20)+s|0)&s|~n&i)+t[14]-1502002290|0)<<17|a>>>15)+n|0)&n|~a&s)+t[15]+1236535329|0)<<22|i>>>10)+a|0,i=((i+=((a=((a+=((n=((n+=((s=((s+=(i&n|a&~n)+t[1]-165796510|0)<<5|s>>>27)+i|0)&a|i&~a)+t[6]-1069501632|0)<<9|n>>>23)+s|0)&i|s&~i)+t[11]+643717713|0)<<14|a>>>18)+n|0)&s|n&~s)+t[0]-373897302|0)<<20|i>>>12)+a|0,i=((i+=((a=((a+=((n=((n+=((s=((s+=(i&n|a&~n)+t[5]-701558691|0)<<5|s>>>27)+i|0)&a|i&~a)+t[10]+38016083|0)<<9|n>>>23)+s|0)&i|s&~i)+t[15]-660478335|0)<<14|a>>>18)+n|0)&s|n&~s)+t[4]-405537848|0)<<20|i>>>12)+a|0,i=((i+=((a=((a+=((n=((n+=((s=((s+=(i&n|a&~n)+t[9]+568446438|0)<<5|s>>>27)+i|0)&a|i&~a)+t[14]-1019803690|0)<<9|n>>>23)+s|0)&i|s&~i)+t[3]-187363961|0)<<14|a>>>18)+n|0)&s|n&~s)+t[8]+1163531501|0)<<20|i>>>12)+a|0,i=((i+=((a=((a+=((n=((n+=((s=((s+=(i&n|a&~n)+t[13]-1444681467|0)<<5|s>>>27)+i|0)&a|i&~a)+t[2]-51403784|0)<<9|n>>>23)+s|0)&i|s&~i)+t[7]+1735328473|0)<<14|a>>>18)+n|0)&s|n&~s)+t[12]-1926607734|0)<<20|i>>>12)+a|0,i=((i+=((a=((a+=((n=((n+=((s=((s+=(i^a^n)+t[5]-378558|0)<<4|s>>>28)+i|0)^i^a)+t[8]-2022574463|0)<<11|n>>>21)+s|0)^s^i)+t[11]+1839030562|0)<<16|a>>>16)+n|0)^n^s)+t[14]-35309556|0)<<23|i>>>9)+a|0,i=((i+=((a=((a+=((n=((n+=((s=((s+=(i^a^n)+t[1]-1530992060|0)<<4|s>>>28)+i|0)^i^a)+t[4]+1272893353|0)<<11|n>>>21)+s|0)^s^i)+t[7]-155497632|0)<<16|a>>>16)+n|0)^n^s)+t[10]-1094730640|0)<<23|i>>>9)+a|0,i=((i+=((a=((a+=((n=((n+=((s=((s+=(i^a^n)+t[13]+681279174|0)<<4|s>>>28)+i|0)^i^a)+t[0]-358537222|0)<<11|n>>>21)+s|0)^s^i)+t[3]-722521979|0)<<16|a>>>16)+n|0)^n^s)+t[6]+76029189|0)<<23|i>>>9)+a|0,i=((i+=((a=((a+=((n=((n+=((s=((s+=(i^a^n)+t[9]-640364487|0)<<4|s>>>28)+i|0)^i^a)+t[12]-421815835|0)<<11|n>>>21)+s|0)^s^i)+t[15]+530742520|0)<<16|a>>>16)+n|0)^n^s)+t[2]-995338651|0)<<23|i>>>9)+a|0,i=((i+=((n=((n+=(i^((s=((s+=(a^(i|~n))+t[0]-198630844|0)<<6|s>>>26)+i|0)|~a))+t[7]+1126891415|0)<<10|n>>>22)+s|0)^((a=((a+=(s^(n|~i))+t[14]-1416354905|0)<<15|a>>>17)+n|0)|~s))+t[5]-57434055|0)<<21|i>>>11)+a|0,i=((i+=((n=((n+=(i^((s=((s+=(a^(i|~n))+t[12]+1700485571|0)<<6|s>>>26)+i|0)|~a))+t[3]-1894986606|0)<<10|n>>>22)+s|0)^((a=((a+=(s^(n|~i))+t[10]-1051523|0)<<15|a>>>17)+n|0)|~s))+t[1]-2054922799|0)<<21|i>>>11)+a|0,i=((i+=((n=((n+=(i^((s=((s+=(a^(i|~n))+t[8]+1873313359|0)<<6|s>>>26)+i|0)|~a))+t[15]-30611744|0)<<10|n>>>22)+s|0)^((a=((a+=(s^(n|~i))+t[6]-1560198380|0)<<15|a>>>17)+n|0)|~s))+t[13]+1309151649|0)<<21|i>>>11)+a|0,i=((i+=((n=((n+=(i^((s=((s+=(a^(i|~n))+t[4]-145523070|0)<<6|s>>>26)+i|0)|~a))+t[11]-1120210379|0)<<10|n>>>22)+s|0)^((a=((a+=(s^(n|~i))+t[2]+718787259|0)<<15|a>>>17)+n|0)|~s))+t[9]-343485551|0)<<21|i>>>11)+a|0,e[0]=s+e[0]|0,e[1]=i+e[1]|0,e[2]=a+e[2]|0,e[3]=n+e[3]|0}start(){return this._dataLength=0,this._bufferLength=0,this._state.set(ce.stateIdentity),this}appendStr(e){const t=this._buffer8,s=this._buffer32;let i,a,n=this._bufferLength;for(a=0;a<e.length;a+=1){if((i=e.charCodeAt(a))<128)t[n++]=i;else if(i<2048)t[n++]=192+(i>>>6),t[n++]=63&i|128;else if(i<55296||i>56319)t[n++]=224+(i>>>12),t[n++]=i>>>6&63|128,t[n++]=63&i|128;else{if((i=1024*(i-55296)+(e.charCodeAt(++a)-56320)+65536)>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");t[n++]=240+(i>>>18),t[n++]=i>>>12&63|128,t[n++]=i>>>6&63|128,t[n++]=63&i|128}n>=64&&(this._dataLength+=64,ce._md5cycle(this._state,s),n-=64,s[0]=s[16])}return this._bufferLength=n,this}appendAsciiStr(e){const t=this._buffer8,s=this._buffer32;let i,a=this._bufferLength,n=0;for(;;){for(i=Math.min(e.length-n,64-a);i--;)t[a++]=e.charCodeAt(n++);if(a<64)break;this._dataLength+=64,ce._md5cycle(this._state,s),a=0}return this._bufferLength=a,this}appendByteArray(e){const t=this._buffer8,s=this._buffer32;let i,a=this._bufferLength,n=0;for(;;){for(i=Math.min(e.length-n,64-a);i--;)t[a++]=e[n++];if(a<64)break;this._dataLength+=64,ce._md5cycle(this._state,s),a=0}return this._bufferLength=a,this}getState(){const e=this._state;return{buffer:String.fromCharCode.apply(null,this._buffer8),buflen:this._bufferLength,length:this._dataLength,state:[e[0],e[1],e[2],e[3]]}}setState(e){const t=e.buffer,s=e.state,i=this._state;let a;for(this._dataLength=e.length,this._bufferLength=e.buflen,i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],a=0;a<t.length;a+=1)this._buffer8[a]=t.charCodeAt(a)}end(e=!1){const t=this._bufferLength,s=this._buffer8,i=this._buffer32,a=1+(t>>2);let n;if(this._dataLength+=t,s[t]=128,s[t+1]=s[t+2]=s[t+3]=0,i.set(ce.buffer32Identity.subarray(a),a),t>55&&(ce._md5cycle(this._state,i),i.set(ce.buffer32Identity)),(n=8*this._dataLength)<=4294967295)i[14]=n;else{const e=n.toString(16).match(/(.*?)(.{0,8})$/);if(null===e)return;const t=parseInt(e[2],16),s=parseInt(e[1],16)||0;i[14]=t,i[15]=s}return ce._md5cycle(this._state,i),e?this._state:ce._hex(this._state)}}ce.ifUse=!0,ce.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]),ce.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),ce.hexChars="0123456789abcdef",ce.hexOut=[],ce.onePassHasher=new ce,"5d41402abc4b2a76b9719d911017c592"!==ce.hashStr("hello")&&(ce.ifUse=!1,console.warn("Md5 self test failed."));class de{constructor(){this._dataSetMonitor=[]}addKeySetMonitor(e,t,s){let i=[];s instanceof Array?i.push(...s):i.push(s);let a,n=[];i.forEach(e=>{"object"==typeof e&&e&&(-1==(a=n.findIndex(t=>t.rootData==e[ue.$RootParentDataKey]))?n.push({rootData:e[ue.$RootParentDataKey],key:[e[ue.$RootDataCruxKey]]}):n[a].key.push(e[ue.$RootDataCruxKey]))}),n.length<=0||n.forEach(s=>{this._dataSetMonitor.push({_this:e,_f:t,_rootData:s.rootData,_key:s.key})})}addObjectSetMonitor(e,t,s,a){let n=[];void 0!==a&&(a instanceof Array?n.push(...a):n.push(a)),n=n.map(e=>{if(e){if("object"!=typeof e)return e;if(e[ue.$RootParentDataKey]==s)return e[ue.$RootDataCruxKey];console.warn(...i.packWarn("监听的对象属性不存在该对象属性列表中！",s,e))}}).filter(e=>void 0!==e),this._dataSetMonitor.push({_this:e,_f:t,_rootData:s,_key:n})}offDataSetMonitor(e,t){this._dataSetMonitor=this._dataSetMonitor.filter(s=>s._this!==e&&s._f!==t)}offAllDataSetMonitor(e){this._dataSetMonitor=this._dataSetMonitor.filter(t=>t._this!==e)}clearDataSetMonitor(){this._dataSetMonitor=[]}getProxyData(e){let t={};if("object"!=typeof e||!e)return e;if(Array.prototype.isPrototypeOf(e))t=e;else for(let s in e)"object"==typeof e[s]&&e[s]?t[s]=this.getProxyData(e[s]):(t[s]=e[s],e[s]={[ue.$RootDataCruxKey]:Symbol("$key"),[ue.$RootParentDataKey]:e,value:e[s]});return t[ue.$RootObjectKey]=e,new Proxy(t,{set:(e,t,s)=>(this.proxyDataSet(e,t,s),!0)})}proxyDataSet(e,t,s){if(t==ue.$RootObjectKey)return void console.warn("试图更改数据的原始对象，被阻止",e,t,s);let i,a=e[t];if("object"==typeof s&&s&&!Array.prototype.isPrototypeOf(e))e[t]=this.getProxyData(s);else if(e[t]=s,Array.prototype.isPrototypeOf(e)&&"length"==t)return;for(let n of this._dataSetMonitor)if(!n._rootData||n._rootData==e[ue.$RootObjectKey]){if(void 0!==n._key&&n._key.length>0){i=!1;for(let s of n._key)if("symbol"==typeof s){if(s==e[ue.$RootObjectKey][t][ue.$RootDataCruxKey]){i=!0;continue}}else if(s==t){i=!0;continue}if(!i)continue}n._f.call(n._this,e,t,s,a)}this._proxyDataSet()}_proxyDataSet(){}}class ue{}ue.$RootObjectKey=Symbol("$RootObjectKey"),ue.$RootDataCruxKey=Symbol("$RootDataCruxKey"),ue.$RootParentDataKey=Symbol("$RootParentDataKey");class me extends de{}class _e{static encode(e){let t,s,i,a,n,o,r,h="",l=0;for(e=this._utf8_encode(e);l<e.length;)a=(t=e.charCodeAt(l++))>>2,n=(3&t)<<4|(s=e.charCodeAt(l++))>>4,o=(15&s)<<2|(i=e.charCodeAt(l++))>>6,r=63&i,isNaN(s)?o=r=64:isNaN(i)&&(r=64),h=h+this._keyStr.charAt(a)+this._keyStr.charAt(n)+this._keyStr.charAt(o)+this._keyStr.charAt(r);return h}static decode(e){let t,s,i,a,n,o,r,h="",l=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)t=(a=this._keyStr.indexOf(e.charAt(l++)))<<2|(n=this._keyStr.indexOf(e.charAt(l++)))>>4,s=(15&n)<<4|(o=this._keyStr.indexOf(e.charAt(l++)))>>2,i=(3&o)<<6|(r=this._keyStr.indexOf(e.charAt(l++))),h+=String.fromCharCode(t),64!==o&&(h+=String.fromCharCode(s)),64!==r&&(h+=String.fromCharCode(i));return h=this._utf8_decode(h)}static _utf8_encode(e){e=e.replace(/\r\n/g,"\n");let t="";for(let s=0;s<e.length;s++){const i=e.charCodeAt(s);i<128?t+=String.fromCharCode(i):i>127&&i<2048?(t+=String.fromCharCode(i>>6|192),t+=String.fromCharCode(63&i|128)):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128),t+=String.fromCharCode(63&i|128))}return t}static _utf8_decode(e){let t="",s=0,i=0,a=0,n=0;for(;s<e.length;)(i=e.charCodeAt(s))<128?(t+=String.fromCharCode(i),s++):i>191&&i<224?(a=e.charCodeAt(s+1),t+=String.fromCharCode((31&i)<<6|63&a),s+=2):(a=e.charCodeAt(s+1),n=e.charCodeAt(s+2),t+=String.fromCharCode((15&i)<<12|(63&a)<<6|63&n),s+=3);return t}}_e._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";class ge extends se{constructor(){super(),this._name="Data"}static get instance(){return this._instance?this._instance:(this._instance=new ge,this._instance)}_startDebug(){console.log("开启数据调试")}}class fe extends me{constructor(){super(...arguments),this._ifSetDataProxy=!0,this._ifDifferData=!0,this.m_saveToDiskQueue=0,this.m_saveToDiskTime=0}get saveName(){return B.GameName+"->"+this._saveName+"->"+B.versions}get differName(){return this.encrypt(this.saveName+"__verify")}get saveData(){return this._saveData}get rootData(){return this._rootData}InitData(){let e=Date.now();this._saveData=this._ReadFromFile(),this._rootData=this._saveData,this._ifSetDataProxy&&(this._saveData=this.getProxyData(this._saveData)),ge.instance.addItem(this._saveName,this),this._initData(),(e=Date.now()-e)>100&&console.warn(...i.packWarn("初始化本地数据时间过长",this.saveName,e))}_initData(){}_proxyDataSet(){this.SaveToDisk(this._saveData)}SaveToDisk(e,t=!0){0==this.m_saveToDiskTime&&(this.m_saveToDiskTime=Date.now()),t?(this.m_saveToDiskQueue++,setTimeout(()=>{this.m_saveToDiskQueue--,0==this.m_saveToDiskQueue&&this._SaveToDisk(e)},0)):this._SaveToDisk(e)}_SaveToDisk(e){let t=JSON.stringify(e);if(Laya.LocalStorage.setJSON(this.saveName,t),B.OnLine&&this._ifDifferData){let e=this.getDifferData(t);Laya.LocalStorage.setJSON(this.differName,e)}let s=Date.now()-this.m_saveToDiskTime;this.m_saveToDiskTime=0,s>1e3&&console.warn(...i.packWarn("场景保存时间过长",this.saveName,s))}_ReadFromFile(){let e=Laya.LocalStorage.getJSON(this.saveName);if(B.OnLine&&this._ifDifferData){let t=Laya.LocalStorage.getJSON(this.differName);if(this.getDifferData(e)!=t)return this._saveNewData()}let t=this.getNewData();try{if(le.IsNullOrEmpty(e))return this._saveNewData();{let s=JSON.parse(e);for(let e in t)t[e]=s[e]}}catch(e){return this._saveNewData()}return t}_saveNewData(){let e=this.getNewData();return this.SaveToDisk(e,!1),e}getDifferData(e){return le.IsNullOrEmpty(e)?"":this.encrypt(e)}encrypt(e){let t="LayaMiniGame-(-"+e+"-)-ModifiedWithout-"+this.saveName;return ce.ifUse?ce.hashStr(t).toString():_e.encode(t)}}class pe{}class Ie extends pe{static clone(e){return JSON.parse(JSON.stringify(e))}}class ye extends Ie{constructor(){super(...arguments),this.maxCustoms=0,this.ifOpenBgm=!0,this.ifOpenSound=!0,this.ifOpenVibrate=!0,this.onCustoms=J.DebugLeveId,this.maxCustomsRecord=1}}class Se extends fe{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new Se),this._instance}get _saveName(){return"Game"}getNewData(){return new ye}}class we extends he{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new we),this.m_instance}get gameData(){return this.m_gameData}initData(){this.m_gameData=Se.instance.saveData}initCustoms(e){e=Math.floor(e),this.m_gameData.maxCustoms!=e&&(this.m_gameData.maxCustoms=e,this.m_gameData.maxCustomsRecord>e&&(this.m_gameData.maxCustomsRecord=e),this.m_gameData.onCustoms>e&&(this.m_gameData.onCustoms=J.DefaultLeveId))}ifNewHandCustoms(){return this.m_gameData.onCustoms==J.NewHandLeveId&&this.m_gameData.maxCustomsRecord<=J.NewHandLeveId}setIfOpenBGM(e){this.m_gameData.ifOpenBgm=e}setIfOpenSound(e){this.m_gameData.ifOpenSound=e}setIfOpenVibrate(e){this.m_gameData.ifOpenVibrate=e}setCustoms(e=1){e=Math.floor(e);let t=this.m_gameData.onCustoms+e,s=!1;return t<=this.m_gameData.maxCustoms?(this.m_gameData.onCustoms=t,t>this.m_gameData.maxCustomsRecord&&(this.m_gameData.maxCustomsRecord=t),s=!0):(this.m_gameData.onCustoms=J.DefaultLeveId,s=!0),ne.instance.sendEvent($.CustomsChange),s}getDefaultCustoms(){return this.m_gameData.onCustoms>this.m_gameData.maxCustoms&&(this.m_gameData.onCustoms=J.DefaultLeveId),this.m_gameData.onCustoms}getPreloadCustoms(){return this.getNextCustoms()}getNextCustoms(){let e=this.m_gameData.onCustoms+1;return e>this.m_gameData.maxCustoms&&(e=J.DefaultLeveId),e}}class Le{constructor(){}static get instance(){return this.m_instance||(this.m_instance=new Le),this.m_instance}init(){this.m_s3d=ae.s3d,this.m_camera=ae.camera,this.m_light=ae.light}setEnvironment(e){this.m_scene=e;let t=we.instance.gameData.onCustoms;this.m_enviromentConfig=oe.instance.byLevelIdGetData(t),console.log("关卡环境配置参数->"+t+"->",this.m_enviromentConfig),this.setS3D(this.m_s3d),this.setCamera(this.m_camera,this.m_enviromentConfig.clear_color),this.setLight(this.light,this.m_enviromentConfig.light_color,this.m_enviromentConfig.light_intensity),this.addAmbient(this.s3d,this.m_enviromentConfig.ambient_color),ne.instance.onEvent(F.GameLevelsDelete,this,this.gameLevelsDelete),V.ifDebug&&V.ifOpenWindowDebug&&se.fendDebugWindow(q.SetEnvironment)}setOtherEnvironment(e,t,s=this.m_s3d,i=this.m_camera,a=this.m_light){let n=re.instance.byLevelNameGetData(e);console.log("关卡环境配置参数->"+e+"->",n),this.setCamera(i,n.clear_color),this.setLight(a,n.light_color,n.light_intensity),this.addAmbient(s,n.ambient_color)}get s3d(){return this.m_s3d}get camera(){return this.m_camera}get scene(){return this.m_scene}get light(){return this.m_light}setS3D(e){this.m_ifSetS3D||(this.m_ifSetS3D=!0)}setCamera(e,t){e.clearColor=P.HexToV4(t)}setLight(e,t,s){e.color=P.HexToV3(t),e.intensity=s,e.shadowMode=Laya.ShadowMode.SoftLow,e.shadowResolution=2500,e.shadowNormalBias=.5}addAmbient(e,t){e.ambientMode=Laya.AmbientMode.SolidColor,e.ambientColor=P.HexToV3(t)}addFog(e,t,s,i){e.enableFog=!0,e.fogColor=P.HexToV3(t),e.fogRange=s,e.fogStart=i}gameLevelsDelete(){}}class be{constructor(){this.m_ifInit=!1,this.m_otherScene={}}static get instance(){return this.m_instance||(this.m_instance=new be),this.m_instance}get ifSceneBuild(){return this.m_ifSceneBuild}init(){this.m_ifSceneBuild=!1,we.instance.initCustoms(C.instance.getLevelNumber()),ne.instance.onEvent(F.GameLevelsBuild,this,this.gameLevelsBuild),ne.instance.onEvent(F.GameLevelsDelete,this,this.gameLevelsDelete),ne.instance.onEvent(F.GameOtherLevelsBuild,this,this.gameOtherLevelsBuild),ne.instance.onEvent(F.GameOtherLevelsDelete,this,this.gameOtherLevelsDelete)}initLevelBuild(){this.gameLevelsBuild()}gameLevelsBuild(e){if(this.m_ifSceneBuild)return void console.warn("有场景正在构建！");let s;this.m_ifInit?s=we.instance.gameData.onCustoms:(this.m_ifInit=!0,s=we.instance.getDefaultCustoms());let i=O.instance.getSceneByLv(s);this.m_scene=i,this.m_ifSceneBuild=!0,ne.instance.sendEvent(F.GameLevelsBuildBefore),ne.instance.sendEvent($.SceneGameCustomsLoading,[-1]),i.buildScene(Laya.Handler.create(this,this.customsProgress,null,!1)).then(a=>{if(this.m_ifSceneBuild=!1,Le.instance.setEnvironment(this.m_scene.scene),t.addScrCon(i.scene),t.addCommonCon(),x.ifPreloadCustoms){let e=we.instance.getPreloadCustoms();O.instance.preloadSceneRes(e)}this.onCustomsInit(s),e&&e.run(),ne.instance.sendEvent(F.GameLevelsOnBuild)})}onCustomsInit(e){}customsProgress(e){this.m_ifSceneBuild&&(void 0===e&&(e=1),ne.instance.sendEvent($.SceneGameCustomsLoading,[100*e]))}gameLevelsDelete(){ne.instance.sendEvent(F.GameLevelsDeleteBefore),this.m_scene&&this.m_scene.scene&&this.m_scene.clearScene(),this.m_scene=null,ne.instance.sendEvent(F.GameLevelsOnDelete)}gameOtherLevelsBuild(e,t){if(this.m_ifSceneBuild)return void console.warn("有场景正在构建！");let s=O.instance.getOtherSceneByName(e);this.m_otherScene[e]=s,this.m_ifSceneBuild=!0,ne.instance.sendEvent(F.GameLevelsBuildBefore),ne.instance.sendEvent($.SceneGameCustomsLoading,[-1]),s.buildScene(Laya.Handler.create(this,this.customsProgress,null,!1)).then(s=>{this.m_ifSceneBuild=!1,Le.instance.setOtherEnvironment(e,s),t&&t.run()})}gameOtherLevelsDelete(e){let t=this.m_otherScene[e];t?(t.clearScene(),this.m_otherScene[e]=void 0):console.warn("试图清除不存在的场景！")}}!function(e){e.anim_enter="m_anim_enter",e.anim_exit="m_anim_exit"}(Z||(Z={})),function(e){e.Bg="EUILayer_Bg",e.Main="EUILayer_Main",e.OneUI="EUILayer_OneUI",e.Panel="EUILayer_Panel",e.Popup="EUILayer_Popup",e.Prop="EUILayer_Prop",e.Tip="EUILayer_Tip",e.Pause="EUILayer_Pause",e.Set="EUILayer_Set",e.Top="EUILayer_Top",e.Loading="EUILayer_Loading",e.Native="EUILayer_Native"}(Y||(Y={}));class ve{constructor(){this.ifUpdate=!0,this.top=0,this.bottom=0,this.tweenTime=0}}class De{static getLayer(e){return this.LayerList[e]}static Init(){fgui.UIConfig.packageFileExtension="bin",Laya.stage.addChild(fgui.GRoot.inst.displayObject),this.LayerList={};for(let e in Y)this.LayerList[Y[e]]=fgui.GRoot.inst.addChild(new fgui.GComponent);this.UpdateAllUI(),Laya.stage.on(Laya.Event.RESIZE,this,this.UpdateAllUI)}static AddUI(e,t,s){let i=e.createInstance();if(s==Y.OneUI){let e=De.oneUIs;e.length>0&&e.forEach(e=>{e&&e.Hide()}),De.oneUIs=[]}this.getLayer(s).addChild(i);let a=Symbol("fguiData");return this._cacheFguiData[a]=t,i[this.m_uiDataKey]=a,this.setUIData(i,t),i}static setUIToTopShow(e,t){let s=this.getLayer(t);-1!=s.getChildIndex(e)?(e.removeFromParent(),s.addChild(e)):console.warn(...i.packWarn("设置ui到最顶层失败，因为该层级里面没有该UI！"))}static UpdateAllUI(){let e,t,s=Laya.stage.width,i=Laya.stage.height;fgui.GRoot.inst.setSize(s,i);for(let a=0,n=fgui.GRoot.inst.numChildren;a<n;++a){(e=fgui.GRoot.inst.getChildAt(a)).setSize(s,i),e.y=0;for(let s=0,i=e.numChildren;s<i;s++){t=e.getChildAt(s);let i=this._cacheFguiData[t[this.m_uiDataKey]];i.ifUpdate&&this.setUIData(t,i)}}}static setUIData(e,t=new ve){e.setSize(fgui.GRoot.inst.width,fgui.GRoot.inst.height-t.top-t.bottom),e.y=t.top}static CheckIn(e,t,s){return t>e.x&&t<e.x+e.width&&s>e.y&&s<e.y+e.height}}De.m_uiDataKey=Symbol("$UIData"),De._cacheFguiData={},De.oneUIs=[];class Ce{constructor(){this._layer=Y.Panel,this._ifBelongUIMediator=!1,this._belongDownUIMediator=[],this._belongUpUIMediator=[],this._isShow=!1,this.m_serialNumber=Ae.GlobalSerialNumber}get ui(){return this._ui}get serialNumber(){return this.m_serialNumber}get layer(){return this._layer}get _fguiData(){return new ve}get ifBelongUIMediator(){return this._ifBelongUIMediator}get belongDownUIMediator(){return this._belongDownUIMediator}get belongUpUIMediator(){return this._belongUpUIMediator}get isShow(){return this._isShow}get isDispose(){return this.ui.isDisposed}set keyId(e){this.m_keyId=e}get keyId(){return this.m_keyId}setUIToTopShow(){this._ui&&De.setUIToTopShow(this._ui,this._layer)}Show(){if(this._isShow)this.setUIToTopShow();else if(this.OnshowBefore(),this._isShow=!0,!this._ui||this._ui&&this._ui.isDisposed?(this._ui=De.AddUI(this._classDefine,this._fguiData,this._layer),this._layer==Y.OneUI&&De.oneUIs.push(this)):this.ui.visible=!0,this.setUIToTopShow(),this._OnShow(),this._ui[Z.anim_enter]){this._ui[Z.anim_enter].play(Laya.Handler.create(this,this._CallEnterAnimEnd))}else this.OnEnterAnimEnd()}_CallEnterAnimEnd(){this.OnEnterAnimEnd()}OnEnterAnimEnd(){}OnshowBefore(){}_OnShow(){}Hide(e=!0){if(null!=this._ui&&!this._ui.isDisposed&&this._isShow)if(this._isShow=!1,this.OnHideBefore(),this._ui[Z.anim_exit]){this._ui[Z.anim_exit].play(Laya.Handler.create(this,this._DoHide,[e]))}else this._DoHide(e)}_DoHide(e){e?this._ui.dispose():this._ui.visible=!1,this._OnHide()}OnHideBefore(){}_OnHide(){}}class Ae{static get GlobalSerialNumber(){return this.m_GlobalSerialNumber++,this.m_GlobalSerialNumber}}Ae.m_GlobalSerialNumber=0;class Ue extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGameLoading")}onConstruct(){this.m_shade=this.getChildAt(0),this.m_text=this.getChildAt(1),this.m_progress=this.getChildAt(2)}}Ue.URL="ui://kk7g5mmmg7a1o";class Re extends Ce{constructor(){super(),this._layer=Y.Loading}static get instance(){return this.m_instance||(this.m_instance=new Re,this.m_instance._classDefine=Ue),this.m_instance}_OnShow(){ne.instance.onEvent(K.GameLoading,this,this.gameLoading)}gameLoading(e){this.ui.m_progress.value=e}_OnHide(){ne.instance.offEnent(K.GameLoading,this,this.gameLoading)}}class Oe extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGameMain")}onConstruct(){this.m_text=this.getChildAt(0)}}Oe.URL="ui://kk7g5mmmsyta9f";class xe extends Ce{constructor(){super(),this._layer=Y.Main}static get instance(){return this.m_instance||(this.m_instance=new xe,this.m_instance._classDefine=Oe),this.m_instance}_OnShow(){}_OnHide(){}}class Pe extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGamePlay")}onConstruct(){this.m_text=this.getChildAt(0)}}Pe.URL="ui://kk7g5mmmg7a1r";class ke extends Ce{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new ke,this.m_instance._classDefine=Pe),this.m_instance}_OnShow(){}_OnHide(){}}class Me extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGameStart")}onConstruct(){this.m_text=this.getChildAt(0)}}Me.URL="ui://kk7g5mmmg7a1v";class Ee extends Ce{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new Ee,this.m_instance._classDefine=Me),this.m_instance}_OnShow(){}_OnHide(){}}!function(e){e.GameLoading="EUI_GameLoading",e.CustomsLoading="EUI_CustomsLoading",e.TestMain="EUI_TestMain",e.TestPlatform="EUI_TestPlatform",e.Main="EUI_Main",e.Set="EUI_Set",e.Pause="EUI_Pause",e.Play="EUI_Play",e.Start="EUI_Start",e.Com="EUI_Com",e.End="EUI_End"}(X||(X={}));class Ge extends r{constructor(){super(...arguments),this.m_UIMediator={},this.m_onShowUI=[],this.m_ifSetMediatroList=!1}setProxyMediatroList(e){this.m_UIMediator=e,this.m_onShowUI=[],this.m_ifSetMediatroList=!0,this.Init()}Init(){}get ifSetMediatroList(){return this.m_ifSetMediatroList}get onShowUIs(){return this.m_onShowUI}getUIMeiatro(e){return this.m_UIMediator[e]}closeUI(e){this.setUIState([{typeIndex:e.keyId,state:!1}],!1)}setUIState(e,t=!0,s={state:!1,dispose:!0},a,n){if(!this.m_ifSetMediatroList)return void console.error(...i.packError("还没有为UI代理类设置代理UI调度者列表！"));for(let t of e)void 0===t.state&&(t.state=!0),void 0===t.dispose&&(t.dispose=!0);void 0===s.dispose&&(s.dispose=!0);let o,r=[],h=[];e=S.ObjUnique(e,e=>e.typeIndex),e=this.statesFilter(e);for(let t of e)t.state?(-1!=(o=this.m_onShowUI.findIndex(e=>e.typeIndex==t.typeIndex))&&this.m_onShowUI.splice(o,1),r.push(t)):-1!=(o=this.m_onShowUI.findIndex(e=>e.typeIndex==t.typeIndex))&&(this.m_onShowUI.splice(o,1),h.push(t));if(t){let e=[];for(let t in this.m_UIMediator)-1==r.findIndex(e=>e.typeIndex==t)&&-1==h.findIndex(e=>e.typeIndex==t)&&e.push({typeIndex:t,state:s.state,dispose:s.dispose});s.state?r.unshift(...e):h.push(...e)}else r.unshift(...this.m_onShowUI);void 0!==a&&(a=S.Unique(a),r=r.filter(e=>-1!=a.findIndex(t=>t==this.m_UIMediator[e.typeIndex].layer))),void 0!==n&&(n=S.Unique(n),h=h.filter(e=>-1!=n.findIndex(t=>t==this.m_UIMediator[e.typeIndex].layer)));for(let e of h)this.m_UIMediator[e.typeIndex].ifBelongUIMediator?console.warn(...i.packWarn("有一个附属UI的UI调度者试图被隐藏，KEY为",this.m_UIMediator[e.typeIndex].keyId)):this.hideUIMediator(this.m_UIMediator[e.typeIndex],e.dispose);for(let e of r)this.m_UIMediator[e.typeIndex].ifBelongUIMediator?console.warn(...i.packWarn("有一个附属UI的UI调度者试图被显示，KEY为",this.m_UIMediator[e.typeIndex].keyId)):this.showUIMediator(this.m_UIMediator[e.typeIndex]);this.m_onShowUI=r}statesFilter(e){return e.filter(e=>void 0!==this.m_UIMediator[e.typeIndex])}hideUIMediator(e,t,s=!1){e.belongUpUIMediator.length>0&&e.belongUpUIMediator.forEach(e=>{this.hideUIMediator(e,t,!0)}),!s||e.ifBelongUIMediator?e.Hide(t):console.warn(...i.packWarn("有一个不是附属UI的UI调度者试图被隐藏，KEY为",e.keyId)),e.belongDownUIMediator.length>0&&e.belongDownUIMediator.forEach(e=>{this.hideUIMediator(e,t,!0)})}showUIMediator(e,t=!1){e.belongDownUIMediator.length>0&&e.belongDownUIMediator.forEach(e=>{this.showUIMediator(e,!0)}),!t||e.ifBelongUIMediator?e.Show():console.warn(...i.packWarn("有一个不是附属UI的UI调度者试图被显示，KEY为",e.keyId)),e.belongUpUIMediator.length>0&&e.belongUpUIMediator.forEach(e=>{this.showUIMediator(e,!0)})}}class Be extends Ge{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new Be),this.m_instance}get gameMainMediator(){return this.getUIMeiatro(X.Main)}Init(){ne.instance.onEvent(K.GameLoading,this,this.gameLoading),ne.instance.onEvent(K.GameResLoading,this,this.gameResLoading),ne.instance.onEvent($.SceneGameCustomsLoading,this,this.gameCustomsLoading)}Start(){this.setUIState([{typeIndex:X.Main},{typeIndex:X.TestMain}])}gameLoading(){}gameResLoading(){}gameCustomsLoading(e){-1==e&&this.setUIState([{typeIndex:X.CustomsLoading}],!1)}}class Ve extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGameCustomsLoading")}onConstruct(){this.m_shade=this.getChildAt(0),this.m_text=this.getChildAt(1),this.m_progress=this.getChildAt(2)}}Ve.URL="ui://kk7g5mmmdbmi13";class Ne extends Ce{constructor(){super(),this._layer=Y.Loading}static get instance(){return this.m_instance||(this.m_instance=new Ne,this.m_instance._classDefine=Ve),this.m_instance}_OnShow(){ne.instance.onEvent($.SceneGameCustomsLoading,this,this.CustomsLoading)}CustomsLoading(e){this.ui.m_progress.value=e,100==e&&Be.instance.setUIState([{typeIndex:X.CustomsLoading,state:!1}],!1)}_OnHide(){ne.instance.offEnent($.SceneGameCustomsLoading,this,this.CustomsLoading)}}class Te extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGamePause")}onConstruct(){this.m_text=this.getChildAt(0)}}Te.URL="ui://kk7g5mmm6vcq5g";class He extends Ce{constructor(){super(),this._layer=Y.Pause}static get instance(){return this.m_instance||(this.m_instance=new He,this.m_instance._classDefine=Te),this.m_instance}_OnShow(){}_OnHide(){}}class Fe extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGameSet")}onConstruct(){this.m_text=this.getChildAt(0)}}Fe.URL="ui://kk7g5mmm6vcq4u";class We extends Ce{constructor(){super(),this._layer=Y.Set}static get instance(){return this.m_instance||(this.m_instance=new We,this.m_instance._classDefine=Fe),this.m_instance}_OnShow(){}_OnHide(){}}class je extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGameCom")}onConstruct(){this.m_text=this.getChildAt(0)}}je.URL="ui://kk7g5mmmq3ng9w";class Ke extends Ce{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new Ke,this.m_instance._classDefine=je),this.m_instance}_OnShow(){}_OnHide(){}}class $e extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGameEnd")}onConstruct(){this.m_text=this.getChildAt(0)}}$e.URL="ui://kk7g5mmmlaxd19";class ze extends Ce{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new ze,this.m_instance._classDefine=$e),this.m_instance}_OnShow(){}_OnHide(){}}class Qe extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGameTestMain")}onConstruct(){this.m_UIButton=this.getChildAt(0),this.m_UI=this.getChildAt(1),this.m_test=this.getChildAt(3),this.m_testText=this.getChildAt(4),this.m_dataTest=this.getChildAt(6),this.m_dataTestText=this.getChildAt(7),this.m__test=this.getChildAt(9)}}Qe.URL="ui://kk7g5mmmo9js9x";class qe extends Ie{constructor(){super(...arguments),this.testNumber=0,this.testBoolean=!1,this.testArray=[],this.testObject={a:0,b:0,c:0}}}class Je extends fe{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new Je),this._instance}get _saveName(){return"GameTest"}getNewData(){return new qe}}class Ze extends he{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new Ze),this.m_instance}get data(){return this.m_data}initData(){this.m_data=Je.instance.saveData,Je.instance.addKeySetMonitor(this,()=>{console.log("根属性testNumber或者testBoolean改变，属性监听")},[Je.instance.rootData.testNumber,Je.instance.rootData.testBoolean]),Je.instance.addObjectSetMonitor(this,()=>{console.log("根属性testNumber改变，对象监听")},Je.instance.rootData,Je.instance.rootData.testNumber),Je.instance.addObjectSetMonitor(this,()=>{console.log("对象属性a改变")},Je.instance.rootData.testObject,Je.instance.rootData.testObject.a),Je.instance.addObjectSetMonitor(this,()=>{console.log("数组属性改变")},Je.instance.rootData.testArray),Je.instance.addObjectSetMonitor(this,()=>{console.log("对象属性a,或者b改变")},Je.instance.rootData.testObject,["a","b"])}}class Ye{constructor(){this.data=new Proxy({a:"数据"},{get:(e,t)=>Ye.m_ifSetMon?"get拦截："+e[t]:e[t]}),console.log(this.data.a),console.log(this.getData()),console.log(this.data.a),console.log(JSON.stringify(this.data))}getData(){Ye.m_ifSetMon=!0;let e=this.data.a;return Ye.m_ifSetMon=!1,e}}Ye.m_ifSetMon=!1;class Xe extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGameTestUI")}onConstruct(){this.m_bg=this.getChildAt(0)}}Xe.URL="ui://kk7g5mmmh66e9z";class et extends Ce{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new et,this.m_instance._classDefine=Xe),this.m_instance}get _fguiData(){let e=new ve;return e.top=100,e.bottom=50,e}_OnShow(){this.ui.m_bg.onClick(this,this.close)}close(){this.Hide()}_OnHide(){}}class tt extends Ce{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new tt,this.m_instance._classDefine=Qe),this.m_instance}_OnShow(){this.ui.m_test.onClick(this,this.Test),this.ui.m_UIButton.onClick(this,this.UITest),this.ui.m_dataTest.onClick(this,this.dataTest)}Test(){Be.instance.setUIState([{typeIndex:X.TestPlatform}],!1)}UITest(){et.instance.Show()}dataTest(){Ze.instance.data.testNumber++,Ze.instance.data.testBoolean=!Ze.instance.data.testBoolean;for(let e=0;e<50;e++)Ze.instance.data.testArray.push("a");Ze.instance.data.testObject.a++}_OnHide(){}}class st{constructor(){this.appId="",this.appKey="",this.bannerId="",this.rewardVideoId="",this.interstitialId="",this.nativeId="",this.nativeBannerIds=[],this.nativeIconIds=[],this.nativeinterstitialIds=[],this.nativeinpageIds=[],this.shareId=""}}class it extends st{constructor(){super(...arguments),this.appId="",this.appKey="",this.bannerId="",this.rewardVideoId="",this.interstitialId="",this.nativeId="",this.nativeBannerIds=[],this.nativeIconIds=[],this.nativeinterstitialIds=[],this.nativeinpageIds=[],this.shareId=""}}class at extends st{constructor(){super(...arguments),this.appId="",this.appKey="",this.bannerId="",this.rewardVideoId="",this.interstitialId="",this.nativeId="",this.nativeBannerIds=[],this.nativeIconIds=[],this.nativeinterstitialIds=[],this.nativeinpageIds=[],this.shareId=""}}class nt extends st{constructor(){super(...arguments),this.appId="",this.appKey="",this.bannerId="",this.rewardVideoId="",this.interstitialId="",this.nativeId="",this.nativeBannerIds=[],this.nativeIconIds=[],this.nativeinterstitialIds=[],this.nativeinpageIds=[],this.shareId=""}}class ot extends st{constructor(){super(...arguments),this.appId="",this.appKey="",this.bannerId="",this.rewardVideoId="",this.interstitialId="",this.nativeId="",this.nativeBannerIds=[],this.nativeIconIds=[],this.nativeinterstitialIds=[],this.nativeinpageIds=[],this.shareId=""}}class rt extends st{constructor(){super(...arguments),this.appId="",this.appKey="",this.bannerId="",this.rewardVideoId="",this.interstitialId="",this.nativeId="",this.nativeBannerIds=[],this.nativeIconIds=[],this.nativeinterstitialIds=[],this.nativeinpageIds=[],this.shareId=""}}class ht extends st{constructor(){super(...arguments),this.appId="",this.appKey="",this.bannerId="",this.rewardVideoId="",this.interstitialId="",this.nativeId="",this.nativeBannerIds=[],this.nativeIconIds=[],this.nativeinterstitialIds=[],this.nativeinpageIds=[],this.shareId=""}}!function(e){e.PAUSE_AUDIO="PAUSE_AUDIO",e.RESUM_AUDIO="RESUM_AUDIO",e.AD_CONFIG_GETTED="AD_CONFIG_GETTED",e.SELF_AD_INITED="SELF_AD_INITED"}(ee||(ee={})),function(e){e.None="EPlatformType_None",e.Web="EPlatformType_Web",e.WX="EPlatformType_WX",e.TT="EPlatformType_TT",e.QQ="EPlatformType_QQ",e.VIVO="EPlatformType_VIVO",e.OPPO="EPlatformType_OPPO",e.BD="EPlatformType_BD",e.KG="EPlatformType_KG",e.Alipay="EPlatformType_Alipay",e.HW="EPlatformType_HW",e.QTT="EPlatformType_QTT"}(te||(te={}));class lt{static NextFrame(){return this.Frames(2)}static Frames(e){return new Promise(function(t){Laya.timer.frameOnce(e,null,()=>{t()})})}static Seconds(e){return new Promise(function(t){Laya.timer.once(1e3*e,null,()=>{t()})})}}class ct{Vibrate(e){console.log("调用震动",e),navigator.vibrate?e?navigator.vibrate(400):navigator.vibrate(15):console.log("不支持设备震动！")}}class dt extends ct{Vibrate(e){console.log("调用震动",e),window.wx&&(e?Laya.timer.callLater(wx,wx.vibrateLong,[null]):Laya.timer.callLater(wx,wx.vibrateShort,[null]))}}class ut extends r{static get instance(){return null==this._instance&&(this._instance=new ut),this._instance}get PlatformInstance(){return this.m_platformInstance||console.error(...i.packError("还没有设置过平台实例代理！")),this.m_platformInstance}set PlatformInstance(e){this.m_platformInstance=e}static get platformStr(){return ut.GetPlatformStr(this._instance.m_platformInstance.platform)}static GetPlatformStr(e){switch(e){case te.None:return"未识别";case te.Web:return"网页";case te.BD:return"百度";case te.OPPO:return"Oppo";case te.QQ:return"QQ";case te.TT:return"头条";case te.VIVO:return"Vivo";case te.WX:return"微信";case te.QTT:return"趣头条";default:return"未定义"+e}}}class mt{constructor(){this.supportRecord=!1,this.isRecording=!1,this.isPausing=!1,this.isRecordSuccess=!1}StartRecord(e,t){console.log("该平台"+ut.platformStr+"不支持录制视频")}StopRecord(e){console.log("该平台"+ut.platformStr+"不支持录制视频")}Pause(e){console.log("该平台"+ut.platformStr+"不支持录制视频")}Resume(e){console.log("该平台"+ut.platformStr+"不支持录制视频")}RecordClip(e){console.log("该平台"+ut.platformStr+"不支持录制视频")}ShareVideo(e,t,s){s&&s.run()}}class _t{static ToHex(e){return e.toString(16)}static RandomFromArrayUtilscept(e,t){let s=[];for(let i=0;i<e.length;++i)t!=e[i]&&s.push(e[i]);return this.RandomFromArray(s)}static RandomFromArray(e){return e[_t.RandomInt(0,e.length)]}static RandomArrayFromArray(e,t){let s=[],i=[];for(let t=0;t<e.length;++t)i.push(t);for(let a=0;a<t;++a){let t=_t.RandomInt(0,i.length),a=i[t];S.RemoveAt(i,t),s.push(e[a])}return s}static RandomFromWithWeight(e,t){if(null==e||0==e.length)return null;var s=0;for(var i of t)s+=i;for(var a=_t.Random(0,s),n=0,o=0;o<e.length;++o)if(a<(n+=t[o]))return e[o];return e[e.length-1]}static RandomInt(e,t){return Math.floor(this.Random(e,t))}static Random(e,t){return(t-e)*Math.random()+e}static randomRangeInt(e,t){return Math.floor(Math.random()*(t-e)+e)}static RandomRatio(e){return e>.01*_t.RandomInt(0,1e4)}static Clamp(e,t,s){return e<t?t:e>s?s:e}static Clamp01(e){return this.Clamp(e,0,1)}static Sign(e){return 0==e?1:e>0?1:-1}static GetNumCount(e){for(var t=0,s=e;s/10>0;)s=Math.floor(s/10),t++;return t}static Lerp(e,t,s){return e+(t-e)*_t.Clamp01(s)}static MoveTowardsAngle(e,t,s){var i=_t.DeltaAngle(e,t);return 0-s<i&&i<s?t:(t=e+i,_t.MoveTowards(e,t,s))}static MoveTowards(e,t,s){return Math.abs(t-e)<=s?t:e+Math.sign(t-e)*s}static DeltaAngle(e,t){var s=_t.Repeat(t-e,360);return s>180&&(s-=360),s}static Repeat(e,t){return _t.Clamp(e-Math.floor(e/t)*t,0,t)}static IsSimilar(e,t){return e==t}}_t.Deg2Rad=.0175,_t.Rad2Deg=57.2958;class gt{}class ft{constructor(){this._shareInfoList=[]}static get instance(){return null==this._instance&&(this._instance=new ft),this._instance}AddShareInfo(e){for(let t of this._shareInfoList)if(t.shareId==e.shareId)return;this._shareInfoList.push(e)}GetShareInfo(e=null){if(0==this._shareInfoList.length){return new gt}if(null!=e)for(let t of this._shareInfoList)if(t.shareId==e)return t;return _t.RandomFromArray(this._shareInfoList)}ShareAppMessage(e){ut.instance.PlatformInstance.ShareAppMessage(e,Laya.Handler.create(this,()=>{console.log("分享成功")}),null)}}class pt{constructor(){this.platform=te.WX,this.safeArea=null,this.recordManager=new mt,this.device=new dt,this.loginCode=null,this.isSupportJumpOther=!0,this._isBannerLoaded=!1,this._isVideoLoaded=!1,this._isInterstitialLoaded=!1,this._cacheVideoAD=!1,this.NavigateToAppSuccess=null}Init(e){this._base=window.wx,null!=this._base?(this.platformData=e,this.recordManager.Platform=this,this._InitLauchOption(),this._Login(),this._InitShareInfo(),this._InitSystemInfo(),this._CreateBannerAd(),this._CreateVideoAd(),this._CreateInterstitalAd(),window.iplatform=this):console.error(...i.packError("平台初始化错误",ut.platformStr))}_CheckUpdate(){let e=this._base.getUpdateManager();null!=e&&(e.onCheckForUpdate(function(e){console.log("onCheckForUpdate",e.hasUpdate),e.hasUpdate&&this._base.showToast({title:"即将有更新请留意"})}),e.onUpdateReady(()=>{this._base.showModal({title:"更新提示",content:"新版本已经准备好，是否立即使用？",success:function(t){t.confirm?e.applyUpdate():this._base.showToast({icon:"none",title:"小程序下一次「冷启动」时会使用新版本"})}})}),e.onUpdateFailed(()=>{this._base.showToast({title:"更新失败，下次启动继续..."})}))}_Login(){this.loginState={isLogin:!1,code:""};let e={};e.success=(e=>{this.loginCode=e.code,this._OnLoginSuccess(e),console.error(this.loginState)}),e.fail=(e=>{console.error(ut.platformStr,"登录失败",e),this.loginState.isLogin=!1,this.loginState.code=""}),e.complete=(()=>{null!=this.onLoginEnd&&this.onLoginEnd.run()}),this._base.login(e)}GetStorage(e){if(this.base&&this.base.getStorageSync&&e)try{return this.base.getStorageSync(e)}catch(e){return console.log("getStorageSync error: ",JSON.stringify(e)),null}}SetStorage(e,t){if(this.base&&this.base.getStorageSync&&e)try{return this.base.setStorageSync(e,t)}catch(e){console.log("setStorageSync error: ",JSON.stringify(e))}}_OnLoginSuccess(e){console.log(ut.platformStr,"登录成功",e),this.loginState.isLogin=!0,this.loginState.code=e.code}_InitLauchOption(){this._base.onShow(this._OnShow),this._base.onHide(this._OnHide);let e=this._base.getLaunchOptionsSync();this._OnShow(e)}_InitShareInfo(){this._base.showShareMenu({withShareTicket:!0,success:e=>{console.log("InitShareSuccess",e)},fail:e=>{console.log("InitShareFailed",e)},complete:e=>{console.log("InitShareComplete",e)}}),this._base.onShareAppMessage(()=>{let e=ft.instance.GetShareInfo();return pt._WrapShareInfo(e)})}static _WrapShareInfo(e){let t={};if(e.shareTitle&&(t.title=e.shareTitle),e.shareImg&&(t.imageUrl=e.shareImg),e.sharePath){t.query={};let s=e.sharePath.split("?")[1].split("&");for(let e of s){let s=e.split("=");t.query[s[0]]=s[1]}}return t}_InitSystemInfo(){this.base=this._base;try{this.systemInfo=this._base.getSystemInfoSync(),console.log("系统信息已获取",this.systemInfo),this.safeArea=this.systemInfo.safeArea,this._cacheScreenScale=this.systemInfo.screenWidth/Laya.stage.width}catch(e){console.error(e),console.error("获取设备信息失败,执行默认初始化"),this.safeArea=null}}_CreateInterstitalAd(){if(le.IsNullOrEmpty(this.platformData.interstitialId))return void console.log("无有效的插页广告ID,取消加载");this._interstitalFailedCount=0;let e={};e.adUnitId=this.platformData.interstitialId,this._intersitialAd=this._base.createInterstitialAd(e),this._intersitialAd&&(this._intersitialAd.onLoad(()=>{console.log("插页广告加载成功"),this._isInterstitialLoaded=!0}),this._intersitialAd.onError(e=>{this._interstitalFailedCount++,console.error("插页广告加载失败",e),this._interstitalFailedCount>10&&(console.log("第",this._interstitalFailedCount,"次重新加载插页广告"),this._intersitialAd.load())}))}_CreateVideoAd(){if(console.log("vedio ad id",this.platformData.rewardVideoId),!this._cacheVideoAD)return void console.log("当前策略为不缓存视频广告");let e=this._base.createRewardedVideoAd;if(null==e)return void console.error("无createRewardedVideoAd方法,跳过初始化");if(le.IsNullOrEmpty(this.platformData.rewardVideoId))return void console.log("无有效的视频广告ID,取消加载");this._videoFailedCount=0;let t={};t.adUnitId=this.platformData.rewardVideoId,this._rewardVideo=e(t),this._rewardVideo.onLoad(()=>{console.log("视频广告加载成功"),this._isVideoLoaded=!0}),this._rewardVideo.onError(e=>{this._videoFailedCount++,console.error("视频广告加载失败",e),this._videoFailedCount>10&&(console.log("第",this._videoFailedCount,"次重新加载视频广告"),this._rewardVideo.load())}),this._rewardVideo.onClose(e=>{Laya.stage.event(ee.RESUM_AUDIO),console.log("视频回调",e);let t=e.isEnded;lt.NextFrame().then(()=>{t?this._rewardSuccessed&&this._rewardSuccessed.run():this._rewardSkipped&&this._rewardSkipped.run()})})}_CreateBannerAd(){if(le.IsNullOrEmpty(this.platformData.bannerId))return void console.log("无有效的banner广告ID,取消加载");let e=this._base.getSystemInfoSync().windowWidth,t=this._base.getSystemInfoSync().windowHeight,s={};s.adUnitId=this.platformData.bannerId,s.adIntervals=30;let i={left:0,top:0,width:300};s.style=i,this._bannerAd=this._base.createBannerAd(s),this._isBannerLoaded=!1,this._bannerAd.onLoad(()=>{console.log("banner加载成功"),this._isBannerLoaded=!0,this._bannerAd.style.top=t-this._bannerAd.style.realHeight,this._bannerAd.style.left=(e-this._bannerAd.style.realWidth)/2}),this._bannerAd.onError(e=>{console.error("banner广告加载失败",e)})}IsBannerAvaliable(){return this._isBannerLoaded}IsVideoAvaliable(){return this._isVideoLoaded}IsInterstitalAvaliable(){return this._isInterstitialLoaded}ShowBannerAd(){this.IsBannerAvaliable()&&this._bannerAd.show()}HideBannerAd(){this._bannerAd.hide()}_DoCacheShowVideo(e,t){this._isVideoLoaded?(this._rewardSuccessed=e,this._rewardSkipped=t,this._isVideoLoaded=!1,Laya.stage.event(ee.PAUSE_AUDIO),this._rewardVideo.show()):console.error("视频广告尚未加载好")}_DoNoCacheShowVideo(e,t){if(this._rewardSuccessed=e,this._rewardSkipped=t,le.IsNullOrEmpty(this.platformData.rewardVideoId))return console.log("无有效的视频广告ID,取消加载"),void t.run();let s=this._base.createRewardedVideoAd;if(null==s)return console.error("无createRewardedVideoAd方法,跳过初始化"),void t.run();this._videoFailedCount=0;let i={};i.adUnitId=this.platformData.rewardVideoId,this._rewardVideo&&this._rewardVideo.offClose(this.onVideoClose),this._rewardVideo=s(i),this._rewardVideo.onLoad(()=>{console.log("视频广告加载成功"),this._isVideoLoaded=!0}),this._rewardVideo.onError(e=>{this._videoFailedCount++,console.error("视频广告加载失败",e,this._videoFailedCount)}),this._rewardVideo.onClose(e=>{Laya.stage.event(ee.RESUM_AUDIO),console.log("视频回调",e);let t=e.isEnded;lt.NextFrame().then(()=>{t?this._rewardSuccessed&&this._rewardSuccessed.run():this._rewardSkipped&&this._rewardSkipped.run()})}),this._rewardVideo.load().then(()=>(console.log("激励视频 加载成功"),this._rewardVideo.show().then(()=>{}).catch(e=>{console.error(e)})))}onVideoClose(e){Laya.stage.event(ee.RESUM_AUDIO),console.log("视频回调",e);let t=e.isEnded;lt.NextFrame().then(()=>{t?this._rewardSuccessed&&this._rewardSuccessed.run():this._rewardSkipped&&this._rewardSkipped.run()})}ShowRewardVideoAd(e,t){this._cacheVideoAD?this._DoCacheShowVideo(e,t):this._DoNoCacheShowVideo(e,t)}ShowRewardVideoAdAsync(){return new Promise(function(e){ut.instance.PlatformInstance.ShowRewardVideoAd(Laya.Handler.create(this,()=>{e(!0)}),Laya.Handler.create(this,()=>{e(!1)}))})}ShowInterstitalAd(){this._isInterstitialLoaded?this._intersitialAd.show():console.error("插页广告尚未加载好")}GetFromAppId(){return null==this.lauchOption.referrerInfo?null:le.IsNullOrEmpty(this.lauchOption.referrerInfo.appId)?null:this.lauchOption.referrerInfo.appId}_OnShow(e){console.log(ut.platformStr,"OnShow",e),ut.instance.PlatformInstance.lauchOption=e,ut.instance.PlatformInstance._CheckUpdate(),this.NavigateToAppSuccess=null,lt.NextFrame().then(()=>{ut.instance.PlatformInstance.onResume&&ut.instance.PlatformInstance.onResume.runWith(e)})}_OnHide(e){console.log(ut.platformStr,"OnHide",e),ut.instance.PlatformInstance.onPause&&ut.instance.PlatformInstance.onPause.runWith(e),this.NavigateToAppSuccess&&this.NavigateToAppSuccess()}ShareAppMessage(e,t,s){console.log("分享消息",e);let i=pt._WrapShareInfo(e);this._base.shareAppMessage(i),t&&t.run()}LoadSubpackage(e,t,s,i){if(null==this._base.loadSubpackage)return console.log("无加载子包方法,跳过加载子包",e),void(t&&t.run());let a={};a.name=e,a.success=(()=>{console.log("分包加载成功",e),t&&t.run()}),a.fail=(()=>{console.error("分包加载失败",e),s&&s.run()}),this._base.loadSubpackage(a).onProgressUpdate(e=>{Laya.Browser.onMobile&&console.log("分包加载进度",e),i&&i.runWith(e.progress/100)})}RecordEvent(e,t){console.log("记录事件",e,t);let s=this._base.aldSendEvent;null!=s?null!=t?s(e,t):s(e):console.error("阿拉丁sdk尚未接入,请检查配置")}CreateShareVideoBtn(e,t,s,i){let a={};a.style={left:e*this._cacheScreenScale,top:t*this._cacheScreenScale,height:i*this._cacheScreenScale,width:s*this._cacheScreenScale},a.share={query:{tick:1},bgm:"",timeRange:[0,6e4]},null==this._shareVideoBtn?this._shareVideoBtn=this._base.createGameRecorderShareButton(a):this._shareVideoBtn.show()}HideShareVideoBtn(){null!=this._shareVideoBtn&&this._shareVideoBtn.hide()}ShowToast(e){this._base.showToast({title:e,duration:2e3})}OpenGameBox(e){console.error("当前平台",ut.platformStr,"暂不支持互推游戏盒子")}NavigateToApp(e,t,s,i,a,n){return new Promise((i,a)=>{wx.navigateToMiniProgram({appId:e,path:t,extraData:s,envVersion:"",success:e=>{console.log("小游戏跳转成功",e),i(!0)},fail:()=>{console.log("小游戏跳转失败："),a(!1)},complete:()=>{}})})}createShortcut(){console.log("暂未实现")}}class It extends pt{constructor(){super(...arguments),this.platform=te.BD,this._showVideoLoad=!1}Init(e){this._base=window.swan,null!=this._base?(this.platformData=e,this.recordManager.Platform=this,this._InitLauchOption(),this._InitShareInfo(),this._InitSystemInfo(),this._isBannerLoaded=!1,this._isBannerShowed=!1,this._CreateVideoAd(),this._CreateInterstitalAd(),window.iplatform=this):console.error(...i.packError("平台初始化错误"))}_CreateBannerAd(){if(le.IsNullOrEmpty(this.platformData.bannerId))return void console.log("无有效的banner广告ID,取消加载");let e=this._base.getSystemInfoSync().windowWidth,t=this._base.getSystemInfoSync().windowHeight,s={};s.adUnitId=this.platformData.bannerId,s.appSid=this.platformData.sid;let i={left:0,top:0};i.width=e,s.style=i,this._bannerAd=this._base.createBannerAd(s),this._bannerAd.onLoad(()=>{console.log("banner加载成功"),this._isBannerLoaded=!0,this._bannerAd.style.top=t-this._bannerAd.style.height,this._bannerAd.show()}),this._bannerAd.onError(e=>{console.error("banner广告加载失败",e)})}_CreateVideoAd(){if(le.IsNullOrEmpty(this.platformData.rewardVideoId))return void console.log("无有效的视频广告ID,取消加载");this._videoFailedCount=0;let e={};e.adUnitId=this.platformData.rewardVideoId,e.appSid=this.platformData.sid,this._rewardVideo=this._base.createRewardedVideoAd(e),this._rewardVideo.onLoad(()=>{console.log("视频广告加载成功"),this._isVideoLoaded=!0}),this._rewardVideo.onError(e=>{this._videoFailedCount++,console.error("视频广告加载失败",e),this._videoFailedCount>10&&(console.log("第",this._videoFailedCount,"次重新加载视频广告"),this._rewardVideo.load())}),this._rewardVideo.onClose(e=>{this._base.hideLoading(),Laya.stage.event(ee.RESUM_AUDIO),console.log("视频回调",e),e.isEnded?this._rewardSuccessed&&this._rewardSuccessed.run():this._rewardSkipped&&this._rewardSkipped.run(),this._rewardVideo.load()})}_CreateInterstitalAd(){}LoadSubpackage(e,t,s,i){let a={};a.name=e,a.success=(()=>{console.log("分包加载成功",e),t&&t.run()}),a.fail=(()=>{console.error("分包加载失败",e),s&&s.run()}),this._base.loadSubpackage(a).onProgressUpdate(e=>{if(i){let t=e.progress/100;isNaN(t)&&(t=e.loaded/e.total),i.runWith(t)}})}RecordEvent(e,t){this._base.reportAnalytics(e,t)}ShowBannerAd(){this._isBannerLoaded||this._CreateBannerAd()}HideBannerAd(){this._isBannerLoaded&&(this._isBannerLoaded=!1,this._bannerAd&&this._bannerAd.destroy())}}class yt extends mt{constructor(){super(...arguments),this.supportRecord=!1}ShareVideo(e,t,s){this.supportRecord?(console.log("强制模拟成功"),e&&e.run()):(console.log("强制模拟失败"),s&&s.run())}}class St{constructor(){this.platform=te.Web,this.safeArea=null,this.recordManager=new yt,this.device=new ct,this.systemInfo=null,this.isSupportJumpOther=!0}Init(e){this.loginState={isLogin:!1,code:null},this.recordManager.Platform=this,Laya.timer.once(500,this,this._FakeLoginEnd)}_FakeLoginEnd(){this.onLoginEnd&&this.onLoginEnd.run()}IsBannerAvaliable(){return!1}IsVideoAvaliable(){return!0}IsInterstitalAvaliable(){return!1}ShowBannerAd(){console.log("调用ShowBannerAd")}HideBannerAd(){console.log("调用HideBannerAd")}ShowRewardVideoAd(e,t){console.log("调用ShowRewardVideoAd"),e.run()}ShowRewardVideoAdAsync(){return new Promise(function(e){ut.instance.PlatformInstance.ShowRewardVideoAd(Laya.Handler.create(this,()=>{e(!0)}),Laya.Handler.create(this,()=>{e(!1)}))})}ShowInterstitalAd(){console.log("调用ShowInterstitalAd")}GetFromAppId(){return null}ShareAppMessage(e,t=null,s=null){console.log("分享消息",e),t&&t.run()}LoadSubpackage(e,t,s){t&&t.run()}RecordEvent(e,t){console.log("记录事件",e,t)}ShareVideoInfo(){console.log(ut.platformStr,"暂未实现录屏功能")}_CheckUpdate(){}ShowToast(e){console.log("显示消息：",e)}OpenGameBox(){console.error("当前平台",ut.platformStr,"暂不支持互推游戏盒子")}NavigateToApp(e,t,s){return new Promise((t,s)=>{console.error("当前平台",ut.platformStr,`暂不支持小程序跳转appid:${e}`),t(!1)})}createShortcut(){console.log("创建桌面图标")}GetStorage(e){return console.log("读本地存储"),Laya.LocalStorage.getItem(e)}SetStorage(e,t){console.log("写本地存储"),Laya.LocalStorage.setItem(e,t)}}var wt,Lt,bt,vt,Dt,Ct,At,Ut,Rt,Ot;function __awaiter(e,t,s,i){return new(s||(s=Promise))(function(a,n){function fulfilled(e){try{step(i.next(e))}catch(e){n(e)}}function rejected(e){try{step(i.throw(e))}catch(e){n(e)}}function step(e){e.done?a(e.value):new s(function(t){t(e.value)}).then(fulfilled,rejected)}step((i=i.apply(e,t||[])).next())})}class xt extends pt{constructor(){super(...arguments),this.platform=te.OPPO,this.safeArea=null,this.recordManager=new mt,this.device=new ct,this.isSupportJumpOther=!0,this._isBannerLoaded=!1,this._isVideoLoaded=!1,this._isInterstitialLoaded=!1,this._isInterstitialCanShow=!0,this._nativeAdLoaded=!1,this._cacheVideoAD=!1}Init(e){this._base=window.qg,null!=this._base?(this.platformData=e,this.recordManager.Platform=this,this._InitLauchOption(),this._Login(),this._InitSystemInfo(),this.getSystemInfo(),this.systemInfo.platformVersion>=1051||this._base.initAdService({appId:e.appId,isDebug:!0,success:()=>{console.log("oppo广告","初始化广告服务成功",e),this._CreateVideoAd()},fail:()=>{console.error("oppo广告","初始化广告服务失败")}}),window.iplatform=this):console.error(...i.packError("平台初始化错误",ut.platformStr))}getSystemInfo(){this._base.getSystemInfo({success:e=>{this.systemInfo=e,console.log(this.systemInfo)},fail:()=>{},complete:()=>{}})}reportMonitor(){console.log("oppo上报数据",this.systemInfo),this.systemInfo&&this.systemInfo.platformVersion>=1060&&this._base.reportMonitor("game_scene",0)}_CheckUpdate(){}_Login(){this.loginState={isLogin:!1,code:""};let e={};e.success=(e=>{this._OnLoginSuccess(e)}),e.fail=(e=>{console.error(ut.platformStr,"登录失败",e),this.loginState.isLogin=!1,this.loginState.code=""}),e.complete=(e=>{null!=this.onLoginEnd&&this.onLoginEnd.run()}),this._base.login(e)}_OnLoginSuccess(e){console.log(ut.platformStr,"登录成功",e),this.loginState.isLogin=!0,this.loginState.code=e.token}ShareAppMessage(e,t,s){}_InitLauchOption(){this._base.onShow(this._OnShow),this._base.onHide(this._OnHide);let e=this._base.getLaunchOptionsSync();this._OnShow(e)}canCreateShortcut(){return new Promise((e,t)=>{qg.hasShortcutInstalled({success:function(t){e(t)},fail:function(e){t()},complete:function(){}})})}createShortcut(){return new Promise((e,t)=>{qg.hasShortcutInstalled({success:function(s){0==s?qg.installShortcut({success:function(){e()},fail:function(e){t()},complete:function(){}}):e()},fail:function(e){t()},complete:function(){}})})}_CreateInterstitalAd(){}_CreateVideoAd(){if(!this._cacheVideoAD)return void console.log("当前策略为不缓存视频广告");let e=this._base.createRewardedVideoAd;if(null==e)return void console.error("无createRewardedVideoAd方法,跳过初始化");if(le.IsNullOrEmpty(this.platformData.rewardVideoId))return void console.log("无有效的视频广告ID,取消加载");this._videoFailedCount=0;let t={};t.adUnitId=this.platformData.rewardVideoId,this._rewardVideo=e(t),this._rewardVideo.onLoad(()=>{console.log("视频广告加载成功"),this._isVideoLoaded=!0}),this._rewardVideo.onError(e=>{this._videoFailedCount++,console.error("视频广告加载失败",e),this._videoFailedCount>10&&(console.log("第",this._videoFailedCount,"次重新加载视频广告"),this._rewardVideo.load())}),this._rewardVideo.onClose(e=>{Laya.stage.event(ee.RESUM_AUDIO),console.log("视频回调",e);let t=e.isEnded;lt.NextFrame().then(()=>{t?this._rewardSuccessed&&this._rewardSuccessed.run():this._rewardSkipped&&this._rewardSkipped.run()})})}IsBannerAvaliable(){return this._isBannerLoaded}IsVideoAvaliable(){return this._isVideoLoaded}IsInterstitalAvaliable(){return!1}IsNativeAvaliable(){return this._nativeAdLoaded}ShowBannerAd(){return __awaiter(this,void 0,void 0,function*(){if(le.IsNullOrEmpty(this.platformData.bannerId))return void console.log("无有效的banner广告ID,取消加载");if(this._bannerAd)return this._bannerAd.show(),void console.log("展示已有banner");this.HideBannerAd(),this._bannerAd=this._base.createBannerAd({adUnitId:this.platformData.bannerId});let e=!0,t=!1;for(this._bannerAd.show().then(s=>{console.log("banner加载成功",s),0==s.code&&(t=!0),e=!1}).catch(t=>{console.error("banner加载失败",t),e=!1});e;)yield lt.NextFrame();if(!t){console.log("banner展示失败,展示native广告"),this._bannerAd&&(this._bannerAd.destroy(),this._bannerAd=null);for(let e=0;e<this.platformData.nativeIconIds.length;++e){if(yield this._ShowNativeBanner(e))break;this._bannerAd.destroy()}}})}_ShowNativeBanner(e){return __awaiter(this,void 0,void 0,function*(){let t=this.base.createNativeAd({adUnitId:this.platformData.nativeBannerIds[e]});this._bannerAd=t;let s=yield t.load();if(0==s.code){let e=s.adList;return null==e||0==e.length?(console.error("native banner加载失败",s),!1):null!=e[0]||(console.error("native banner加载失败",s),!1)}return console.error("native banner加载失败",s),!1})}HideBannerAd(){this._bannerAd&&(this._bannerAd.destroy(),this._bannerAd=null)}ShowNativeAd(){return __awaiter(this,void 0,void 0,function*(){this.IsNativeAvaliable()})}HideNativeAd(){this.IsNativeAvaliable()}_DoCacheShowVideo(e,t){this._isVideoLoaded?(this._rewardSuccessed=e,this._rewardSkipped=t,this._isVideoLoaded=!1,Laya.stage.event(ee.PAUSE_AUDIO),this._rewardVideo.show()):console.error("视频广告尚未加载好")}_DoNoCacheShowVideo(e,t){if(this._rewardSuccessed=e,this._rewardSkipped=t,le.IsNullOrEmpty(this.platformData.rewardVideoId))return console.log("无有效的视频广告ID,取消加载"),void(this._rewardSkipped&&this._rewardSkipped.run());let s=this._base.createRewardedVideoAd;if(null==s)return console.error("无createRewardedVideoAd方法,跳过初始化"),void(this._rewardSkipped&&this._rewardSkipped.run());this._rewardVideo&&this._rewardVideo.destroy();let i={};i.adUnitId=this.platformData.rewardVideoId,this._rewardVideo=s(i),console.log("广告创建完成",i),this._rewardVideo.onClose(e=>{Laya.stage.event(ee.RESUM_AUDIO),console.log("视频回调",e);let t=e.isEnded;lt.NextFrame().then(()=>{t?this._rewardSuccessed&&this._rewardSuccessed.run():this._rewardSkipped&&this._rewardSkipped.run()})}),this._rewardVideo.onError(e=>{console.log("广告组件出现问题",e),this._rewardSkipped&&this._rewardSkipped.run()}),this._rewardVideo.onLoad(e=>{console.log("广告加载成功",e)}),this._rewardVideo.load().then(()=>{this._rewardVideo.show()})}ShowRewardVideoAd(e,t){this._cacheVideoAD?this._DoCacheShowVideo(e,t):this._DoNoCacheShowVideo(e,t)}ShowRewardVideoAdAsync(){return new Promise(function(e){ut.instance.PlatformInstance.ShowRewardVideoAd(Laya.Handler.create(this,()=>{e(!0)}),Laya.Handler.create(this,()=>{e(!1)}))})}_DisableInterstitalAd(){return __awaiter(this,void 0,void 0,function*(){this._isInterstitialCanShow=!1,yield lt.Seconds(60),this._isInterstitialCanShow=!0})}GetFromAppId(){return null==this.lauchOption.referrerInfo?null:le.IsNullOrEmpty(this.lauchOption.referrerInfo.appId)?null:this.lauchOption.referrerInfo.appId}CreatShortcut(){return new Promise((e,t)=>{qg.hasShortcutInstalled({success:function(s){0==s?qg.installShortcut({success:function(){e()},fail:function(e){t()},complete:function(){}}):e()},fail:function(e){t()},complete:function(){}})})}LoadSubpackage(e,t,s,i){let a={};a.name=e,a.success=(()=>{console.log("分包加载成功",e),t&&t.run()}),a.fail=(()=>{console.error("分包加载失败",e),s&&s.run()}),this._base.loadSubpackage(a).onProgressUpdate(e=>{console.log("分包加载进度",e),i&&i.runWith(e.progress/100)})}RecordEvent(e,t){console.log("[记录事件]",e,t)}CreateShareVideoBtn(e,t,s,i){}HideShareVideoBtn(){null!=this._shareVideoBtn&&this._shareVideoBtn.hide()}ShowToast(e){this._base.showToast({title:e,duration:2e3})}OpenGameBox(e){console.error("当前平台",ut.platformStr,"暂不支持互推游戏盒子")}NavigateToApp(e,t,s){return new Promise((i,a)=>{Laya.Browser.window.qg.navigateToMiniGame({pkgName:e,path:t,extraData:s,success:function(){i(!0),console.log("oppo小游戏跳转成功")},fail:function(e){a(!1),console.log("oppo小游戏跳转失败：",JSON.stringify(e))}})})}}class Pt extends pt{constructor(){super(...arguments),this.platform=te.QQ,this.isBannerShowing=!1}Init(e){this._base=window.qq,null!=this._base?(this.platformData=e,this.recordManager.Platform=this,this._InitLauchOption(),this._Login(),this._InitShareInfo(),this._InitSystemInfo(),this._CreateBannerAd(),this._CreateVideoAd(),this._CreateInterstitalAd(),window.iplatform=this,console.error("平台初始化完成",ut.platformStr)):console.error(...i.packError("平台初始化错误",ut.platformStr))}_InitSystemInfo(){try{let e=this._base.getSystemInfoSync();this._cacheScreenScale=e.screenWidth/Laya.stage.width,this.safeArea={},this.safeArea.width=e.windowWidth,this.safeArea.height=e.windowHeight,this.safeArea.top=e.statusBarHeight,this.safeArea.bottom=0,console.log("QQ覆写_InitSystemInfo",this.safeArea)}catch(e){console.error(e),console.error("获取设备信息失败,执行默认初始化"),this.safeArea=null}}_CreateBannerAd(e){if(le.IsNullOrEmpty(this.platformData.bannerId))return void console.log("无有效的banner广告ID,取消加载");let t=this._base.getSystemInfoSync().windowWidth,s=this._base.getSystemInfoSync().windowHeight,i={};i.adUnitId=this.platformData.bannerId;let a={};a.top=s-80,a.width=300,a.left=(t-a.width)/2,i.style=a,this._bannerAd=this._base.createBannerAd(i),this._isBannerLoaded=!1,this._bannerAd.onLoad(()=>{console.log("qq banner加载成功",this._bannerAd),this._isBannerLoaded=!0,e&&this._bannerAd.show()}),this._bannerAd.onError(e=>{console.error("banner广告加载失败",e)}),this._bannerAd.onResize(e=>{console.log("onResize",e),this._bannerAd.style.top=s-80,this._bannerAd.style.left=(t-300)/2,console.log("onResize",this._bannerAd)})}IsBannerAvaliable(){return this._isBannerLoaded}IsVideoAvaliable(){return this._isVideoLoaded}IsInterstitalAvaliable(){return this._isInterstitialLoaded}ShowBannerAd(){this.IsBannerAvaliable()&&(this._bannerAd.show(),this.isBannerShowing=!0,Laya.timer.loop(15e3,this,this.refreshBanner))}refreshBanner(){this.isBannerShowing&&(console.log("refresh banner"),this._bannerAd.hide(),this._CreateBannerAd(!0))}HideBannerAd(){this.IsBannerAvaliable()&&(this._bannerAd&&(this._bannerAd.hide(),Laya.timer.clear(this,this.refreshBanner),this.isBannerShowing=!1),this._CreateBannerAd())}_DoCacheShowVideo(e,t){this._isVideoLoaded?(this._rewardSuccessed=e,this._rewardSkipped=t,this._isVideoLoaded=!1,Laya.stage.event(ee.PAUSE_AUDIO),this._rewardVideo.show()):console.error("视频广告尚未加载好")}_DoNoCacheShowVideo(e,t){if(this._rewardSuccessed=e,this._rewardSkipped=t,!this._isVideoLoaded||!this._rewardVideo){if(le.IsNullOrEmpty(this.platformData.rewardVideoId))return console.log("无有效的视频广告ID,取消加载"),void t.run();let e=this._base.createRewardedVideoAd;if(null==e)return console.error("无createRewardedVideoAd方法,跳过初始化"),void t.run();this._videoFailedCount=0;let s={};s.adUnitId=this.platformData.rewardVideoId,this._rewardVideo=e(s),this._rewardVideo.onLoad(()=>{console.log("视频广告加载成功"),this._isVideoLoaded=!0}),this._rewardVideo.onError(e=>{this._videoFailedCount++,console.error("视频广告加载失败",e,this._videoFailedCount)}),this._rewardVideo.onClose(e=>{Laya.stage.event(ee.RESUM_AUDIO),console.log(" NoCache - 视频回调",e);let t=e.isEnded;console.log("noCache---",t,"----",!!this._rewardSuccessed,"-----",!!this._rewardSkipped),t?this._rewardSuccessed&&this._rewardSuccessed.run():this._rewardSkipped&&this._rewardSkipped.run()})}this._rewardVideo.show().then(()=>{}).catch(e=>{console.log("广告组件出现问题",e),this._rewardVideo.load().then(()=>(console.log("手动加载成功"),this._rewardVideo.show().then(()=>{})))})}ShowRewardVideoAd(e,t){this._cacheVideoAD?this._DoCacheShowVideo(e,t):this._DoNoCacheShowVideo(e,t)}ShowRewardVideoAdAsync(){return new Promise(function(e){ut.instance.PlatformInstance.ShowRewardVideoAd(Laya.Handler.create(this,()=>{e(!0)},null,!0),Laya.Handler.create(this,()=>{e(!1)},null,!0))})}ShowInterstitalAd(){this._isInterstitialLoaded?this._intersitialAd.show():console.error("插页广告尚未加载好")}OpenGameBox(e=[]){this.showAppBox()}showAppBox(){this.appBox&&this.appBox.show()}createAppBox(e){this.appBox||(this.appBox=this._base.createAppBox({adUnitId:""})),this.appBox.load().then(()=>{e&&this.appBox.show()}),this.appBox.onClose(()=>{console.log("关闭盒子")})}hideAppBox(){this.appBox&&this.appBox.destroy()}showBlockAd(e=1){let t={adUnitId:"",style:{left:55,top:Laya.stage.height/2},size:e,orientation:"vertical"};this.blockAd=this._base.createBlockAd(t),this.blockAd.onLoad(()=>{console.log("积木广告加载完成"),this.blockAd.show().then(()=>{console.log("积木展示成功")}).catch(e=>{console.error("积木展示失败",e)})}),this.blockAd.onError(e=>{console.error("积木广告加载错误",e)}),this.blockAd.onResize(e=>{console.log("积木resize",e)})}hideBlockAd(){this.blockAd&&(this.blockAd.hide(),this.blockAd.destroy())}}class kt extends pt{constructor(){super(...arguments),this.platform=te.QTT}Init(e){this._base=window.qttGame,null!=this._base?(this.platformData=e,this.recordManager.Platform=this,window.iplatform=this):console.error(...i.packError("平台初始化错误"))}IsBannerAvaliable(){return!0}ShowBannerAd(){this._base.showBanner({index:1})}HideBannerAd(){this._base.hideBanner()}IsVideoAvaliable(){return!0}ShowRewardVideoAd(e,t){let s={index:1,gametype:1,rewardtype:1,data:{}};s.data.title="获得奖励",Laya.stage.event(ee.PAUSE_AUDIO),this._base.showVideo(s=>{Laya.stage.event(ee.RESUM_AUDIO),1==s?e&&e.run():t&&t.run()},s)}ShowInterstitalAd(){this.ShowHDReward()}ShowHDReward(){let e={index:1,rewardtype:1};this._base.showHDReward(e)}RecordEvent(e,t){console.log("记录事件",e,t)}}class Mt extends ct{constructor(e){super(),this._base=e}Vibrate(e){console.log("调用震动",e),e?this._base.vibrateLong({success(e){},fail(e){console.error("调用震动失败",e)},complete(e){}}):this._base.vibrateShort({success(e){},fail(e){console.error("调用震动失败",e)},complete(e){}})}}class Et extends mt{constructor(e){super(),this.supportRecord=!0,this._base=e,this.isRecording=!1,this.isRecordSuccess=!1,this.isPausing=!1,this._nativeManager=this._base.getGameRecorderManager(),this._nativeManager.onStart(e=>{console.log("平台开始录制",e),this.isRecording=!0,this.isRecordSuccess=!1,this._cacheStartHandle&&this._cacheStartHandle.run()}),this._nativeManager.onStop(e=>{console.log("平台停止录制",e),this.videoSavePath=e.videoPath,this.isRecording=!1,this.isRecordSuccess=!0,this._cacheStopHandle?this._cacheStopHandle.run():this._cacheOverTimeHandle&&this._cacheOverTimeHandle.run()}),this._nativeManager.onError(e=>{console.log("录制发生错误",e),this.isRecordSuccess=!1,this.isRecording=!1}),this._nativeManager.onPause(e=>{console.log("暂停录制视频",e),this.isPausing=!0,this._cachePauseHandle&&this._cachePauseHandle.run()}),this._nativeManager.onResume(e=>{console.log("暂停录制视频",e),this.isPausing=!1,this._cacheResumeHandle&&this._cacheResumeHandle.run()})}StartRecord(e,t){console.log("调用开始录屏"),this._cacheStartHandle=e,this._cacheOverTimeHandle=t,this._cacheStopHandle=null,this._nativeManager.start({duration:300})}Pause(e){this.isRecording?this.isPausing?console.log("当前录制状态已暂停"):(console.log("调用暂停录制"),this._cachePauseHandle=e,this._nativeManager.pause()):console.error("当前未开始录制,无法暂停录制")}Resume(e){this.isRecording?this.isPausing?(console.log("调用恢复录制"),this._cacheResumeHandle=e,this._nativeManager.resume()):console.log("当前录制状态正在进行中"):console.error("当前未开始录制,无法恢复录制")}RecordClip(e){this.isRecording?this.isPausing?console.log("当前录制状态已暂停,无法记录精彩时刻"):null==e?this._nativeManager.recordClip({}):this._nativeManager.recordClip({timeRange:e}):console.error("当前未开始录制,无法记录精彩时刻")}StopRecord(e){console.log("调用结束录屏"),this._cacheStopHandle=e,this._nativeManager.stop()}ShareVideo(e,t,s){if(this.isRecordSuccess){let s={channel:"video",title:"",desc:"",imageUrl:"",templateId:this.Platform.platformData.shareId,query:"",extra:{videoPath:this.videoSavePath,videoTopics:["抖音小游戏","猫眼金币跑酷"]},success(){e&&e.run()},fail(e){t&&t.run()}};this._base.shareAppMessage(s)}else console.log("无视频可以分享"),s&&s.run()}}class Gt extends pt{constructor(){super(...arguments),this.platform=te.TT,this._showVideoLoad=!1}Init(e){if(this._base=window.tt,null==this._base)return void console.error(...i.packError("平台初始化错误"));this.platformData=e;let t=this._base.getSystemInfoSync();"ios"==t.platform&&(this.isSupportJumpOther=!1);let[s,a]=t.SDKVersion.split(".");s>=1&&a>=33||(this.isSupportJumpOther=!1),this._InitLauchOption(),this._InitShareInfo(),this._InitSystemInfo(),this._CreateBannerAd(),this._CreateVideoAd(),this._CreateInterstitalAd(),this.recordManager=new Et(this._base),this.recordManager.Platform=this,this.device=new Mt(this._base),window.iplatform=this}_CreateBannerAd(){if(le.IsNullOrEmpty(this.platformData.bannerId))return void console.log("无有效的banner广告ID,取消加载");let e=this._base.getSystemInfoSync().windowWidth,t=this._base.getSystemInfoSync().windowHeight,s={};s.adUnitId=this.platformData.bannerId,s.adIntervals=30;let i={left:0,top:0};i.width=e,s.style=i,this._bannerAd=this._base.createBannerAd(s),this._isBannerLoaded=!1,this._bannerAd&&(this._bannerAd.onLoad(()=>{console.log("banner加载成功",this._bannerAd),this._isBannerLoaded=!0}),this._bannerAd.onError(e=>{console.error("banner广告加载失败",e),this._bannerAd}),this._bannerAd.onResize(s=>{this._bannerAd.style.top=t-s.height,this._bannerAd.style.left=(e-s.width)/2}))}RecordEvent(e,t){let s=this._base.reportAnalytics;s?(null==t&&(t={}),s(e,t)):console.error("reportAnalytics 方法不存在")}ShowBannerAd(){this.IsBannerAvaliable()&&this._bannerAd.show()}ShareAppMessage(e,t,s){console.log("分享消息",e);let i=pt._WrapShareInfo(e);i.success=(()=>{t&&t.run()}),i.fail=(()=>{s&&s.run()}),this._base.shareAppMessage(i)}OpenGameBox(e){let t=[];for(let s=0;s<e.length;++s)t.push({appId:e[s]});this._base.showMoreGamesModal({appLaunchOptions:t})}NavigateToApp(e,t,s){return new Promise((t,s)=>{this.isSupportJumpOther?this._base.showMoreGamesModal({appLaunchOptions:[{appId:this.platformData.appId,query:"foo=bar&baz=qux",extraData:{}}],success(s){t(!0),console.log("跳转小游戏成功",e)},fail(t){s(!1),console.log("跳转小游戏失败",e)}}):(s(!1),console.log("当前平台不支持小游戏跳转",this))})}}class Bt{static get instance(){return null==this._instance&&(this._instance=new Bt),this._instance}static get PlatformInstance(){return this.instance.m_platformInstance||console.error(...i.packError("还没有设置过平台实例代理！")),this.instance.m_platformInstance}init(){if(null!=this.m_platformInstance)return console.error(...i.packError("已调用过平台创建为",ut.GetPlatformStr(this.m_platformInstance.platform),"不能重复创建")),this.m_platformInstance;let e,t=null!=window.qttGame;null!=window.tt?(e=new Gt,this.m_platformData=new rt):Laya.Browser.onMiniGame?(e=new pt,this.m_platformData=new ht):Laya.Browser.onBDMiniGame?(e=new It,this.m_platformData=new it):t?(e=new kt,this.m_platformData=new ot):Laya.Browser.onQQMiniGame?(e=new Pt,this.m_platformData=new nt):Laya.Browser.onQGMiniGame?(e=new xt,this.m_platformData=new at):(console.warn(...i.packWarn("未识别平台,默认创建为web")),e=new St),this.m_platformInstance=e,ut.instance.PlatformInstance=e,window.$Platform=this.m_platformInstance,console.log(...i.packPlatform("平台实例创建完成",ut.GetPlatformStr(this.m_platformInstance.platform)))}initPlatform(){this.m_platformInstance.Init(this.m_platformData),console.log(...i.packPlatform("平台初始化完成"))}}class Vt extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGameTestPlatform")}onConstruct(){this.m_bg=this.getChildAt(0),this.m_lookVAd=this.getChildAt(1),this.m_lookVAdText=this.getChildAt(2),this.m__lookVAd=this.getChildAt(3),this.m_share=this.getChildAt(4),this.m_shareText=this.getChildAt(5),this.m__share=this.getChildAt(6),this.m_showToast=this.getChildAt(7),this.m_showToastText=this.getChildAt(8),this.m__showToast=this.getChildAt(9)}}Vt.URL="ui://kk7g5mmmt1pw9y";class Nt extends Ce{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new Nt,this.m_instance._classDefine=Vt),this.m_instance}_OnShow(){this.ui.m_bg.onClick(this,this.close),this.ui.m_lookVAd.onClick(this,this.lookVAd),this.ui.m_showToast.onClick(this,this.showToast),this.ui.m_share.onClick(this,this.share)}lookVAd(){console.log("看广告测试"),Bt.PlatformInstance.ShowRewardVideoAdAsync().then(e=>{console.log("看广告完成测试",e)})}showToast(){console.log("显示消息测试"),Bt.PlatformInstance.ShowToast("显示消息测试")}share(){console.log("分享测试"),Bt.PlatformInstance.ShareAppMessage({shareId:void 0,shareImg:void 0,sharePath:void 0,shareTitle:"分享消息"},Laya.Handler.create(this,()=>{console.log("分享成功")}),Laya.Handler.create(this,()=>{console.log("分享失败！")}))}close(){Be.instance.setUIState([{typeIndex:X.TestPlatform,state:!1}],!1)}_OnHide(){}}class Tt{constructor(){this.initUIMediator(),this._initUIMediator()}initUIMediator(){}_initUIMediator(){this.m_UIMediator||console.error(...i.packError("没有注册UI状态列表"));let e,t,s=0;for(let e in this.m_UIMediator)s++,void 0!==this.m_UIMediator[e]&&this.m_UIMediator[e]||console.warn(...i.packWarn("有一个UIMediator不存在",e));0==s&&console.warn(...i.packWarn("UI状态列表长度为0")),this.m_UIProxy||console.warn(...i.packWarn("没有注册UI代理类。")),this.m_UIProxy.setProxyMediatroList(this.m_UIMediator);for(let s in this.m_UIMediator)this.m_UIMediator[s].keyId=s,e=[],this.getUIBelongSerialNumber(this.m_UIMediator[s],e),(t=e.length)!=(e=S.Unique(e)).length&&console.error(...i.packError("UI调度者",s,"的附属UI有重复出现！"))}getUIBelongSerialNumber(e,t,s=!1){e.belongDownUIMediator.length>0&&e.belongDownUIMediator.forEach(e=>{this.getUIBelongSerialNumber(e,t,!0)}),s?e.ifBelongUIMediator||console.warn(...i.packWarn("注意！有一个不是附属的UI调度者被添加进了附属列表中")):e.ifBelongUIMediator&&console.warn(...i.packWarn("注意！有一个附属UI调度者被添加进了UI管理器列表中，它将不会被显示。")),t.push(e.serialNumber),e.belongUpUIMediator.length>0&&e.belongUpUIMediator.forEach(e=>{this.getUIBelongSerialNumber(e,t,!0)})}}class Ht extends Tt{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new Ht),this.m_instance}initUIMediator(){this.m_UIMediator={[X.GameLoading]:Re.instance,[X.CustomsLoading]:Ne.instance,[X.TestMain]:tt.instance,[X.TestPlatform]:Nt.instance,[X.Main]:xe.instance,[X.Set]:We.instance,[X.Play]:ke.instance,[X.Start]:Ee.instance,[X.Pause]:He.instance,[X.Com]:Ke.instance,[X.End]:ze.instance},this.m_UIProxy=Be.instance}init(){}Start(){this.m_UIProxy.Start()}}class Ft{constructor(){this.m_GameIfInit=!1}static get instance(){return this.m_instance||(this.m_instance=new Ft),this.m_instance}init(){}get gameIfInit(){return this.m_GameIfInit}GameInit(){this.m_GameIfInit=!1,ne.instance.sendEvent(K.GameInit)}GameOnInit(){this.m_GameIfInit=!0,ne.instance.sendEvent(K.GameOnInit)}}class Wt extends me{}class jt extends pe{clone(){return JSON.parse(JSON.stringify(this))}}class Kt extends pe{constructor(){super(...arguments),this.onCustomsData=new jt}}class $t extends Wt{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new $t),this._instance}InitData(){this._shortData=new Kt}get shortData(){return this._shortData}static emptyGameOnCustomData(){this._instance._shortData=new Kt}}class zt{constructor(){}static get instance(){return this.m_instance||(this.m_instance=new zt),this.m_instance}init(){ne.instance.onEvent(F.GameLevelsBuildBefore,this,this.gameLevelsBuildBefore),ne.instance.onEvent(F.GameLevelsOnBuild,this,this.gameLevelsOnBuild),ne.instance.onEvent(F.GameLevelsDelete,this,this.gameLevelsDelete),ne.instance.onEvent(F.GameStart,this,this.gameStart)}gameLevelsBuildBefore(){$t.emptyGameOnCustomData()}gameLevelsOnBuild(){}gameLevelsDelete(){}gameStart(){}}!function(e){e.config=class{},e.path="res/config/TestConst.json"}(wt||(wt={}));class Qt extends D{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new Qt),this._instance}get data(){}initData(){this.m_data=wt.data}get ifDebug(){return!!V.ifGameTest&&this.m_data.if_debug}get ifShowOimoMesh(){return!!V.ifGameTest&&this.m_data.if_show_oimo_mesh}get oimoMeshDiaphaneity(){return this.m_data.oimo_mesh_diaphaneity}}class qt{static music_url(e){return I.instance.getResURL(d.music)+e+".mp3"}static sound_url(e){return I.instance.getResURL(d.sound)+e+".mp3"}static icon_url(e){return I.instance.getResURL(d.icon)+e+".png"}static img_url(e,t="png"){return I.instance.getResURL(d.img)+e+"."+t}static skin_url(e,t="png"){return I.instance.getResURL(d.skin)+e+"."+t}}class Jt{constructor(){this._bgPast=[],this._urlBGM="",this._urlSOUND="",this._sounds=[]}static get instance(){return null==this._instance&&(this._instance=new Jt),this._instance}init(){}playBGM(e,t,s,a){null!=e&&this._bgPast.slice(-1)[0]!=e?(this._bgPast.push(e),this._urlBGM=qt.music_url(e),this._playMusic(t,s,a),console.log(...i.packLog("播放背景音乐",e))):""!=this._urlBGM&&(this._playMusic(t,s,a),console.log(...i.packLog("播放背景音乐",e)))}shiftBGM(e,t,s,i){if(this._bgPast.slice(-1)[0]==e){this._bgPast.pop(),this._bgPast.slice(-1)[0]&&(this._urlBGM=qt.music_url(e),this._playMusic(t,s,i))}}pauseBGM(){Laya.SoundManager.stopMusic(),console.log(...i.packLog("停止播放音乐",this._urlBGM))}pauseSound(){Laya.SoundManager.stopAllSound()}playSound(e,t,s,i,a){this._urlSOUND=qt.sound_url(e);for(let e=0;e<this._sounds.length;e++)if(this._sounds[e]&&this._sounds[e].url.indexOf(this._urlSOUND)>=0){this._sounds[e].stop(),this._sounds.splice(e,1);break}let n=Laya.SoundManager.playSound(this._urlSOUND,t,s,i,a);this._sounds.push(n)}stopSound(e){this._urlSOUND=qt.sound_url(e),Laya.SoundManager.stopSound(this._urlSOUND)}_playMusic(e=0,t,s){Laya.SoundManager.stopMusic(),Laya.SoundManager.playMusic(this._urlBGM,e,t,s)}}class Zt{constructor(){this.m_stop=!1,this.m_onLoopSoundList=new Set}static get instance(){return this.m_instance||(this.m_instance=new Zt),this.m_instance}stopBGM(){Jt.instance.pauseBGM()}BGMGoOn(){this.playBGM(this.m_onBGM)}soundSuspend(){this.m_stop=!0;for(let e of this.m_onLoopSoundList)Jt.instance.stopSound(e)}soundGoOn(){this.m_stop=!1;for(let e of this.m_onLoopSoundList)Jt.instance.playSound(e,0)}playBGM(e,t,s,i){we.instance.gameData.ifOpenBgm&&!this.m_stop&&(Jt.instance.playBGM(e,t,s,i),this.m_onBGM=e)}playSound(e,t,s,i,a){we.instance.gameData.ifOpenSound&&!this.m_stop&&(0==t&&this.m_onLoopSoundList.add(e),Jt.instance.playSound(e,t,s,i,a))}stopSound(e){Jt.instance.stopSound(e),this.m_onLoopSoundList.has(e)&&this.m_onLoopSoundList.delete(e)}}class Yt{constructor(){}static get instance(){return null==this._instance&&(this._instance=new Yt),this._instance}init(){ne.instance.onEvent(j.BGMSuspend,this,this.BGMsuSpend),ne.instance.onEvent(j.BGMGoOn,this,this.BGMGoOn),ne.instance.onEvent(j.SoundSuspend,this,this.soundSuspend),ne.instance.onEvent(j.SoundGoOn,this,this.soundGoOn),ne.instance.onEvent(j.BGMVolumeChange,this,this.bgmVolumeChange),ne.instance.onEvent(j.SoundVolumeChange,this,this.soundVolumeChange)}BGMsuSpend(){Zt.instance.stopBGM()}BGMGoOn(){Zt.instance.BGMGoOn()}soundSuspend(){Zt.instance.soundSuspend()}soundGoOn(){Zt.instance.soundGoOn()}bgmVolumeChange(e=1){Laya.SoundManager.setMusicVolume(e)}soundVolumeChange(e=1){Laya.SoundManager.setSoundVolume(e)}}class Xt{constructor(){}static get instance(){return null==this._instance&&(this._instance=new Xt),this._instance}enterGame(){this.initGame(),this._startGame(),this.startGame()}initGame(){Ft.instance.init(),ne.instance.init(),Yt.instance.init(),zt.instance.init(),Le.instance.init(),Ht.instance.init(),be.instance.init()}_startGame(){Qt.instance.ifDebug?Laya.Stat.show():Laya.Stat.hide()}startGame(){Ht.instance.Start(),be.instance.initLevelBuild()}}class es{static get needLoadCount(){return this._configList.length}static AddConfig(e){es._configList.push(e)}static AddExtraConfig(e){e.length>0&&(es._extraConfig.push(...e),es._extraConfig=S.Unique(es._extraConfig))}static StartLoad(e,t=null){if(0==es._configList.length)return void(e&&e.run());let s=[];for(let e of es._configList)s.push(y.ConfigURL(e.path.match(/[a-zA-Z0-9.]*$/)[0]));let i=[];s.forEach(e=>{i.push(e)}),s.push(...this._extraConfig),Laya.loader.create(s,Laya.Handler.create(this,()=>{for(let e of es._configList){e.data=Laya.loader.getRes(y.ConfigURL(e.path.match(/[a-zA-Z0-9.]*$/)[0])),e.dataList=[];for(let t in e.data){let s=e.data[t];null!=s&&e.dataList.push(s)}e.dataList.length>0&&(e.lastData=e.dataList[e.dataList.length-1])}e&&e.run(),i.forEach(e=>{a.Unload(e)})}),t)}}es._configList=[],es._extraConfig=[],function(e){e.config=class{},e.path="res/config/GameConst.json"}(Lt||(Lt={}));class ts{constructor(e,t=-1,s){this.packPath=e,this.atliasCount=t,this.m_extraURL=s}PushUrl(e){if(e.push({url:this.packPath+".bin",type:Laya.Loader.BUFFER}),this.m_extraURL&&this.m_extraURL.length>0&&e.push(...this.m_extraURL),this.atliasCount>=0){e.push({url:this.packPath+"_atlas0.png",type:Laya.Loader.IMAGE});for(let t=1;t<=this.atliasCount;t++)e.push({url:this.packPath+"_atlas0_"+t+".png",type:Laya.Loader.IMAGE})}}AddPackage(){fgui.UIPackage.addPackage(this.packPath)}}class ss extends Ie{}class is extends fe{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new is),this._instance}get _saveName(){return"Common"}getNewData(){return new ss}}class as{constructor(){this._needLoadOtherUIPack=[],this._loadProgressWeight={config:1,gameRes:5,otherUI:3},this._configProgress=0,this._otherUIProgress=0,this._resProgress=0}get loadProgress(){let e=0;for(let t in this._loadProgressWeight)e+=this._loadProgressWeight[t];return(this._loadProgressWeight.config*this._configProgress+this._loadProgressWeight.gameRes*this._resProgress+this._loadProgressWeight.otherUI*this._otherUIProgress)/e*100}Enter(e,t,s){this.m_handlerThis=e,this.m_beforeHandler=t,this.m_backHandler=s,this.Init()}_Init(){}Init(){let e=this._Init(),t=()=>{this.initEmptyScreen()};e?e.then(()=>{t()}):t()}initEmptyScreen(){O.instance.init(),De.Init(),this.OnBindUI();let e=[];this._initEmptyScreen.PushUrl(e),0!=e.length?Laya.loader.load(e,Laya.Handler.create(this,this.InitUI)):this.InitUI()}InitUI(){this._initEmptyScreen.AddPackage(),this._OnInitEmptyScreen();let e=()=>{let e=[];this._initUiPack.PushUrl(e),0!=e.length?Laya.loader.load(e,Laya.Handler.create(this,this.OnInitUILoaded)):this.OnInitUILoaded()};this.m_beforeHandler?this.m_beforeHandler.call(this.m_handlerThis).then(()=>{e()}):e()}OnInitUILoaded(){this._initUiPack.AddPackage(),this._OnInitUILoaded(),this.onLoading(this.loadProgress),this.OnConfigLoaded()}OnConfigLoaded(){this.OnSetLoadConfig();let e=[];for(let t in c)c[t]&&e.push(y.levelConfigURL(c[t]));if(es.AddExtraConfig(e),es.needLoadCount<=0)return this._OnConfigProgress(1),void this._OnConfigLoaded();es.StartLoad(Laya.Handler.create(this,this._OnConfigLoaded),Laya.Handler.create(this,this._OnConfigProgress,null,!1))}_OnConfigProgress(e){this._configProgress=e,this.onLoading(this.loadProgress)}_OnConfigLoaded(){O.instance.initConfig();let e=[];for(let t=0;t<this._needLoadOtherUIPack.length;++t)this._needLoadOtherUIPack[t].PushUrl(e);if(0==e.length)return this._OnOtherUIProgress(1),void this._OnOtherUILoaded();Laya.loader.load(e,Laya.Handler.create(this,this._OnOtherUILoaded),Laya.Handler.create(this,this._OnOtherUIProgress,null,!1))}_OnOtherUIProgress(e){this._otherUIProgress=e,this.onLoading(this.loadProgress)}_OnOtherUILoaded(){for(let e=0;e<this._needLoadOtherUIPack.length;++e)this._needLoadOtherUIPack[e].AddPackage();let e=[];if(this.OnGameResPrepared(e),e.push(...y.EssentialOtherResUrl()),O.instance.Preload(e),0==e.length)return this._OnResProgress(1),void this._OnResLoaded();Laya.loader.create(e,Laya.Handler.create(this,this._OnResLoaded),Laya.Handler.create(this,this._OnResProgress,null,!1))}_OnResProgress(e){this._resProgress=e,this.onLoading(this.loadProgress)}_OnResLoaded(){ae.InitAll(),this.loginCommonData(),this.loginData(),this.m_backHandler?this.m_backHandler.call(this.m_handlerThis).then(()=>{this.OnComplete()}):this.OnComplete()}loginCommonData(){is.instance.InitData()}OnBindUI(){}OnSetLoadConfig(){}OnGameResPrepared(e){}_OnInitEmptyScreen(){}_OnInitUILoaded(){}onLoading(e){}loginData(){}OnComplete(){}}!function(e){e.config=class{},e.path="res/config/SkinConfig.json"}(bt||(bt={}));class ns extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("InitLoad","splash")}onConstruct(){this.m_bg=this.getChildAt(0),this.m_progress=this.getChildAt(1),this.m_loading_progress=this.getChildAt(2),this.m_text_logo=this.getChildAt(3),this.m_text_progress=this.getChildAt(4),this.m_text_laya=this.getChildAt(5),this.m_text_explain=this.getChildAt(6),this.m_text_v=this.getChildAt(7),this.m_text_laya_v=this.getChildAt(8),this.m_text_game_explain=this.getChildAt(9)}}ns.URL="ui://n3oedpp6nihr0",function(e){e.config=class{},e.path="res/config/GameStateConst.json"}(vt||(vt={}));class os{static bindAll(){}}class rs{static bindAll(){fairygui.UIObjectFactory.setPackageItemExtension(Fe.URL,Fe),fairygui.UIObjectFactory.setPackageItemExtension(Te.URL,Te),fairygui.UIObjectFactory.setPackageItemExtension(Ve.URL,Ve),fairygui.UIObjectFactory.setPackageItemExtension(Ue.URL,Ue),fairygui.UIObjectFactory.setPackageItemExtension(Pe.URL,Pe),fairygui.UIObjectFactory.setPackageItemExtension(Me.URL,Me),fairygui.UIObjectFactory.setPackageItemExtension(Xe.URL,Xe),fairygui.UIObjectFactory.setPackageItemExtension($e.URL,$e),fairygui.UIObjectFactory.setPackageItemExtension(Qe.URL,Qe),fairygui.UIObjectFactory.setPackageItemExtension(je.URL,je),fairygui.UIObjectFactory.setPackageItemExtension(Oe.URL,Oe),fairygui.UIObjectFactory.setPackageItemExtension(Vt.URL,Vt)}}class hs extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("InitEmptyScreen","EmptyScreen")}onConstruct(){this.m_bg=this.getChildAt(0)}}hs.URL="ui://7ktzib8oq3ng0";class ls{static bindAll(){fairygui.UIObjectFactory.setPackageItemExtension(hs.URL,hs)}}class cs{static bindAll(){fairygui.UIObjectFactory.setPackageItemExtension(ns.URL,ns)}}!function(e){e.null=""}(Dt||(Dt={})),function(e){e.config=class{},e.path="res/config/CameraConst.json"}(Ct||(Ct={})),function(e){e.config=class{},e.path="res/config/LightingConst.json"}(At||(At={}));class ds extends Ie{constructor(){super(...arguments),this.coinCount=0}}class us extends fe{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new us),this._instance}get _saveName(){return"GameProp"}getNewData(){return new ds}}class ms extends Ie{}class _s extends fe{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new _s),this._instance}get _saveName(){return"GameSkin"}getNewData(){return new ms}}class gs extends Ie{constructor(){super(...arguments),this.ifSignIn=!1,this.ifOneDay=!1}}class fs extends fe{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new fs),this._instance}get _saveName(){return"GameSign"}getNewData(){return new gs}}!function(e){e.config=class{},e.path="res/config/LevelPropConfig.json"}(Ut||(Ut={})),function(e){e.config=class{},e.path="res/config/OtherConst.json"}(Rt||(Rt={})),function(e){e.null=""}(Ot||(Ot={}));class ps extends Ie{}class Is extends fe{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new Is),this._instance}get _saveName(){return"GameNewHand"}getNewData(){return new ps}}class ys extends as{_Init(){Ft.instance.GameInit(),this._initEmptyScreen=new ts(y.FGUIPack("InitEmptyScreen")),this._initUiPack=new ts(y.FGUIPack("InitLoad"),0),this._needLoadOtherUIPack=[new ts(y.FGUIPack("GameCommon")),new ts(y.FGUIPack("GameMain"),0)]}_OnInitEmptyScreen(){this._emptyScreenShowUI=De.AddUI(hs,new ve,Y.Main)}_OnInitUILoaded(){this._emptyScreenShowUI.dispose(),this._loadShowUI=De.AddUI(ns,new ve,Y.Loading),this._loadShowUI.sortingOrder=Number.MAX_SAFE_INTEGER,this._loadShowUI.m_text_explain.text=B.GameWhatTeam,this._loadShowUI.m_text_logo.text=B.GameName_,this._loadShowUI.m_text_v.text=B.versions,this._loadShowUI.m_text_game_explain.text=B.GameExplain,this._loadShowUI.m_text_laya_v.text=Laya.version,this._loadingProgress=this._loadShowUI.m_progress,this._loadingProgressText=this._loadShowUI.m_loading_progress,this._loadingProgress.value=0}OnBindUI(){ls.bindAll(),cs.bindAll(),os.bindAll(),rs.bindAll()}OnSetLoadConfig(){es.AddConfig(Ct),es.AddConfig(z),es.AddConfig(Q),es.AddConfig(Lt),es.AddConfig(vt),es.AddConfig(u),es.AddConfig(m),es.AddConfig(Ut),es.AddConfig(At),es.AddConfig(Rt),es.AddConfig(bt),es.AddConfig(wt)}loginData(){Se.instance.InitData(),Is.instance.InitData(),us.instance.InitData(),_s.instance.InitData(),fs.instance.InitData(),$t.instance.InitData(),Je.instance.InitData()}OnGameResPrepared(e){let t;for(let s in Ot)""!=(t=Ot[s])&&e.push(qt.music_url(t));for(let s in Dt)""!=(t=Dt[s])&&e.push(qt.sound_url(t))}onLoading(e){this._loadingProgress.value=e,this._loadingProgressText.text=Math.floor(e).toString()+"%"}OnComplete(){this._loadShowUI.dispose(),Ft.instance.GameOnInit()}}class Ss{constructor(){}static get instance(){return null==this._instance&&(this._instance=new Ss),this._instance}enterGame(){this.initGame()}initGame(){}}class ws{startTest(){}}class Ls extends ws{constructor(){super(...arguments),this._consoleExStr="输出测试"}startTest(){console.log("->开启测试<-"),console.log(...i.packLog(this._consoleExStr)),console.warn(...i.packWarn(this._consoleExStr)),console.error(...i.packError(this._consoleExStr))}}class bs extends ws{startTest(){(new Ls).startTest()}}class vs extends ws{startTest(){this.asyncTest()}asyncTest(){return __awaiter(this,void 0,void 0,function*(){console.log("异步开始。"),yield this._asyncTest(),console.log("异步结束。")})}_asyncTest(){return new Promise(e=>{Laya.timer.once(1e3,this,()=>{e()})})}}class Ds extends ws{static get instance(){return this._instance?this._instance:(this._instance=new Ds,this._instance)}start(e){}}class Cs extends ws{startTest(){(new vs).startTest(),(new Ds).startTest()}}class As extends se{constructor(){super(...arguments),this._name="Main"}_startDebug(){console.log("开启主调试"),ie.instance.startDebug(),ge.instance.startDebug()}}class Us extends se{constructor(){super(),this._name="Custom"}static get instance(){return this.m_instance||(this.m_instance=new Us),this.m_instance}}class Rs extends se{constructor(){super(...arguments),this._name="MyMainDebug"}_startDebug(){Us.instance.startDebug()}}class Os{constructor(){this.init().then(()=>{this.upGameLoad(),this.gameLoad()})}init(){return new Promise(e=>{Bt.instance.init(),Bt.instance.initPlatform(),this.loadSubpackage().then(()=>{e()})})}loadSubpackage(){return new Promise(e=>{if(p.subpackages.length>0){let t=[];for(let e of p.subpackages)e.name&&t.push(new Promise(t=>{Bt.PlatformInstance.LoadSubpackage(e.name,Laya.Handler.create(this,()=>{t()}),Laya.Handler.create(this,()=>{t()}),void 0)}));Promise.all(t).then(()=>{e()})}else e()})}upGameLoad(){V.ifTest&&((new bs).startTest(),(new Cs).startTest()),V.ifDebug&&((new As).startDebug(),(new Rs).startDebug(),V.ifOpenWindowDebug&&se.openWindowDebug())}gameLoad(){let e=new ys;console.log(...i.comLog("开始加载游戏")),e.Enter(this,void 0,this.OnGameLoad)}OnGameLoad(){return new Promise(e=>{e(),console.log(...i.comLog("游戏加载完成")),V.support3D&&Xt.instance.enterGame(),V.support2D&&Ss.instance.enterGame(),this.OnGameEnter()})}OnGameEnter(){}}let xs=new class{constructor(){this.name="LayaMiniGame",this.ZHName="LayaBox小游戏",this.versions="1.2.7"}};window["$"+xs.name]=xs,new class{constructor(){window.Laya3D?Laya3D.init(e.width,e.height):Laya.init(e.width,e.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=e.scaleMode,Laya.stage.screenMode=e.screenMode,Laya.stage.alignV=e.alignV,Laya.stage.alignH=e.alignH,Laya.URL.exportSceneToJson=e.exportSceneToJson,(e.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),e.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),e.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){new Os}}}();